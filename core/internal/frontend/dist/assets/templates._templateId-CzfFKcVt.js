import{r as l,j as e,X as F,u as ke,b as Ce,d as E,L as xe,t as kt,U as Te,V as ee,_ as Ct,T as te,k as se,n as re,F as Tt,G as St,v as Et,m as me,A as At}from"./index-fKaFifWB.js";import{S as ue}from"./skeleton-BPnsdAjk.js";import{a as It,u as Vt}from"./version-highlight-store-CNWswpJC.js";import{p as Pt,f as Lt,D as Ft}from"./templates-api-D2rcs8lc.js";import{i as Ht,j as Rt,k as Ut,l as zt,m as Bt,a as Ot,b as Mt,T as $t,t as $e,n as Wt,u as _t,g as Kt,o as qt,p as Qt,q as Gt,r as Xt,D as Yt,h as Jt}from"./DocumentTypeConflictDialog-D5_Euiew.js";import{D as H,B as R,a as U,c as z,b as B}from"./dialog-9nhh7mvL.js";import{u as P}from"./useTranslation-D0qa437J.js";import{T as G}from"./triangle-alert-Di5g5Wop.js";import{P as Se}from"./pencil-H1WR5f29.js";import{a as Zt,u as es}from"./useMutation-DIF_ISNy.js";import{S as ts}from"./search-DDi9d-Bq.js";import{F as ye}from"./file-text-9wfbuSTS.js";import{a as ss}from"./chevron-right-BnYhLX46.js";import{I as rs,C as os,a as ns,b as as}from"./info-DKNJqB_Z.js";import{C as Ke,E as is,a as ls,S as ds,b as cs}from"./send-D4-EfYh9.js";import{C as we,L as ms}from"./layers-BInfCQBw.js";import{A as De,T as us,F as ps}from"./trash-2-CCOxSVLr.js";import{C as qe}from"./calendar-CUaXafub.js";import{A as xs}from"./arrow-up-right-BqKNCxRd.js";import{A as gs}from"./arrow-left-DWWoMVQm.js";import{P as fs}from"./plus-s7EU9lJN.js";import{F as hs}from"./folder-open-CLELnnBv.js";import"./dropdown-menu-Dju4gITJ.js";import"./Combination-C5nVb5De.js";import"./useDocumentTypes-BMD2TBs4.js";import"./chevron-down-DzxdpjNN.js";function bs({open:t,onOpenChange:i,version:s,templateId:o}){const{t:n}=P(),[r,c]=l.useState(!1),d=Ht(o),m=async()=>{if(!(!s||r)){c(!0);try{await d.mutateAsync(s.id),i(!1)}catch{}finally{c(!1)}}};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-destructive/10",children:e.jsx(G,{className:"h-5 w-5 text-destructive"})}),e.jsx("div",{children:e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:n("templates.versionArchiveDialog.title","Archive Version")})})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(B,{className:"text-sm font-light text-muted-foreground",children:n("templates.versionArchiveDialog.message","Are you sure you want to archive version {{version}}? This action cannot be undone.",{version:(s==null?void 0:s.versionNumber)??""})})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:r,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:n("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:m,disabled:r,className:"rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",children:r?n("common.archiving","Archiving..."):n("templates.versionArchiveDialog.confirm","Archive")})]})]})})}function js({open:t,onOpenChange:i,version:s,templateId:o}){const{t:n}=P(),[r,c]=l.useState(!1),d=Rt(o),m=async()=>{if(!(!s||r)){c(!0);try{await d.mutateAsync(s.id),i(!1)}catch{}finally{c(!1)}}};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-destructive/10",children:e.jsx(G,{className:"h-5 w-5 text-destructive"})}),e.jsx("div",{children:e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:n("templates.versionCancelScheduleDialog.title","Cancel Scheduled Publication")})})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(B,{className:"text-sm font-light text-muted-foreground",children:n("templates.versionCancelScheduleDialog.message","Are you sure you want to cancel the scheduled publication of version {{version}}?",{version:(s==null?void 0:s.versionNumber)??""})})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:r,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:n("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:m,disabled:r,className:"rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",children:r?n("common.cancelling","Cancelling..."):n("templates.versionCancelScheduleDialog.confirm","Cancel Schedule")})]})]})})}function vs({open:t,onOpenChange:i,templateId:s,sourceVersion:o}){const{t:n}=P(),r=ke(),{currentWorkspace:c}=Ce(),[d,m]=l.useState(""),[b,v]=l.useState(""),[g,p]=l.useState(!1),f=Ut(s),j=l.useCallback(h=>{h&&(m(""),v(""),p(!1)),i(h)},[i]),u=async h=>{if(h.preventDefault(),!(!d.trim()||!c||!o||g)){p(!0);try{const D=await f.mutateAsync({sourceVersionId:o.id,name:d.trim(),description:b.trim()||void 0});i(!1),r({to:"/workspace/$workspaceId/editor/$templateId/version/$versionId",params:{workspaceId:c.id,templateId:s,versionId:D.id}})}catch{p(!1)}}};return o?e.jsx(H,{open:t,onOpenChange:j,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:n("templates.cloneVersionDialog.title","Clonar Versión")}),e.jsx(B,{className:"mt-1 text-sm font-light text-muted-foreground",children:n("templates.cloneVersionDialog.description","Crear una nueva versión a partir de {{versionName}}",{versionName:o.name})}),e.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:n("templates.cloneVersionDialog.sourceVersion","Versión origen: v{{versionNumber}} - {{versionName}}",{versionNumber:o.versionNumber,versionName:o.name})})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"clone-version-name",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:n("templates.createVersionDialog.nameLabel","Version Name")}),e.jsx("input",{id:"clone-version-name",type:"text",value:d,onChange:h=>m(h.target.value),placeholder:n("templates.createVersionDialog.namePlaceholder","e.g., Initial Draft, Review Changes..."),maxLength:100,autoFocus:!0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"clone-version-description",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[n("templates.createVersionDialog.descriptionLabel","Description"),e.jsxs("span",{className:"ml-2 normal-case tracking-normal text-muted-foreground/60",children:["(",n("common.optional","optional"),")"]})]}),e.jsx("textarea",{id:"clone-version-description",value:b,onChange:h=>v(h.target.value),placeholder:n("templates.createVersionDialog.descriptionPlaceholder","Optional description of changes..."),rows:3,className:"w-full resize-none rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:g,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:n("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!d.trim()||g,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:g?n("common.creating","Creando..."):n("templates.cloneVersionDialog.submit","Clonar Versión")})]})]})]})}):null}function Ns({open:t,onOpenChange:i,templateId:s}){const{t:o}=P(),n=ke(),{currentWorkspace:r}=Ce(),[c,d]=l.useState(""),[m,b]=l.useState(""),[v,g]=l.useState(!1),p=zt(s),f=l.useCallback(u=>{u&&(d(""),b(""),g(!1)),i(u)},[i]),j=async u=>{if(u.preventDefault(),!(!c.trim()||!r||v)){g(!0);try{const h=await p.mutateAsync({name:c.trim(),description:m.trim()||void 0});i(!1),n({to:"/workspace/$workspaceId/editor/$templateId/version/$versionId",params:{workspaceId:r.id,templateId:s,versionId:h.id}})}catch{g(!1)}}};return e.jsx(H,{open:t,onOpenChange:f,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:o("templates.createVersionDialog.title","New Version")}),e.jsx(B,{className:"mt-1 text-sm font-light text-muted-foreground",children:o("templates.createVersionDialog.description","Create a new version of this template")})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"version-name",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:o("templates.createVersionDialog.nameLabel","Version Name")}),e.jsx("input",{id:"version-name",type:"text",value:c,onChange:u=>d(u.target.value),placeholder:o("templates.createVersionDialog.namePlaceholder","e.g., Initial Draft, Review Changes..."),maxLength:100,autoFocus:!0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"version-description",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[o("templates.createVersionDialog.descriptionLabel","Description"),e.jsxs("span",{className:"ml-2 normal-case tracking-normal text-muted-foreground/60",children:["(",o("common.optional","optional"),")"]})]}),e.jsx("textarea",{id:"version-description",value:m,onChange:u=>b(u.target.value),placeholder:o("templates.createVersionDialog.descriptionPlaceholder","Optional description of changes..."),rows:3,className:"w-full resize-none rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:v,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:o("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!c.trim()||v,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:v?o("common.creating","Creating..."):o("templates.createVersionDialog.submit","Create Version")})]})]})]})})}function ys({open:t,onOpenChange:i,version:s,templateId:o}){const{t:n}=P(),[r,c]=l.useState(!1),d=Bt(o),m=async()=>{if(!(!s||r)){c(!0);try{await d.mutateAsync(s.id),i(!1)}catch{}finally{c(!1)}}};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-destructive/10",children:e.jsx(G,{className:"h-5 w-5 text-destructive"})}),e.jsx("div",{children:e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:n("templates.versionDeleteDialog.title","Delete Version")})})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(B,{className:"text-sm font-light text-muted-foreground",children:n("templates.versionDeleteDialog.message","Are you sure you want to delete version {{version}}? This action cannot be undone.",{version:(s==null?void 0:s.versionNumber)??""})})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:r,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:n("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:m,disabled:r,className:"rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",children:r?n("common.deleting","Deleting..."):n("templates.versionDeleteDialog.confirm","Delete")})]})]})})}function ws({value:t,onSave:i,isLoading:s=!1,className:o}){const[n,r]=l.useState(!1),[c,d]=l.useState(t),[m,b]=l.useState(!1),v=l.useRef(null);l.useEffect(()=>{!n&&!m&&d(t)},[t,n,m]),l.useEffect(()=>{n&&v.current&&(v.current.focus(),v.current.select())},[n]);const g=async()=>{const u=c.trim();if(!u||u===t){d(t),r(!1);return}b(!0),r(!1);try{await i(u)}catch{d(t)}finally{b(!1)}},p=u=>{u.key==="Enter"?(u.preventDefault(),g()):u.key==="Escape"&&(d(t),r(!1))},f=()=>{!s&&!m&&r(!0)},j=s||m;return n?e.jsxs("div",{className:"relative flex items-center gap-3",children:[e.jsx("input",{ref:v,value:c,onChange:u=>d(u.target.value),onBlur:g,onKeyDown:p,disabled:j,className:E("w-full bg-transparent border-b-2 border-primary outline-none","disabled:opacity-50",o)}),j&&e.jsx(xe,{className:"h-5 w-5 shrink-0 animate-spin text-muted-foreground"})]}):e.jsxs("div",{onClick:f,className:E("group relative flex w-full cursor-text items-center rounded px-2 py-1 -mx-2 -my-1","transition-all duration-150","hover:bg-muted/40",j&&"pointer-events-none"),children:[e.jsx("span",{className:E("min-w-0 flex-1 truncate",o),children:t}),j?e.jsx(xe,{className:"ml-3 h-5 w-5 shrink-0 animate-spin text-muted-foreground"}):e.jsx(Se,{size:18,className:"ml-3 shrink-0 text-muted-foreground opacity-0 transition-opacity group-hover:opacity-60"})]})}function Ds({open:t,onOpenChange:i,templateId:s,currentTags:o}){const{t:n}=P(),[r,c]=l.useState([]),[d,m]=l.useState(!1),b=Ot(),v=Mt();l.useEffect(()=>{t&&(c(o.map(p=>p.id)),m(!1))},[t,o]);const g=async p=>{if(p.preventDefault(),!d){m(!0);try{const f=o.map(h=>h.id),j=r.filter(h=>!f.includes(h)),u=f.filter(h=>!r.includes(h));j.length>0&&await b.mutateAsync({templateId:s,tagIds:j});for(const h of u)await v.mutateAsync({templateId:s,tagId:h});i(!1)}catch{}finally{m(!1)}}};return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:n("templates.editTagsDialog.title","Edit Tags")}),e.jsx(B,{className:"mt-1 text-sm font-light text-muted-foreground",children:n("templates.editTagsDialog.description","Add or remove tags from this template")})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:g,children:[e.jsx("div",{className:"p-6",children:e.jsx($t,{selectedTagIds:r,onSelectionChange:c})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:d,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:n("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:d,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:d?n("common.saving","Saving..."):n("templates.editTagsDialog.submit","Save Tags")})]})]})]})})}const Ee={all:["production-templates"],search:t=>[...Ee.all,t]};function ks(t){return es({queryKey:Ee.search(t),queryFn:()=>Lt(t),enabled:t.length>0,staleTime:30*1e3,placeholderData:i=>i})}function Cs(t){const i=kt();return Zt({mutationFn:({versionId:s,request:o})=>Pt(t,s,o),onSuccess:s=>{i.invalidateQueries({queryKey:$e.detail(t)}),s.version.templateId!==t&&i.invalidateQueries({queryKey:$e.detail(s.version.templateId)}),i.invalidateQueries({queryKey:Wt.all}),i.invalidateQueries({queryKey:Ee.all})}})}function Ts({open:t,onOpenChange:i,version:s,templateId:o,onSuccess:n}){const{t:r}=P(),{toast:c}=Te(),[d,m]=l.useState("NEW_TEMPLATE"),[b,v]=l.useState(""),[g,p]=l.useState(null),[f,j]=l.useState(""),[u,h]=l.useState(""),D=Cs(o),{data:I,isLoading:K}=ks(f),C=l.useCallback(N=>{j(N),p(null)},[]),L=l.useCallback(N=>{N&&s&&(m("NEW_TEMPLATE"),v(""),p(null),j(""),h(s.name)),i(N)},[i,s]),q=l.useMemo(()=>d==="NEW_TEMPLATE"?b.trim().length>0:g!==null,[d,b,g]),X=async N=>{var Y;if(N.preventDefault(),!(!s||!q||D.isPending))try{const O=await D.mutateAsync({versionId:s.id,request:{mode:d,targetTemplateId:d==="NEW_VERSION"?g??void 0:void 0,versionName:u.trim()||void 0}});c({title:r("templates.promoteDialog.success","Version promoted successfully"),description:d==="NEW_TEMPLATE"?r("templates.promoteDialog.successNewTemplate","New template created in production"):r("templates.promoteDialog.successNewVersion","New version added to template")}),n(O)}catch(O){if(ee.isAxiosError(O)&&((Y=O.response)==null?void 0:Y.status)===409){c({variant:"destructive",title:r("templates.promoteDialog.conflictError","Version name already exists"),description:r("templates.promoteDialog.conflictErrorDesc","A version with this name already exists in the target template. Please choose a different name.")});return}c({variant:"destructive",title:r("common.error","Error"),description:Ct(O)})}};return s?e.jsx(H,{open:t,onOpenChange:L,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:r("templates.promoteDialog.title","Promote to Production")}),e.jsx(B,{className:"mt-1 text-sm font-light text-muted-foreground",children:r("templates.promoteDialog.description",'Promote version "{{name}}" to production',{name:s.name})})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:X,children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:()=>m("NEW_TEMPLATE"),className:E("flex w-full items-start gap-3 border p-4 text-left transition-colors",d==="NEW_TEMPLATE"?"border-foreground bg-accent":"border-border hover:border-foreground/50"),children:[e.jsx("div",{className:E("mt-0.5 flex h-4 w-4 shrink-0 items-center justify-center rounded-full border",d==="NEW_TEMPLATE"?"border-foreground bg-foreground":"border-muted-foreground"),children:d==="NEW_TEMPLATE"&&e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-background"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:r("templates.promoteDialog.modeNewTemplate","New Template")}),e.jsx("p",{className:"mt-0.5 text-sm text-muted-foreground",children:r("templates.promoteDialog.modeNewTemplateDesc","Create a new template with this version")})]})]}),e.jsxs("button",{type:"button",onClick:()=>m("NEW_VERSION"),className:E("flex w-full items-start gap-3 border p-4 text-left transition-colors",d==="NEW_VERSION"?"border-foreground bg-accent":"border-border hover:border-foreground/50"),children:[e.jsx("div",{className:E("mt-0.5 flex h-4 w-4 shrink-0 items-center justify-center rounded-full border",d==="NEW_VERSION"?"border-foreground bg-foreground":"border-muted-foreground"),children:d==="NEW_VERSION"&&e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-background"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:r("templates.promoteDialog.modeExistingTemplate","Existing Template")}),e.jsx("p",{className:"mt-0.5 text-sm text-muted-foreground",children:r("templates.promoteDialog.modeExistingTemplateDesc","Add as new version to existing template")})]})]})]}),d==="NEW_TEMPLATE"?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"template-name",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:r("templates.promoteDialog.templateName","Template Name")}),e.jsx("input",{id:"template-name",type:"text",value:b,onChange:N=>v(N.target.value),placeholder:r("templates.promoteDialog.templateNamePlaceholder","Enter template name"),maxLength:200,autoFocus:!0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}):e.jsxs("div",{children:[e.jsx("label",{htmlFor:"target-template",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:r("templates.promoteDialog.targetTemplate","Target Template")}),e.jsxs("div",{className:"relative",children:[e.jsx(ts,{className:"absolute left-0 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{id:"target-template",type:"text",value:f,onChange:N=>C(N.target.value),placeholder:r("templates.promoteDialog.searchPlaceholder","Search templates..."),autoFocus:!0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-6 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"}),K&&e.jsx(xe,{className:"absolute right-0 top-2.5 h-4 w-4 animate-spin text-muted-foreground"})]}),f&&e.jsx("div",{className:"mt-3 max-h-48 overflow-y-auto border border-border",children:I!=null&&I.items&&I.items.length>0?I.items.map(N=>e.jsxs("button",{type:"button",onClick:()=>p(N.id),className:E("flex w-full items-center gap-3 border-b border-border px-3 py-2.5 text-left transition-colors last:border-b-0",g===N.id?"bg-accent":"hover:bg-accent/50"),children:[e.jsx(ye,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),e.jsx("span",{className:"flex-1 truncate text-sm text-foreground",children:N.title}),g===N.id&&e.jsx(ss,{className:"h-4 w-4 shrink-0 text-foreground"})]},N.id)):e.jsx("div",{className:"px-3 py-4 text-center text-sm text-muted-foreground",children:r("templates.promoteDialog.noTemplatesFound","No templates found")})}),!f&&e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:r("templates.promoteDialog.selectTemplate","Search and select a template")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"version-name",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:r("templates.promoteDialog.versionName","Version Name")}),e.jsx("input",{id:"version-name",type:"text",value:u,onChange:N=>h(N.target.value),placeholder:r("templates.promoteDialog.versionNamePlaceholder","Enter version name"),maxLength:100,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:D.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:r("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!q||D.isPending,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:D.isPending?r("templates.promoteDialog.promoting","Promoting..."):r("templates.promoteDialog.promote","Promote")})]})]})]})}):null}function Ss({open:t,onOpenChange:i,version:s,onConfirm:o,isLoading:n}){const{t:r}=P();return s?e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:r("templates.publishDialog.title","Publish Version")}),e.jsx(B,{className:"mt-1 text-sm font-light text-muted-foreground",children:r("templates.publishDialog.description",'Make version "{{name}}" live',{name:s.name})})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex gap-3 rounded-md border border-warning-border bg-warning-muted p-4",children:[e.jsx(G,{className:"h-5 w-5 shrink-0 text-warning"}),e.jsxs("div",{className:"text-sm text-warning-foreground",children:[e.jsx("p",{className:"font-medium",children:r("templates.publishDialog.warningTitle","This action will:")}),e.jsxs("ul",{className:"mt-2 list-inside list-disc space-y-1 opacity-80",children:[e.jsx("li",{children:r("templates.publishDialog.warning1","Replace the current published version")}),e.jsx("li",{children:r("templates.publishDialog.warning2","Make this content immediately available")})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:n,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:r("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:o,disabled:n,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:n?r("common.publishing","Publishing..."):r("templates.publishDialog.confirm","Publish Now")})]})]})}):null}function Qe(){return new Date().toISOString().split("T")[0]}function Es(t){const i=Qe();if(t===i){const s=new Date;return s.setMinutes(s.getMinutes()+5),s.toTimeString().slice(0,5)}return"00:00"}function As({open:t,onOpenChange:i,version:s,onConfirm:o,isLoading:n}){const{t:r}=P(),[c,d]=l.useState(""),[m,b]=l.useState(""),v=l.useCallback(f=>{i(f)},[i]),g=()=>{if(!c||!m)return;const f=new Date(`${c}T${m}`).toISOString();o(f),d(""),b("")},p=c&&m;return s?e.jsx(H,{open:t,onOpenChange:v,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:r("templates.scheduleDialog.title","Schedule Publication")}),e.jsx(B,{className:"mt-1 text-sm font-light text-muted-foreground",children:r("templates.scheduleDialog.description",'Schedule when "{{name}}" will go live',{name:s.name})})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"publish-date",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:r("templates.scheduleDialog.dateLabel","Publish Date")}),e.jsx("input",{id:"publish-date",type:"date",value:c,onChange:f=>d(f.target.value),min:Qe(),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all focus-visible:border-foreground focus-visible:ring-0 dark:scheme-dark"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"publish-time",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:r("templates.scheduleDialog.timeLabel","Publish Time")}),e.jsx("input",{id:"publish-time",type:"time",value:m,onChange:f=>b(f.target.value),min:c?Es(c):void 0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all focus-visible:border-foreground focus-visible:ring-0 dark:scheme-dark"})]}),e.jsxs("div",{className:"flex gap-3 rounded-md border border-info-border bg-info-muted p-4",children:[e.jsx(rs,{className:"h-5 w-5 shrink-0 text-info"}),e.jsx("p",{className:"text-sm text-info-foreground",children:r("templates.scheduleDialog.info","The version will be published automatically at the scheduled time. You can cancel anytime before then.")})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),disabled:n,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:r("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:g,disabled:!p||n,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:n?r("common.scheduling","Scheduling..."):r("templates.scheduleDialog.confirm","Schedule")})]})]})},s.id):null}function Is({tag:t,className:i}){const s=typeof t=="string"?t:t.name,o=typeof t=="object"?t.color:void 0;return e.jsxs("span",{className:E("inline-flex items-center gap-1 rounded-sm bg-muted px-1.5 py-0.5 font-mono text-xs text-muted-foreground",i),children:[o&&e.jsx("span",{className:"h-2 w-2 shrink-0 rounded-full",style:{backgroundColor:o}}),s]})}function Vs({open:t,onOpenChange:i,validation:s,onOpenEditor:o}){const{t:n}=P();if(!s)return null;const r=s.errors&&s.errors.length>0,c=s.warnings&&s.warnings.length>0;return e.jsx(H,{open:t,onOpenChange:i,children:e.jsxs(R,{className:"max-w-lg",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(U,{className:"font-mono text-sm font-medium uppercase tracking-widest text-destructive",children:n("templates.validationDialog.title","Validation Errors")}),e.jsx(B,{className:"mt-1 text-sm font-light text-muted-foreground",children:n("templates.validationDialog.description","Cannot publish version due to content errors")})]}),e.jsxs(z,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(F,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"max-h-[400px] overflow-y-auto p-6",children:[r&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-destructive",children:[e.jsx(Ke,{size:16}),e.jsxs("span",{className:"font-mono text-xs font-medium uppercase tracking-widest",children:[n("templates.validationDialog.errors","Errors")," (",s.errors.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:s.errors.map((d,m)=>e.jsxs("div",{className:"border-l-2 border-destructive bg-destructive/5 py-2 pl-3 pr-2",children:[e.jsx("p",{className:"text-sm text-foreground",children:d.message}),e.jsx("p",{className:"mt-1 font-mono text-[10px] text-muted-foreground",children:d.path})]},m))})]}),c&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-warning",children:[e.jsx(G,{size:16}),e.jsxs("span",{className:"font-mono text-xs font-medium uppercase tracking-widest",children:[n("templates.validationDialog.warnings","Warnings")," (",s.warnings.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:s.warnings.map((d,m)=>e.jsxs("div",{className:"border-l-2 border-warning-border bg-warning-muted/50 py-2 pl-3 pr-2",children:[e.jsx("p",{className:"text-sm text-foreground",children:d.message}),e.jsx("p",{className:"mt-1 font-mono text-[10px] text-muted-foreground",children:d.path})]},m))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",children:n("common.close","Close")}),o&&e.jsx("button",{type:"button",onClick:()=>{i(!1),o()},className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90",children:n("templates.validationDialog.openEditor","Open in Editor")})]})]})})}const We={DRAFT:{label:"Draft",badgeClass:"border-warning-border/50 bg-warning-muted text-warning-foreground",dotClass:"bg-warning"},SCHEDULED:{label:"Scheduled",badgeClass:"border-info-border/50 bg-info-muted text-info-foreground",dotClass:"bg-info"},PUBLISHED:{label:"Published",badgeClass:"border-success-border/50 bg-success-muted text-success-foreground",dotClass:"bg-success"},ARCHIVED:{label:"Archived",badgeClass:"border-muted-foreground/30 bg-muted text-muted-foreground",dotClass:"bg-muted-foreground"}};function Ps({status:t}){const i=We[t]||We.DRAFT;return e.jsxs("span",{className:E("inline-flex items-center gap-1.5 border px-2 py-0.5 font-mono text-[10px] uppercase tracking-widest",i.badgeClass),children:[e.jsx("span",{className:E("h-1.5 w-1.5 rounded-full",i.dotClass)}),i.label]})}function pe(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):null}function _({icon:t,label:i,onClick:s,variant:o="default"}){return e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{onClick:n=>{n.stopPropagation(),s()},className:`flex h-9 w-9 items-center justify-center rounded-sm transition-colors ${o==="destructive"?"text-muted-foreground hover:bg-destructive/10 hover:text-destructive":"text-muted-foreground hover:bg-accent hover:text-foreground"}`,children:t})}),e.jsx(re,{side:"top",className:"font-mono text-xs",children:i})]})}function Ls({version:t,onOpenEditor:i,onPublish:s,onSchedule:o,onCancelSchedule:n,onArchive:r,onDelete:c,onPromote:d,onClone:m,onRename:b,isSandboxMode:v=!1,isHighlighted:g=!1}){const{t:p}=P(),{toast:f}=Te(),[j,u]=l.useState(!1),[h,D]=l.useState(t.name),[I,K]=l.useState(!1),C=l.useRef(null),L=t.status==="DRAFT"&&!!b;l.useEffect(()=>{!j&&!I&&D(t.name)},[t.name,j,I]),l.useEffect(()=>{j&&C.current&&(C.current.focus(),C.current.select())},[j]);const q=async()=>{const A=h.trim();if(!A||A===t.name){D(t.name),u(!1);return}K(!0),u(!1);try{await(b==null?void 0:b(t,A))}catch{D(t.name)}finally{K(!1)}},X=A=>{A.key==="Enter"?(A.preventDefault(),q()):A.key==="Escape"&&(D(t.name),u(!1))},N=A=>{A.stopPropagation(),I||u(!0)},Y=t.status==="DRAFT"||t.status==="SCHEDULED",O=t.status==="DRAFT",oe=t.status==="SCHEDULED",ge=t.status==="PUBLISHED",fe=t.status==="DRAFT",he=v&&t.status==="PUBLISHED",ne=!!m;return e.jsxs("div",{onClick:()=>!j&&i(t.id),className:E("group cursor-pointer border-b border-border px-4 py-4 transition-colors hover:bg-accent",g&&"animate-pulse-highlight"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("span",{className:"flex h-8 w-8 shrink-0 items-center justify-center border border-border bg-background font-mono text-xs font-medium",children:["v",t.versionNumber]}),e.jsxs("div",{className:"min-w-0",children:[j?e.jsx("input",{ref:C,value:h,onChange:A=>D(A.target.value),onBlur:q,onKeyDown:X,onClick:A=>A.stopPropagation(),maxLength:100,className:"w-full bg-transparent font-medium text-foreground border-b-2 border-primary outline-none"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.name}),L&&!I&&e.jsx("button",{onClick:N,className:"shrink-0",children:e.jsx(Se,{size:14,className:"text-muted-foreground opacity-0 transition-opacity group-hover:opacity-60 hover:!opacity-100"})}),I&&e.jsx(xe,{size:14,className:"shrink-0 animate-spin text-muted-foreground"}),e.jsx(is,{size:14,className:"text-muted-foreground opacity-0 transition-opacity group-hover:opacity-100"})]}),t.description&&!j&&e.jsx("p",{className:"mt-0.5 text-sm text-muted-foreground line-clamp-1",children:t.description})]})]}),e.jsx(Ps,{status:t.status})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between pl-11",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{size:12}),p("templates.versionInfo.createdAt","Created"),": ",pe(t.createdAt)]}),t.scheduledPublishAt&&e.jsxs("span",{className:"flex items-center gap-1 text-info",children:[e.jsx(os,{size:12}),p("templates.versionInfo.scheduledAt","Scheduled"),":"," ",pe(t.scheduledPublishAt)]}),t.publishedAt&&e.jsxs("span",{className:"flex items-center gap-1 text-success",children:[e.jsx(ns,{size:12}),p("templates.versionInfo.publishedAt","Published"),": ",pe(t.publishedAt)]}),t.archivedAt&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(De,{size:12}),p("templates.versionInfo.archivedAt","Archived"),": ",pe(t.archivedAt)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{icon:e.jsx(as,{size:18}),label:p("templates.versions.actions.copyId","Copy Version ID"),onClick:async()=>{await navigator.clipboard.writeText(t.id),f({description:p("templates.versions.idCopied","Version ID copied to clipboard")})}}),ne&&e.jsx(_,{icon:e.jsx(ls,{size:18}),label:p("templates.versions.actions.clone","Clonar versión"),onClick:()=>m==null?void 0:m(t)}),Y&&e.jsx(_,{icon:e.jsx(ds,{size:18}),label:p("templates.versions.actions.publishNow","Publish Now"),onClick:()=>s==null?void 0:s(t)}),O&&e.jsx(_,{icon:e.jsx(qe,{size:18}),label:p("templates.versions.actions.schedule","Schedule"),onClick:()=>o==null?void 0:o(t)}),oe&&e.jsx(_,{icon:e.jsx(Ke,{size:18}),label:p("templates.versions.actions.cancelSchedule","Cancel Schedule"),onClick:()=>n==null?void 0:n(t)}),ge&&e.jsx(_,{icon:e.jsx(De,{size:18}),label:p("templates.versions.actions.archive","Archive"),onClick:()=>r==null?void 0:r(t)}),he&&e.jsx(_,{icon:e.jsx(xs,{size:18}),label:p("templates.versions.actions.promote","Promote to Production"),onClick:()=>d==null?void 0:d(t)}),fe&&e.jsx(_,{icon:e.jsx(us,{size:18}),label:p("templates.versions.actions.delete","Delete"),onClick:()=>c==null?void 0:c(t),variant:"destructive"})]})]})]})}function _e(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}function Fs(){var Be,Oe,Me;const{templateId:t}=Tt({from:"/workspace/$workspaceId/templates/$templateId"}),{fromFolderId:i}=St({from:"/workspace/$workspaceId/templates/$templateId"}),{currentWorkspace:s}=Ce(),{t:o}=P(),{toast:n}=Te(),r=ke(),[c,d]=l.useState(!1),[m,b]=l.useState(!1),[v,g]=l.useState(!1),[p,f]=l.useState(!1),[j,u]=l.useState(!1),[h,D]=l.useState(!1),[I,K]=l.useState(null),[C,L]=l.useState(null),[q,X]=l.useState(!1),[N,Y]=l.useState(null),[O,oe]=l.useState(!1),[ge,fe]=l.useState(null),[he,ne]=l.useState(!1),[A,Ge]=l.useState(null),[Xe,Ae]=l.useState(!1),[Ye,Je]=l.useState(null),[ae,ie]=l.useState({open:!1,conflict:null,pendingTypeId:null}),{isSandboxActive:Ze,disableSandbox:et}=Et(),{highlightedTemplateId:be,highlightedVersionNumber:je,setHighlightedVersion:tt,clearHighlight:Ie}=It(),Ve=_t(),le=Kt(),Pe=qt(t),Le=Qt(t),st=Gt(t),rt=async a=>{await Ve.mutateAsync({templateId:t,data:{title:a}})},ot=async a=>{try{await le.mutateAsync({templateId:t,data:{documentTypeId:a}})}catch(y){if(y instanceof Ft){ie({open:!0,conflict:y.conflict,pendingTypeId:a});return}throw y}},nt=async()=>{if(ae.pendingTypeId)try{await le.mutateAsync({templateId:t,data:{documentTypeId:ae.pendingTypeId,force:!0}}),ie({open:!1,conflict:null,pendingTypeId:null})}catch(a){throw ie({open:!1,conflict:null,pendingTypeId:null}),a}},at=()=>{ie({open:!1,conflict:null,pendingTypeId:null})},{isTransitioning:it,direction:ve,startTransition:lt,endTransition:Fe}=Vt(),[He,Re]=l.useState(ve!=="forward"),[Hs,dt]=l.useState(!1);l.useEffect(()=>{if(ve==="forward"){const a=setTimeout(()=>{Re(!0),Fe()},50);return()=>clearTimeout(a)}},[ve,Fe]),l.useEffect(()=>{if(be===t&&je!==null){const a=setTimeout(()=>{Ie()},5e3);return()=>clearTimeout(a)}},[be,je,t,Ie]);const{data:x,isLoading:ct,error:mt}=Xt(t),ut=!!x,k=l.useMemo(()=>x!=null&&x.versions?x.versions.reduce((a,y)=>(a[y.status]=(a[y.status]||0)+1,a),{PUBLISHED:0,SCHEDULED:0,DRAFT:0,ARCHIVED:0}):{PUBLISHED:0,SCHEDULED:0,DRAFT:0,ARCHIVED:0},[x==null?void 0:x.versions]),[Z,de]=l.useState({PUBLISHED:!0,SCHEDULED:!0,DRAFT:!0,ARCHIVED:!0}),J=l.useMemo(()=>({PUBLISHED:Z.PUBLISHED&&k.PUBLISHED>0,SCHEDULED:Z.SCHEDULED&&k.SCHEDULED>0,DRAFT:Z.DRAFT&&k.DRAFT>0,ARCHIVED:Z.ARCHIVED&&k.ARCHIVED>0}),[Z,k]),ce=x==null?void 0:x.versions,Ne=l.useMemo(()=>{if(!ce||ce.length===0)return[];const a=ce.filter(w=>J[w.status]),y=w=>w.updatedAt?new Date(w.updatedAt).getTime():new Date(w.createdAt).getTime(),T=[],V=[],S=[],M=[];for(const w of a)w.status==="PUBLISHED"?T.push(w):w.status==="SCHEDULED"?V.push(w):w.status==="DRAFT"?S.push(w):w.status==="ARCHIVED"&&M.push(w);return V.sort((w,Q)=>{if(!w.scheduledPublishAt&&!Q.scheduledPublishAt)return 0;if(!w.scheduledPublishAt)return 1;if(!Q.scheduledPublishAt)return-1;const $=new Date(w.scheduledPublishAt).getTime(),W=new Date(Q.scheduledPublishAt).getTime();return isNaN($)||isNaN(W)?0:$-W}),S.sort((w,Q)=>{const $=y(w),W=y(Q);return isNaN($)||isNaN(W)?0:W-$}),M.sort((w,Q)=>{const $=y(w),W=y(Q);return isNaN($)||isNaN(W)?0:W-$}),[...T,...V,...S,...M]},[ce,J]),Ue=()=>{s&&!it&&(lt("backward"),dt(!0),Re(!1),setTimeout(()=>{r(i?{to:"/workspace/$workspaceId/documents",params:{workspaceId:s.id},search:i==="root"?void 0:{folderId:i}}:{to:"/workspace/$workspaceId/templates",params:{workspaceId:s.id}})},300))},ze=a=>{s&&r({to:"/workspace/$workspaceId/editor/$templateId/version/$versionId",params:{workspaceId:s.id,templateId:t,versionId:a}})},pt=()=>{!s||!(x!=null&&x.folderId)||r({to:"/workspace/$workspaceId/documents",params:{workspaceId:s.id},search:{folderId:x.folderId}})},xt=a=>{L(a),g(!0)},gt=a=>{L(a),f(!0)},ft=async()=>{var a,y;if(C)try{await Pe.mutateAsync(C.id),g(!1),L(null)}catch(T){if(ee.isAxiosError(T)&&((a=T.response)==null?void 0:a.status)===422){const V=(y=T.response.data)==null?void 0:y.validation;if(V){K(V),g(!1),D(!0);return}}throw T}},ht=async a=>{var y,T,V;if(C)try{await Le.mutateAsync({versionId:C.id,publishAt:a}),f(!1),L(null)}catch(S){if(ee.isAxiosError(S)&&((y=S.response)==null?void 0:y.status)===409&&S.response.data.error==="another version is already scheduled at this time"){n({variant:"destructive",title:o("templates.scheduleDialog.error.conflictTitle","Scheduling Conflict"),description:o("templates.scheduleDialog.error.conflictDescription","Another version is already scheduled at this time.")});return}if(ee.isAxiosError(S)&&((T=S.response)==null?void 0:T.status)===422){const M=(V=S.response.data)==null?void 0:V.validation;if(M){K(M),f(!1),D(!0);return}}throw S}},bt=a=>{Ge(a),ne(!0)},jt=a=>{fe(a),oe(!0)},vt=a=>{Y(a),X(!0)},Nt=a=>{L(a),u(!0)},yt=a=>{Je(a),Ae(!0)},wt=async(a,y)=>{var T,V;try{await st.mutateAsync({versionId:a.id,data:{name:y}}),n({title:o("templates.versions.renamed","Version renamed"),description:y})}catch(S){const M=ee.isAxiosError(S)&&((V=(T=S.response)==null?void 0:T.data)!=null&&V.error)?S.response.data.error:o("templates.versions.renameFailed","Failed to rename version");throw n({title:M,variant:"destructive"}),S}},Dt=a=>{var T;et(),u(!1),L(null);const y=((T=a.template)==null?void 0:T.id)??a.version.templateId;tt(y,a.version.versionNumber),a.template&&s?r({to:"/workspace/$workspaceId/templates/$templateId",params:{workspaceId:s.id,templateId:a.template.id}}):a.version.templateId!==t&&s&&r({to:"/workspace/$workspaceId/templates/$templateId",params:{workspaceId:s.id,templateId:a.version.templateId}})};return ct&&!ut?e.jsxs(me.div,{className:"flex h-full flex-1 flex-col bg-background",initial:{opacity:0},animate:{opacity:He?1:0},transition:{duration:.25,ease:"easeOut"},children:[e.jsxs("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:[e.jsx(ue,{className:"h-4 w-32"}),e.jsx(ue,{className:"mt-4 h-10 w-64"})]}),e.jsx("div",{className:"flex-1 px-4 pb-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"grid gap-8 lg:grid-cols-[1fr_1.5fr]",children:[e.jsx(ue,{className:"h-64"}),e.jsx(ue,{className:"h-96"})]})})]}):mt||!x?e.jsxs("div",{className:"flex h-full flex-1 flex-col items-center justify-center bg-background",children:[e.jsx("p",{className:"text-lg text-muted-foreground",children:o("templates.detail.notFound","Template not found")}),e.jsx("button",{onClick:Ue,className:"mt-4 text-sm text-foreground underline underline-offset-4 hover:no-underline",children:i?o("templates.detail.backToFolder","Back to Folder"):o("templates.detail.backToList","Back to Templates")})]}):e.jsxs(me.div,{className:"flex h-full flex-1 flex-col bg-background",initial:{opacity:0},animate:{opacity:He?1:0},transition:{duration:.25,ease:"easeOut"},children:[e.jsx("div",{className:"sticky top-0 z-40 h-0",children:e.jsx(At,{initial:!1,children:((Be=x.versions)==null?void 0:Be.some(a=>a.status==="PUBLISHED"))&&!x.documentTypeId&&e.jsx(me.div,{initial:{y:-40,opacity:0},animate:{y:0,opacity:1},exit:{y:-40,opacity:0},transition:{duration:.25,ease:"easeInOut"},children:e.jsxs("div",{className:"flex items-center gap-2 border-b border-warning/30 bg-warning-muted/60 px-6 py-2 dark:bg-warning-muted/50",children:[e.jsx(G,{className:"h-4 w-4 shrink-0 text-warning dark:text-warning-border"}),e.jsx("span",{className:"text-sm text-warning-foreground",children:o("templates.warnings.noDocumentTypeDescription")})]})},"no-type-warning")})}),e.jsxs("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:[e.jsxs("button",{onClick:Ue,className:"mb-4 flex items-center gap-2 font-mono text-[10px] uppercase tracking-widest text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(gs,{size:14}),i?o("templates.detail.backToFolder","Back to Folder"):o("templates.detail.backToList","Back to Templates")]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:o("templates.detail.header","Template Details")}),e.jsx(ws,{value:x.title,onSave:rt,isLoading:Ve.isPending,className:"font-display text-3xl font-light leading-tight tracking-tight text-foreground md:text-4xl"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"group flex h-12 items-center gap-2 rounded-none bg-foreground px-6 text-sm font-medium tracking-wide text-background shadow-lg shadow-muted transition-colors hover:bg-foreground/90",children:[e.jsx(fs,{size:20}),e.jsx("span",{children:o("templates.detail.createVersion","Create New Version")})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"grid gap-8 lg:grid-cols-[1fr_1.5fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-border bg-background p-6",children:[e.jsx("h2",{className:"mb-4 font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:o("templates.detail.metadata","Metadata")}),e.jsxs("dl",{className:"space-y-4",children:[x.folder&&e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(hs,{size:12}),o("templates.detail.folder","Folder")]}),e.jsx("dd",{children:e.jsx("button",{onClick:pt,className:"text-sm text-foreground underline-offset-2 hover:underline",children:x.folder.name})})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(qe,{size:12}),o("templates.detail.createdAt","Created")]}),e.jsx("dd",{className:"text-sm text-foreground",children:_e(x.createdAt)})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(we,{size:12}),o("templates.detail.updatedAt","Last Updated")]}),e.jsx("dd",{className:"text-sm text-foreground",children:_e(x.updatedAt)})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(ms,{size:12}),o("templates.detail.versionsCount","Versions")]}),e.jsx("dd",{className:"text-sm text-foreground",children:((Oe=x.versions)==null?void 0:Oe.length)??0})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(ps,{size:12}),o("templates.detail.documentType","Document Type"),e.jsxs(me.span,{animate:(Me=x.versions)!=null&&Me.some(a=>a.status==="PUBLISHED")&&!x.documentTypeId?{opacity:1,x:0,width:"auto",marginLeft:4}:{opacity:0,x:-20,width:0,marginLeft:0},transition:{duration:.2,ease:"easeInOut"},className:"inline-flex shrink-0 items-center gap-1 overflow-hidden border border-warning/50 bg-warning-muted/60 px-1.5 py-0.5 text-warning-foreground dark:border-warning-border dark:bg-warning-muted/50",children:[e.jsx(G,{size:10,className:"shrink-0"}),e.jsx("span",{className:"whitespace-nowrap font-mono text-[9px] uppercase tracking-widest",children:o("templates.warnings.noDocumentType")})]})]}),e.jsx("dd",{children:e.jsx(Yt,{currentTypeId:x.documentTypeId,currentTypeName:x.documentTypeName,onAssign:ot,disabled:le.isPending})})]})]})]}),e.jsxs("div",{className:"border border-border bg-background p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:o("templates.detail.tags","Tags")}),e.jsx("button",{onClick:()=>b(!0),className:"text-muted-foreground transition-colors hover:text-foreground",title:o("templates.detail.editTags","Edit tags"),children:e.jsx(Se,{size:14})})]}),x.tags&&x.tags.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:x.tags.map(a=>e.jsx(Is,{tag:a},a.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:o("templates.detail.noTags","No tags")})]})]}),e.jsxs("div",{className:"border border-border bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border p-4",children:[e.jsx("h2",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:o("templates.detail.versionsSection","Version History")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsxs("button",{onClick:()=>de(a=>({...a,PUBLISHED:!a.PUBLISHED})),disabled:k.PUBLISHED===0,className:E("flex items-center gap-1.5 rounded-sm border px-1.5 py-1 transition-colors",k.PUBLISHED===0?"cursor-not-allowed border-border bg-background text-muted-foreground opacity-30":J.PUBLISHED?"border-success-border/50 bg-success-muted text-success":"border-border bg-background text-muted-foreground opacity-50 hover:opacity-75"),children:[e.jsx(cs,{size:14}),e.jsx("span",{className:"font-mono text-[10px]",children:k.PUBLISHED})]})}),e.jsx(re,{side:"bottom",className:"font-mono text-xs",children:o("templates.detail.filters.published","Publicadas")})]}),e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsxs("button",{onClick:()=>de(a=>({...a,SCHEDULED:!a.SCHEDULED})),disabled:k.SCHEDULED===0,className:E("flex items-center gap-1.5 rounded-sm border px-1.5 py-1 transition-colors",k.SCHEDULED===0?"cursor-not-allowed border-border bg-background text-muted-foreground opacity-30":J.SCHEDULED?"border-info-border/50 bg-info-muted text-info":"border-border bg-background text-muted-foreground opacity-50 hover:opacity-75"),children:[e.jsx(we,{size:14}),e.jsx("span",{className:"font-mono text-[10px]",children:k.SCHEDULED})]})}),e.jsx(re,{side:"bottom",className:"font-mono text-xs",children:o("templates.detail.filters.scheduled","Agendadas")})]}),e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsxs("button",{onClick:()=>de(a=>({...a,DRAFT:!a.DRAFT})),disabled:k.DRAFT===0,className:E("flex items-center gap-1.5 rounded-sm border px-1.5 py-1 transition-colors",k.DRAFT===0?"cursor-not-allowed border-border bg-background text-muted-foreground opacity-30":J.DRAFT?"border-warning-border/50 bg-warning-muted text-warning-foreground":"border-border bg-background text-muted-foreground opacity-50 hover:opacity-75"),children:[e.jsx(ye,{size:14}),e.jsx("span",{className:"font-mono text-[10px]",children:k.DRAFT})]})}),e.jsx(re,{side:"bottom",className:"font-mono text-xs",children:o("templates.detail.filters.draft","Borradores")})]}),e.jsxs(te,{children:[e.jsx(se,{asChild:!0,children:e.jsxs("button",{onClick:()=>de(a=>({...a,ARCHIVED:!a.ARCHIVED})),disabled:k.ARCHIVED===0,className:E("flex items-center gap-1.5 rounded-sm border px-1.5 py-1 transition-colors",k.ARCHIVED===0?"cursor-not-allowed border-border bg-background text-muted-foreground opacity-30":J.ARCHIVED?"border-muted-foreground/30 bg-muted text-muted-foreground":"border-border bg-background text-muted-foreground opacity-50 hover:opacity-75"),children:[e.jsx(De,{size:14}),e.jsx("span",{className:"font-mono text-[10px]",children:k.ARCHIVED})]})}),e.jsx(re,{side:"bottom",className:"font-mono text-xs",children:o("templates.detail.filters.archived","Archivadas")})]})]}),e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground",children:o("templates.detail.versionsTotal","{{count}} version(s)",{count:Ne.length})})]})]}),Ne.length>0?e.jsx("div",{className:"divide-y divide-border",children:Ne.map(a=>e.jsx(Ls,{version:a,onOpenEditor:ze,onPublish:xt,onSchedule:gt,onCancelSchedule:bt,onArchive:jt,onDelete:vt,onPromote:Nt,onClone:yt,onRename:wt,isSandboxMode:Ze,isHighlighted:be===t&&a.versionNumber===je},a.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ye,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o("templates.detail.noVersions","No versions yet")}),e.jsx("button",{onClick:()=>d(!0),className:"mt-4 text-sm text-foreground underline underline-offset-4 hover:no-underline",children:o("templates.detail.createFirstVersion","Create first version")})]})]})]})}),e.jsx(Ns,{open:c,onOpenChange:d,templateId:t}),e.jsx(Ds,{open:m,onOpenChange:b,templateId:t,currentTags:x.tags??[]}),e.jsx(Ss,{open:v,onOpenChange:g,version:C,onConfirm:ft,isLoading:Pe.isPending}),e.jsx(As,{open:p,onOpenChange:f,version:C,onConfirm:ht,isLoading:Le.isPending}),e.jsx(Vs,{open:h,onOpenChange:D,validation:I,onOpenEditor:C?()=>ze(C.id):void 0}),e.jsx(ys,{open:q,onOpenChange:X,version:N,templateId:t}),e.jsx(bs,{open:O,onOpenChange:oe,version:ge,templateId:t}),e.jsx(js,{open:he,onOpenChange:ne,version:A,templateId:t}),e.jsx(Ts,{open:j,onOpenChange:u,version:C,templateId:t,onSuccess:Dt}),e.jsx(vs,{open:Xe,onOpenChange:Ae,templateId:t,sourceVersion:Ye}),e.jsx(Jt,{open:ae.open,conflictTemplate:ae.conflict,onCancel:at,onForce:nt,isLoading:le.isPending})]})}const dr=Fs;export{dr as component};
