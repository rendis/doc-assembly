import{j as e,ah as P,r as t,x as F}from"./index-fKaFifWB.js";import{u as T,a as j,D as V,P as L,b as w,e as $,i as M,S as U,c as W}from"./document-import-VQ6j4sXg.js";import{B as C}from"./button-dNu0h4YU.js";import"./tabs-BREKaaVO.js";import"./label-CUbdgxCI.js";import"./dropdown-menu-Dju4gITJ.js";import"./i18n-CgYYcOID.js";import"./checkbox-ED_ecBkm.js";import{D as _,d as q,e as z,a as B,b as G,f as H}from"./dialog-9nhh7mvL.js";import{S as O}from"./scroll-area-B0sqHBmx.js";import{u as k}from"./useTranslation-D0qa437J.js";import{C as N}from"./circle-alert-DMx-c1KX.js";import{T as b}from"./triangle-alert-Di5g5Wop.js";import{b as S}from"./send-D4-EfYh9.js";import{A as Z}from"./arrow-left-DWWoMVQm.js";import"./index-Bz2JvSB8.js";import"./index-BGxMZ4Dx.js";import"./file-text-9wfbuSTS.js";import"./download-BkqsP3n5.js";import"./chevron-left-B9Sdd2C1.js";import"./chevron-right-BnYhLX46.js";import"./badge-B1W1bTxV.js";import"./chevron-down-DzxdpjNN.js";import"./plus-s7EU9lJN.js";import"./trash-2-CCOxSVLr.js";import"./eye-Cj0bTMKj.js";import"./Combination-C5nVb5De.js";import"./list-DU_LFEgA.js";import"./ellipsis-BFuWo1Dd.js";import"./variable-CoGkBFiT.js";import"./square-check-big-D50ND9hH.js";import"./pencil-H1WR5f29.js";import"./calendar-CUaXafub.js";import"./refresh-cw-CEr4BPZY.js";import"./search-DDi9d-Bq.js";import"./arrow-right-BUe0zEcb.js";import"./layers-BInfCQBw.js";import"./info-DKNJqB_Z.js";import"./arrow-up-right-BqKNCxRd.js";import"./flask-conical-CPX_RHGe.js";import"./folder-open-CLELnnBv.js";import"./power-C40xL1wA.js";import"./square-pen-Cq5HfgCc.js";import"./trash-D4z_LFH8.js";function J({open:u,onOpenChange:a,validation:r,onConfirm:x}){const{t:g}=k(),o=r.errors.length>0,i=r.warnings.length>0;return e.jsx(_,{open:u,onOpenChange:a,children:e.jsxs(q,{className:"max-w-2xl max-h-[80vh]",children:[e.jsxs(z,{children:[e.jsx(B,{className:"flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-5 w-5 text-destructive"}),"Errores de Validaci贸n"]}):i?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-5 w-5 text-warning"}),"Advertencias de Importaci贸n"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-5 w-5 text-success"}),"Validaci贸n Exitosa"]})}),e.jsx(G,{children:o?"El documento tiene errores cr铆ticos que deben corregirse antes de importar.":i?"El documento tiene advertencias no cr铆ticas. Puedes importarlo de todas formas.":"El documento es v谩lido y est谩 listo para importar."})]}),e.jsx(O,{className:"max-h-[60vh]",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[o&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold text-destructive flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),"Errores (",r.errors.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.errors.map((s,c)=>e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:s.message}),s.path&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:["Ubicaci贸n: ",s.path]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["C贸digo: ",s.code]})]})]})},c))})]}),i&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold text-yellow-600 flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),"Advertencias (",r.warnings.length,")"]}),e.jsx("div",{className:"space-y-2",children:r.warnings.map((s,c)=>e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-700 dark:text-yellow-400",children:s.message}),s.path&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 font-mono",children:["Ubicaci贸n: ",s.path]}),s.suggestion&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[" ",s.suggestion]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["C贸digo: ",s.code]})]})]})},c))})]}),!o&&!i&&e.jsx("div",{className:"p-4 bg-success-muted border border-success-border rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-success"}),e.jsx("p",{className:"text-sm text-success-foreground",children:"El documento pas贸 todas las validaciones correctamente."})]})})]})}),e.jsxs(H,{className:"gap-2",children:[e.jsx(C,{variant:"outline",onClick:()=>a(!1),children:o?"Cerrar":"Cancelar"}),!o&&e.jsx(C,{onClick:x,children:i?"Importar de todas formas":"Importar"})]})]})})}function We(){const{workspaceId:u,versionId:a}=P.useParams(),{t:r}=k(),[x,g]=t.useState(!1),{variables:o}=T(),[i,s]=t.useState(!1),[c,v]=t.useState(null),m=t.useRef(null);t.useEffect(()=>{j.setState({pageSize:L.A4,margins:V})},[]);const p=t.useRef("<p>Comienza a escribir tu documento aqui...</p>"),y=t.useCallback(n=>{p.current=n},[]),E=t.useCallback(async()=>{g(!0);try{console.log("Saving content for version:",a),console.log("Content:",p.current),await new Promise(n=>setTimeout(n,500))}finally{g(!1)}},[a]),I=t.useCallback(()=>{if(!m.current)return;const n=m.current,h=j.getState(),d=w.getState(),f={pagination:h,signerRoles:d.roles,workflowConfig:d.workflowConfig},l={title:`Version ${a}`,language:"es"},A=`documento-${a}-${Date.now()}.json`;$(n,f,l,A)},[a]),D=t.useCallback(async()=>{if(!m.current)return;const n=m.current,h=j.getState(),d=w.getState(),f={pagination:h,setSignerRoles:d.setRoles,setWorkflowConfig:d.setWorkflowConfig},l=await M(n,f,o,{validateReferences:!0,autoMigrate:!0});if(l){if(l.validation.errors.length>0||l.validation.warnings.length>0){v(l),s(!0);return}n&&(p.current=n.getHTML())}},[o]),R=t.useCallback(()=>{s(!1),v(null)},[]);return e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-2 border-b bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{to:"/workspace/$workspaceId/templates",params:{workspaceId:u},children:e.jsxs("button",{className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground flex items-center",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),r("common.back")]})}),e.jsxs("span",{className:"text-sm text-muted-foreground font-mono",children:["Version: ",a]})]}),e.jsxs("button",{onClick:E,disabled:x,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50 flex items-center",children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),r(x?"common.saving":"common.save")]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(W,{initialContent:p.current,onContentChange:y,variables:o,onExport:I,onImport:D,editorRef:m},"editor")}),c&&e.jsx(J,{open:i,onOpenChange:s,validation:c.validation,onConfirm:R})]})}export{We as component};
