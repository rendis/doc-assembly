import{U as D,r as p,j as e,d as R,L,F as V,u as G,b as $}from"./index-BVcXaeV0.js";import{S as g}from"./skeleton-DdPSBOPn.js";import{S as m,a as H}from"./SigningStatusBadge-Bcub1O40.js";import{s as E,a as X,u as q,d as K,b as Q}from"./useSigningDocuments-L8rrqa_n.js";import{B as J}from"./badge-q-sRk8nf.js";import{u as f}from"./useTranslation--JTkVOXT.js";import{a as W,C as Y}from"./chevron-right-BdPLJ7ep.js";import{a as Z,C as v,b as j,S as k,E as T}from"./send-3GdfNjzn.js";import{u as ee}from"./useMutation-SYhjC3hS.js";import{A as I,D as te}from"./download-CO5qPzgZ.js";import{T as A}from"./triangle-alert-BqckTpaw.js";import{R as U,B as se}from"./refresh-cw-BcxLymW3.js";import{C as P,L as re}from"./layers-cJZ0NmUP.js";import{F as ne}from"./file-text-Cig1Dfih.js";import{D as oe,d as ie,e as ae,a as de,b as le,f as ce}from"./dialog-hKy3EhX6.js";import{A as me}from"./arrow-left-DWc5mqqE.js";import{C as xe}from"./calendar-CIB8Udti.js";import{C as ue}from"./chevron-down-YhwoigdT.js";import"./Combination-BxN-rzwS.js";const ge={PENDING:{label:"Pending",className:"bg-muted text-muted-foreground"},SENT:{label:"Sent",className:"bg-yellow-500/10 text-yellow-600 dark:text-yellow-400"},DELIVERED:{label:"Delivered",className:"bg-blue-500/10 text-blue-600 dark:text-blue-400"},SIGNED:{label:"Signed",className:"bg-green-500/10 text-green-600 dark:text-green-400"},DECLINED:{label:"Declined",className:"bg-red-500/10 text-red-600 dark:text-red-400"}};function pe({status:r}){const i=ge[r]??{label:r,className:"bg-muted text-muted-foreground"};return e.jsx(J,{className:R("border-transparent font-mono text-[10px] uppercase tracking-wider",i.className),children:i.label})}function fe(r){return r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function be({documentId:r,recipients:i}){const{t}=f(),{toast:d}=D(),[l,s]=p.useState(null),c=async n=>{try{const a=await E.getSigningURL(r,n);await navigator.clipboard.writeText(a.signingUrl),s(n),d({title:t("signing.detail.urlCopied","Signing URL copied to clipboard")}),setTimeout(()=>s(null),2e3)}catch{d({variant:"destructive",title:t("common.error","Error"),description:t("signing.detail.urlCopyError","Failed to copy signing URL")})}};return i.length===0?e.jsx("p",{className:"py-6 text-center text-sm text-muted-foreground",children:t("signing.detail.noRecipients","No recipients")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-border py-3 pl-4 pr-4 text-left font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.recipientName","Name")}),e.jsx("th",{className:"border-b border-border py-3 pr-4 text-left font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.recipientEmail","Email")}),e.jsx("th",{className:"border-b border-border py-3 pr-4 text-left font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.recipientRole","Role")}),e.jsx("th",{className:"border-b border-border py-3 pr-4 text-left font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.recipientStatus","Status")}),e.jsx("th",{className:"border-b border-border py-3 pr-4 text-left font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.recipientSignedAt","Signed At")}),e.jsx("th",{className:"border-b border-border py-3 pr-4 text-right font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.recipientActions","Actions")})]})}),e.jsx("tbody",{children:i.map(n=>e.jsxs("tr",{className:"transition-colors hover:bg-accent",children:[e.jsx("td",{className:"border-b border-border py-4 pl-4 pr-4 text-sm text-foreground",children:n.name}),e.jsx("td",{className:"border-b border-border py-4 pr-4 text-sm text-muted-foreground",children:n.email}),e.jsx("td",{className:"border-b border-border py-4 pr-4 text-sm text-foreground",children:n.roleName}),e.jsx("td",{className:"border-b border-border py-4 pr-4",children:e.jsx(pe,{status:n.status})}),e.jsx("td",{className:"border-b border-border py-4 pr-4 font-mono text-sm text-muted-foreground",children:fe(n.signedAt)}),e.jsx("td",{className:"border-b border-border py-4 pr-4 text-right",children:e.jsxs("button",{onClick:()=>c(n.id),className:"inline-flex items-center gap-1.5 rounded-none border border-border px-3 py-1.5 font-mono text-[10px] uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",title:t("signing.detail.copySigningUrl","Copy signing URL"),children:[l===n.id?e.jsx(W,{size:12}):e.jsx(Z,{size:12}),t("signing.detail.copyUrl","Copy URL")]})})]},n.id))})]})})}function he(r){return ee({queryKey:X.events(r),queryFn:()=>E.getEvents(r),enabled:!!r})}const Ne={DOCUMENT_CREATED:{icon:ne,label:"Document created",colorClass:"text-blue-500"},DOCUMENT_SENT:{icon:k,label:"Document sent to provider",colorClass:"text-blue-500"},RECIPIENT_SENT:{icon:k,label:"Sent to recipient",colorClass:"text-yellow-500"},RECIPIENT_DELIVERED:{icon:j,label:"Delivered to recipient",colorClass:"text-blue-500"},RECIPIENT_SIGNED:{icon:j,label:"Recipient signed",colorClass:"text-green-500"},RECIPIENT_DECLINED:{icon:v,label:"Recipient declined",colorClass:"text-red-500"},DOCUMENT_COMPLETED:{icon:j,label:"Document completed",colorClass:"text-green-500"},DOCUMENT_DECLINED:{icon:v,label:"Document declined",colorClass:"text-red-500"},DOCUMENT_VOIDED:{icon:se,label:"Document voided",colorClass:"text-muted-foreground"},DOCUMENT_EXPIRED:{icon:P,label:"Document expired",colorClass:"text-orange-500"},DOCUMENT_REFRESHED:{icon:U,label:"Document status refreshed",colorClass:"text-blue-500"},DOCUMENT_ERROR:{icon:A,label:"Error occurred",colorClass:"text-red-500"},STATUS_CHANGED:{icon:I,label:"Status changed",colorClass:"text-blue-500"}};function je(r){return new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function ve({documentId:r}){const{t:i}=f(),{data:t,isLoading:d}=he(r);if(d)return e.jsx("div",{className:"space-y-4 py-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-5 w-5 animate-pulse rounded-full bg-muted"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-48 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-32 animate-pulse rounded bg-muted"})]})]},s))});if(!t||t.length===0)return e.jsx("p",{className:"py-6 text-center text-sm text-muted-foreground",children:i("signing.detail.noEvents","No events recorded")});const l=[...t].sort((s,c)=>new Date(c.createdAt).getTime()-new Date(s.createdAt).getTime());return e.jsx("div",{className:"relative py-2",children:l.map((s,c)=>{const n=Ne[s.eventType]??{icon:I,label:s.eventType.replace(/_/g," ").toLowerCase(),colorClass:"text-muted-foreground"},a=n.icon,x=c===l.length-1;return e.jsxs("div",{className:"relative flex gap-3 pb-6 last:pb-0",children:[!x&&e.jsx("div",{className:"absolute left-[9px] top-6 h-full w-px bg-border"}),e.jsx("div",{className:R("relative z-10 flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-background",n.colorClass),children:e.jsx(a,{size:14})}),e.jsxs("div",{className:"flex-1 pt-0.5",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[n.label,s.oldStatus&&s.newStatus&&e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",s.oldStatus," â†’ ",s.newStatus,")"]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:je(s.createdAt)}),s.actorType&&e.jsx("span",{className:"rounded-sm border px-1 py-0.5 font-mono text-[10px] uppercase text-muted-foreground",children:s.actorType})]})]})]},s.id)})})}function De({open:r,onOpenChange:i,documentId:t,documentTitle:d,onSuccess:l}){const{t:s}=f(),{toast:c}=D(),n=q(),a=n.isPending,x=async()=>{try{await n.mutateAsync(t),c({title:s("signing.detail.cancelSuccess","Document cancelled")}),i(!1),l==null||l()}catch{c({variant:"destructive",title:s("common.error","Error"),description:s("signing.detail.cancelError","Failed to cancel document")})}};return e.jsx(oe,{open:r,onOpenChange:i,children:e.jsxs(ie,{className:"sm:max-w-md",children:[e.jsxs(ae,{children:[e.jsxs(de,{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-widest",children:[e.jsx(A,{size:18,className:"text-destructive"}),s("signing.detail.cancelTitle","Cancel Document")]}),e.jsx(le,{children:s("signing.detail.cancelConfirm",'Are you sure you want to cancel "{{title}}"?',{title:d})})]}),e.jsx("div",{className:"space-y-3 py-4",children:e.jsx("div",{className:"rounded-sm border border-destructive/30 bg-destructive/5 p-3",children:e.jsx("p",{className:"text-sm text-destructive",children:s("signing.detail.cancelWarning","This action cannot be undone. All pending signatures will be cancelled.")})})}),e.jsxs(ce,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",disabled:a,children:s("common.close","Close")}),e.jsxs("button",{type:"button",onClick:x,className:"inline-flex items-center gap-2 rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:a,children:[a&&e.jsx(L,{size:14,className:"animate-spin"}),s("signing.detail.cancelConfirmBtn","Cancel Document")]})]})]})})}const Ee=[m.COMPLETED,m.DECLINED,m.VOIDED,m.EXPIRED,m.ERROR];function S(r){return r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function ye(){const{documentId:r,workspaceId:i}=V({from:"/workspace/$workspaceId/signing/$documentId"}),{t}=f(),{toast:d}=D(),l=G(),{currentWorkspace:s}=$(),[c,n]=p.useState(!1),[a,x]=p.useState(!1),[y,C]=p.useState(!1),{data:o,isLoading:O,error:_}=K(r),b=Q(),h=()=>{const N=(s==null?void 0:s.id)??i;l({to:"/workspace/$workspaceId/signing",params:{workspaceId:N}})},z=async()=>{try{await b.mutateAsync(r),d({title:t("signing.detail.refreshed","Document status refreshed")})}catch{d({variant:"destructive",title:t("common.error","Error"),description:t("signing.detail.refreshError","Failed to refresh document status")})}},F=async()=>{C(!0);try{const N=await E.downloadPDF(r),w=URL.createObjectURL(N),u=window.document.createElement("a");u.href=w,u.download=`${(o==null?void 0:o.title)??"document"}.pdf`,window.document.body.appendChild(u),u.click(),window.document.body.removeChild(u),URL.revokeObjectURL(w)}catch{d({variant:"destructive",title:t("common.error","Error"),description:t("signing.detail.downloadError","Failed to download PDF")})}finally{C(!1)}},M=o?Ee.includes(o.status):!1,B=(o==null?void 0:o.status)===m.COMPLETED;return O?e.jsxs("div",{className:"flex h-full flex-1 flex-col bg-background",children:[e.jsxs("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:[e.jsx(g,{className:"h-4 w-32"}),e.jsx(g,{className:"mt-4 h-10 w-64"})]}),e.jsx("div",{className:"flex-1 px-4 pb-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"grid gap-8 lg:grid-cols-[1fr_2fr]",children:[e.jsx(g,{className:"h-48"}),e.jsx(g,{className:"h-64"})]})})]}):_||!o?e.jsxs("div",{className:"flex h-full flex-1 flex-col items-center justify-center bg-background",children:[e.jsx("p",{className:"text-lg text-muted-foreground",children:t("signing.detail.notFound","Document not found")}),e.jsx("button",{onClick:h,className:"mt-4 text-sm text-foreground underline underline-offset-4 hover:no-underline",children:t("signing.detail.backToList","Back to Signing")})]}):e.jsxs("div",{className:"flex h-full flex-1 flex-col bg-background",children:[e.jsxs("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:[e.jsxs("button",{onClick:h,className:"mb-4 flex items-center gap-2 font-mono text-[10px] uppercase tracking-widest text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(me,{size:14}),t("signing.detail.backToList","Back to Signing")]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("signing.detail.header","Signing Document")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"font-display text-3xl font-light leading-tight tracking-tight text-foreground md:text-4xl",children:o.title}),e.jsx(H,{status:o.status})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:z,disabled:b.isPending,className:"inline-flex items-center gap-2 rounded-none border border-border px-4 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:[e.jsx(U,{size:14,className:b.isPending?"animate-spin":""}),t("signing.detail.refresh","Refresh")]}),B&&e.jsxs("button",{onClick:F,disabled:y,className:"inline-flex items-center gap-2 rounded-none bg-foreground px-4 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:[y?e.jsx(L,{size:14,className:"animate-spin"}):e.jsx(te,{size:14}),t("signing.detail.downloadPdf","Download PDF")]}),!M&&e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center gap-2 rounded-none bg-destructive px-4 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90",children:[e.jsx(v,{size:14}),t("signing.detail.cancel","Cancel")]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"grid gap-8 lg:grid-cols-[1fr_2fr]",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border border-border bg-background p-6",children:[e.jsx("h2",{className:"mb-4 font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.metadata","Metadata")}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(re,{size:12}),t("signing.detail.templateVersion","Template Version")]}),e.jsx("dd",{className:"font-mono text-sm text-foreground",children:o.templateVersionId})]}),o.clientExternalReferenceId&&e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(T,{size:12}),t("signing.detail.externalRef","External Reference")]}),e.jsx("dd",{className:"font-mono text-sm text-foreground",children:o.clientExternalReferenceId})]}),o.signerProvider&&e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(T,{size:12}),t("signing.detail.provider","Provider")]}),e.jsx("dd",{children:e.jsx("span",{className:"rounded-sm border px-1.5 py-0.5 font-mono text-[10px] uppercase text-muted-foreground",children:o.signerProvider})})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(xe,{size:12}),t("signing.detail.createdAt","Created")]}),e.jsx("dd",{className:"text-sm text-foreground",children:S(o.createdAt)})]}),e.jsxs("div",{children:[e.jsxs("dt",{className:"mb-1 flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(P,{size:12}),t("signing.detail.updatedAt","Last Updated")]}),e.jsx("dd",{className:"text-sm text-foreground",children:S(o.updatedAt)})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-border bg-background",children:[e.jsx("div",{className:"border-b border-border p-4",children:e.jsxs("h2",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:[t("signing.detail.recipients","Recipients"),e.jsxs("span",{className:"ml-2 text-foreground",children:["(",o.recipients.length,")"]})]})}),e.jsx(be,{documentId:r,recipients:o.recipients})]}),e.jsxs("div",{className:"border border-border bg-background",children:[e.jsxs("button",{onClick:()=>x(!a),className:"flex w-full items-center justify-between p-4 transition-colors hover:bg-accent",children:[e.jsx("h2",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:t("signing.detail.events","Event Log")}),a?e.jsx(ue,{size:16,className:"text-muted-foreground"}):e.jsx(Y,{size:16,className:"text-muted-foreground"})]}),a&&e.jsx("div",{className:"border-t border-border px-4 pb-4",children:e.jsx(ve,{documentId:r})})]})]})]})}),e.jsx(De,{open:c,onOpenChange:n,documentId:r,documentTitle:o.title,onSuccess:h})]})}const $e=ye;export{$e as component};
