import{j as e,d as P,A as re,m as K,r as i,T as xt,k as gt,n as ft,a as O,t as R,X as Me,u as Pe,F as Ae,G as ht}from"./index-BVcXaeV0.js";import{u as Le,F as oe,a as ge,L as bt,I as jt,H as yt,b as ze,c as vt,d as Nt,r as Ct,D as wt,e as Dt,P as Ft}from"./label-oxXQINpu.js";import{u as F}from"./useTranslation--JTkVOXT.js";import{S as kt}from"./search-BDCQFqKF.js";import{C as Ie}from"./chevron-down-YhwoigdT.js";import{S as St,E as Tt}from"./square-check-big-BYCYQdJ-.js";import{L as It,G as Mt}from"./list-fe7yz50r.js";import{C as Pt,a as At}from"./chevron-right-BdPLJ7ep.js";import{D as Lt,a as zt,b as Ot,c as xe,d as qt}from"./dropdown-menu-BVASkqnj.js";import{P as Et}from"./pencil-WbeEh-p0.js";import{T as Oe}from"./trash-CzHzCeNC.js";import{T as qe}from"./triangle-alert-BqckTpaw.js";import{F as Ee}from"./file-text-Cig1Dfih.js";import{D as B,B as Kt,a as Q,b as W,c as Rt,d as _,e as J,f as ee}from"./dialog-hKy3EhX6.js";import{u as fe,a as V}from"./useMutation-SYhjC3hS.js";import{C as Vt}from"./CreateTemplateDialog-BpzkiztB.js";import{B as D}from"./button-C7lAKen3.js";import{S as $t}from"./scroll-area-BWP0ghgg.js";import{S as Bt}from"./skeleton-DdPSBOPn.js";import"./Combination-BxN-rzwS.js";import"./DocumentTypeConflictDialog-4R5Kz5Bz.js";import"./templates-api-BRIT9b1d.js";import"./plus-CnbEPYvD.js";import"./useDocumentTypes-CuStJnph.js";function Qt({viewMode:t,onViewModeChange:s,searchQuery:n,onSearchChange:l,onStartSelection:o,isSelecting:a=!1}){const{t:r}=F();return e.jsxs("div",{className:"flex shrink-0 flex-col justify-between gap-6 border-b border-border bg-background px-4 py-6 md:flex-row md:items-center md:px-6 lg:px-6",children:[e.jsxs("div",{className:"group relative w-full md:max-w-md",children:[e.jsx(kt,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:20}),e.jsx("input",{type:"text",placeholder:r("documents.searchPlaceholder","Search documents..."),value:n,onChange:u=>l(u.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-8 pr-4 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("button",{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx("span",{children:r("documents.filters.type","Type: All")}),e.jsx(Ie,{size:16})]}),e.jsxs("button",{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx("span",{children:r("documents.filters.sort","Sort: Newest")}),e.jsx(Ie,{size:16})]}),e.jsxs("div",{className:"ml-2 flex items-center gap-2 border-l border-border pl-6",children:[o&&!a&&e.jsx("button",{onClick:o,className:"mr-2 text-muted-foreground/50 transition-colors hover:text-muted-foreground",title:r("folders.selection.start","Select items"),children:e.jsx(St,{size:20})}),e.jsx("button",{onClick:()=>s("list"),className:P("transition-colors",t==="list"?"text-foreground":"text-muted-foreground/50 hover:text-muted-foreground"),children:e.jsx(It,{size:20})}),e.jsx("button",{onClick:()=>s("grid"),className:P("transition-colors",t==="grid"?"text-foreground":"text-muted-foreground/50 hover:text-muted-foreground"),children:e.jsx(Mt,{size:20})})]})]})]})}const Wt={initial:{opacity:0,x:-8},animate:{opacity:1,x:0,transition:{duration:.2,ease:"easeOut"}},exit:{opacity:0,x:-8,transition:{duration:.15}}};function Gt({items:t,onNavigate:s}){return e.jsx("nav",{className:"flex items-center gap-2 py-6 font-mono text-sm text-muted-foreground",children:e.jsx(re,{mode:"popLayout",initial:!1,children:t.map((n,l)=>e.jsxs(K.div,{className:"contents",children:[l>0&&e.jsx(K.span,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},children:e.jsx(Pt,{size:14,className:"text-muted-foreground/50"})}),e.jsx(K.div,{layout:!0,variants:Wt,initial:"initial",animate:"animate",exit:"exit",children:e.jsx(Ht,{id:n.id,label:n.label,isActive:n.isActive,onNavigate:s})})]},n.id??"root"))})})}function Ht({id:t,label:s,isActive:n,onNavigate:l}){var k,C,y,h,f,M;const{setNodeRef:o,isOver:a,active:r}=Le({id:`breadcrumb-${t??"root"}`,data:{type:"breadcrumb",folderId:t}}),u=((k=r==null?void 0:r.data.current)==null?void 0:k.type)==="folder",m=((C=r==null?void 0:r.data.current)==null?void 0:C.type)==="template",c=(h=(y=r==null?void 0:r.data.current)==null?void 0:y.folder)==null?void 0:h.parentId,p=(M=(f=r==null?void 0:r.data.current)==null?void 0:f.template)==null?void 0:M.folderId,b=u&&c!==t&&!n||m&&p!==t&&!n;return n?e.jsx("span",{ref:o,className:"border-b border-foreground font-medium text-foreground",children:s}):e.jsx("button",{ref:o,onClick:()=>l(t),className:P("cursor-pointer border-none bg-transparent px-2 py-1 transition-all hover:text-foreground",a&&b&&"rounded bg-primary/10 text-primary ring-2 ring-primary"),children:s})}function Ut({children:t,onRename:s,onMove:n,onDelete:l}){const{t:o}=F();return e.jsxs(Lt,{children:[e.jsx(zt,{asChild:!0,children:t}),e.jsxs(Ot,{align:"end",children:[e.jsxs(xe,{onClick:s,children:[e.jsx(Et,{className:"mr-2 h-4 w-4"}),o("folders.actions.rename","Rename")]}),e.jsxs(xe,{onClick:n,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),o("folders.actions.move","Move to...")]}),e.jsx(qt,{}),e.jsxs(xe,{onClick:l,className:"text-destructive focus:text-destructive",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),o("folders.actions.delete","Delete")]})]})]})}const Ke=i.createContext(null);function Xt({children:t}){const[s,n]=i.useState(new Set),[l,o]=i.useState(!1),a=i.useCallback(g=>{n(j=>{const b=new Set(j);return b.has(g)?b.delete(g):b.add(g),b})},[]),r=i.useCallback(g=>{n(new Set(g))},[]),u=i.useCallback(()=>{n(new Set)},[]),m=i.useCallback(()=>{o(!0)},[]),c=i.useCallback(()=>{o(!1),n(new Set)},[]),p=i.useCallback(g=>s.has(g),[s]);return e.jsx(Ke.Provider,{value:{selectedIds:s,isSelecting:l,toggleSelection:a,selectAll:r,clearSelection:u,startSelecting:m,stopSelecting:c,isSelected:p},children:t})}function he(){const t=i.useContext(Ke);if(!t)throw new Error("useFolderSelection must be used within FolderSelectionProvider");return t}function Yt({folder:t,onClick:s,onRename:n,onMove:l,onDelete:o}){const{t:a}=F(),{isSelecting:r,isSelected:u,toggleSelection:m}=he(),c=u(t.id),p=()=>{r?m(t.id):s==null||s()},g=j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),p())};return e.jsxs("div",{role:"button",tabIndex:0,onClick:p,onKeyDown:g,className:P("group relative flex cursor-pointer flex-col gap-8 border border-border bg-background p-6 transition-colors hover:border-foreground",c&&"border-primary bg-primary/5"),children:[r&&e.jsx("div",{className:P("absolute left-3 top-3 flex h-5 w-5 items-center justify-center border transition-colors",c?"border-primary bg-primary text-primary-foreground":"border-muted-foreground"),children:c&&e.jsx(At,{size:14})}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(ge,{className:"text-muted-foreground transition-colors group-hover:text-foreground",size:32,strokeWidth:1}),!r&&(n||l||o)&&e.jsx(Ut,{onRename:()=>n==null?void 0:n(),onMove:()=>l==null?void 0:l(),onDelete:()=>o==null?void 0:o(),children:e.jsx("button",{className:"text-muted-foreground hover:text-foreground",onClick:j=>j.stopPropagation(),"aria-label":"Folder options",children:e.jsx(Tt,{size:20})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-1 font-display text-lg font-medium text-foreground decoration-1 underline-offset-4 group-hover:underline",children:t.name}),e.jsxs("p",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:[t.childFolderCount>0&&e.jsxs("span",{children:[t.childFolderCount," ",a("folders.stats.folders",{count:t.childFolderCount,defaultValue:t.childFolderCount===1?"folder":"folders"})]}),t.childFolderCount>0&&t.templateCount>0&&e.jsx("span",{className:"mx-1",children:"·"}),t.templateCount>0&&e.jsxs("span",{children:[t.templateCount," ",a("folders.stats.templates",{count:t.templateCount,defaultValue:t.templateCount===1?"template":"templates"})]}),t.childFolderCount===0&&t.templateCount===0&&e.jsx("span",{children:a("folders.stats.empty","Empty")})]})]})]})}function Zt({template:t,onClick:s}){const{t:n}=F(),l=t.hasPublishedVersion&&!t.documentTypeCode,o=a=>new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{role:"button",tabIndex:0,onClick:s,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),s==null||s())},className:`group relative flex cursor-pointer flex-col gap-3 border border-border bg-background p-5 transition-colors hover:border-foreground ${l?"border-l-2 border-l-warning bg-warning-muted/60 dark:border-l-warning-border dark:bg-warning-muted/50":""}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[l?e.jsxs(xt,{children:[e.jsx(gt,{asChild:!0,children:e.jsx(qe,{className:"mt-0.5 shrink-0 text-warning-foreground",size:20,strokeWidth:1.5})}),e.jsx(ft,{side:"top",className:"max-w-xs",children:n("templates.warnings.noDocumentTypeDescription")})]}):e.jsx(Ee,{className:"mt-0.5 shrink-0 text-muted-foreground transition-colors group-hover:text-foreground",size:20,strokeWidth:1.5}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"truncate font-display text-base font-medium leading-snug text-foreground decoration-1 underline-offset-4 group-hover:underline",children:t.title}),e.jsx("span",{className:"shrink-0 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t.hasPublishedVersion?n("templates.status.published","Published"):n("templates.status.draft","Draft")})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 pl-8 text-muted-foreground",children:[t.tags&&t.tags.length>0&&e.jsxs(e.Fragment,{children:[t.tags.slice(0,2).map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1 font-mono text-[10px]",children:[e.jsx("span",{className:"h-1.5 w-1.5 shrink-0 rounded-full",style:{backgroundColor:a.color}}),a.name]},a.id)),t.tags.length>2&&e.jsxs("span",{className:"font-mono text-[10px]",children:["+",t.tags.length-2]}),e.jsx("span",{className:"text-[10px]",children:"·"})]}),e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-widest",children:o(t.updatedAt??t.createdAt)})]})]})}async function _t(){return(await O.get("/workspace/folders")).data}async function Jt(){return(await O.get("/workspace/folders/tree")).data}async function es(t){return(await O.post("/workspace/folders",t)).data}async function ts(t,s){return(await O.put(`/workspace/folders/${t}`,s)).data}async function Re(t){await O.delete(`/workspace/folders/${t}`)}async function Ve(t,s){return(await O.patch(`/workspace/folders/${t}/move`,{newParentId:s.parentId})).data}async function ss(t){await Promise.all(t.map(s=>Re(s)))}async function ns(t,s){return await Promise.all(t.map(l=>Ve(l,{parentId:s})))}const w={all:["folders"],lists:()=>[...w.all,"list"],list:t=>[...w.lists(),t],trees:()=>[...w.all,"tree"],tree:t=>[...w.trees(),t]};function rs(t){return fe({queryKey:w.list(t??""),queryFn:_t,enabled:!!t,staleTime:0,gcTime:0})}function $e(t){return fe({queryKey:w.tree(t??""),queryFn:Jt,enabled:!!t,staleTime:0,gcTime:0})}function os(){const t=R();return V({mutationFn:s=>es(s),onSuccess:()=>{t.invalidateQueries({queryKey:w.all})}})}function as(){const t=R();return V({mutationFn:({folderId:s,data:n})=>ts(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:w.all})}})}function ls(){const t=R();return V({mutationFn:s=>Re(s),onSuccess:()=>{t.invalidateQueries({queryKey:w.all})}})}function Be(){const t=R();return V({mutationFn:({folderId:s,data:n})=>Ve(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:w.all})}})}function is(){const t=R();return V({mutationFn:s=>ss(s),onSuccess:()=>{t.invalidateQueries({queryKey:w.all})}})}function ds(){const t=R();return V({mutationFn:({folderIds:s,newParentId:n})=>ns(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:w.all})}})}function cs({open:t,onOpenChange:s,parentId:n}){const{t:l}=F(),[o,a]=i.useState(""),r=os(),u=i.useCallback(c=>{c||a(""),s(c)},[s]),m=async c=>{if(c.preventDefault(),!!o.trim())try{await r.mutateAsync({name:o.trim(),parentId:n??void 0}),u(!1)}catch{}};return e.jsx(B,{open:t,onOpenChange:u,children:e.jsxs(Kt,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(Q,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:l("folders.createDialog.title","New Folder")}),e.jsx(W,{className:"mt-1 text-sm font-light text-muted-foreground",children:l("folders.createDialog.description","Create a new folder to organize your templates")})]}),e.jsxs(Rt,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(Me,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:m,children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"folder-name",className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:l("folders.createDialog.nameLabel","Name")}),e.jsx("input",{id:"folder-name",type:"text",value:o,onChange:c=>a(c.target.value),placeholder:l("folders.createDialog.namePlaceholder","Enter folder name..."),maxLength:255,autoFocus:!0,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),disabled:r.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:l("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!o.trim()||r.isPending,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:r.isPending?l("common.creating","Creating..."):l("folders.createDialog.submit","Create Folder")})]})]})]})})}function us({open:t,onOpenChange:s,folder:n}){const{t:l}=F(),[o,a]=i.useState(""),r=as(),u=i.useCallback(p=>{p&&n&&a(n.name),s(p)},[s,n]),m=async p=>{if(p.preventDefault(),!(!o.trim()||!n))try{await r.mutateAsync({folderId:n.id,data:{name:o.trim()}}),s(!1)}catch{}},c=n&&o.trim()!==n.name;return e.jsx(B,{open:t,onOpenChange:u,children:e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsx(Q,{children:l("folders.renameDialog.title","Rename Folder")}),e.jsx(W,{children:l("folders.renameDialog.description","Enter a new name for this folder.")})]}),e.jsxs("form",{onSubmit:m,children:[e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(bt,{htmlFor:"folder-name",children:l("folders.renameDialog.nameLabel","Folder Name")}),e.jsx(jt,{id:"folder-name",value:o,onChange:p=>a(p.target.value),placeholder:l("folders.renameDialog.namePlaceholder","Enter folder name..."),maxLength:255,autoFocus:!0})]})}),e.jsxs(ee,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>s(!1),children:l("common.cancel","Cancel")}),e.jsx(D,{type:"submit",disabled:!o.trim()||!c||r.isPending,children:r.isPending?l("common.saving","Saving..."):l("common.save","Save")})]})]})]})})}function ms({open:t,onOpenChange:s,folderIds:n,folderNames:l=[],onSuccess:o}){const{t:a}=F(),r=ls(),u=is(),m=n.length===1,c=r.isPending||u.isPending,p=async()=>{if(n.length!==0)try{m&&n[0]?await r.mutateAsync(n[0]):await u.mutateAsync(n),s(!1),o==null||o()}catch{}},g=m?l[0]||a("folders.deleteDialog.thisFolder","this folder"):a("folders.deleteDialog.multipleFolders","{{count}} folders",{count:n.length});return e.jsx(B,{open:t,onOpenChange:s,children:e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-destructive"}),a("folders.deleteDialog.title","Delete Folder")]}),e.jsxs(W,{className:"space-y-2",children:[e.jsx("span",{children:a("folders.deleteDialog.confirmMessage","Are you sure you want to delete {{name}}?",{name:g})}),e.jsx("span",{className:"block text-destructive",children:a("folders.deleteDialog.warning","This will also delete all subfolders and documents inside. This action cannot be undone.")})]})]}),e.jsxs(ee,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>s(!1),children:a("common.cancel","Cancel")}),e.jsx(D,{variant:"destructive",onClick:p,disabled:c,children:c?a("common.deleting","Deleting..."):a("common.delete","Delete")})]})]})})}function ps({open:t,onOpenChange:s,folderIds:n,workspaceId:l,onSuccess:o}){const{t:a}=F(),{data:r}=$e(l),u=Be(),m=ds(),[c,p]=i.useState(null),g=i.useCallback(h=>{h&&p(null),s(h)},[s]),j=async()=>{if(n.length!==0)try{n.length===1&&n[0]?await u.mutateAsync({folderId:n[0],data:{parentId:c}}):await m.mutateAsync({folderIds:n,newParentId:c}),s(!1),o==null||o()}catch{}},b=h=>h.filter(f=>!n.includes(f.id)).map(f=>({...f,children:b(f.children||[])})),k=r?b(r):[],C=(h,f=0)=>{var M;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>p(h.id),className:P("flex w-full items-center gap-2 px-3 py-2 text-sm transition-colors hover:bg-muted",c===h.id&&"bg-muted"),style:{paddingLeft:`${12+f*16}px`},children:[e.jsx(ge,{size:16,className:"shrink-0"}),e.jsx("span",{className:"truncate",children:h.name})]}),(M=h.children)==null?void 0:M.map(G=>C(G,f+1))]},h.id)},y=u.isPending||m.isPending;return e.jsx(B,{open:t,onOpenChange:g,children:e.jsxs(_,{className:"max-w-md",children:[e.jsxs(J,{children:[e.jsx(Q,{children:a("folders.moveDialog.title","Move to Folder")}),e.jsx(W,{children:a("folders.moveDialog.description","Select a destination folder.")})]}),e.jsxs($t,{className:"h-[300px] rounded-md border",children:[e.jsxs("button",{onClick:()=>p(null),className:P("flex w-full items-center gap-2 px-3 py-2 text-sm transition-colors hover:bg-muted",c===null&&"bg-muted"),children:[e.jsx(yt,{size:16,className:"shrink-0"}),e.jsx("span",{children:a("folders.moveDialog.root","Root (No parent)")})]}),k.map(h=>C(h)),k.length===0&&e.jsx("div",{className:"px-3 py-4 text-center text-sm text-muted-foreground",children:a("folders.moveDialog.noFolders","No folders available")})]}),e.jsxs(ee,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>s(!1),children:a("common.cancel","Cancel")}),e.jsx(D,{onClick:j,disabled:y,children:y?a("common.moving","Moving..."):a("common.move","Move")})]})]})})}function xs({open:t,onOpenChange:s,template:n,targetFolderName:l,onConfirm:o,isLoading:a=!1}){const{t:r}=F(),u=l||r("templates.moveDialog.toRoot","Root"),m=()=>{o()};return e.jsx(B,{open:t,onOpenChange:s,children:e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),r("templates.moveDialog.title","Move Template")]}),e.jsx(W,{children:r("templates.moveDialog.message",'Are you sure you want to move "{{name}}" to "{{folder}}"?',{name:(n==null?void 0:n.title)??"",folder:u})})]}),e.jsxs(ee,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:a,children:r("common.cancel","Cancel")}),e.jsx(D,{onClick:m,disabled:a,children:a?r("common.moving","Moving..."):r("common.move","Move")})]})]})})}function gs({open:t,onOpenChange:s,folder:n,targetFolderName:l,onConfirm:o,isLoading:a=!1}){const{t:r}=F(),u=l||r("folders.moveDialog.root","Root (No parent)");return e.jsx(B,{open:t,onOpenChange:s,children:e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),r("folders.confirmMoveDialog.title","Move Folder")]}),e.jsx(W,{children:r("folders.confirmMoveDialog.message",'Are you sure you want to move "{{name}}" to "{{folder}}"?',{name:(n==null?void 0:n.name)??"",folder:u})})]}),e.jsxs(ee,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:a,children:r("common.cancel","Cancel")}),e.jsx(D,{onClick:o,disabled:a,children:a?r("common.moving","Moving..."):r("common.move","Move")})]})]})})}function fs({type:t,name:s}){const n=t==="folder"?ge:Ee;return e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border bg-background px-3 py-2 shadow-lg",children:[e.jsx(n,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"max-w-[200px] truncate text-sm font-medium",children:s})]})}function hs({onMove:t,onDelete:s,totalCount:n,allFolderIds:l}){const{t:o}=F(),{selectedIds:a,stopSelecting:r,selectAll:u}=he(),m=a.size;return m===0?null:e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border bg-background px-4 py-3 md:px-6 lg:px-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:r,className:"text-muted-foreground transition-colors hover:text-foreground","aria-label":o("common.cancel","Cancel"),children:e.jsx(Me,{size:20})}),e.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:o("folders.selection.count","{{count}} selected",{count:m})}),m<n&&e.jsx("button",{onClick:()=>u(l),className:"font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:o("folders.selection.selectAll","Select All")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:t,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),o("folders.actions.move","Move")]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:s,className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),o("folders.actions.delete","Delete")]})]})]})}function bs({folder:t,children:s,disabled:n=!1,isOtherDragging:l=!1}){const{attributes:o,listeners:a,setNodeRef:r,isDragging:u}=ze({id:`folder-${t.id}`,data:{type:"folder",folder:t},disabled:n});return e.jsx("div",{ref:r,className:P("touch-none transition-opacity",u&&"z-50 opacity-0",l&&!u&&"opacity-40"),...a,...o,children:s})}function js({template:t,children:s,disabled:n=!1,isOtherDragging:l=!1}){const{attributes:o,listeners:a,setNodeRef:r,isDragging:u}=ze({id:`template-${t.id}`,data:{type:"template",template:t},disabled:n});return e.jsx("div",{ref:r,className:P("touch-none transition-opacity",u&&"z-50 opacity-0",l&&!u&&"opacity-40"),...a,...o,children:s})}function ys({folderId:t,children:s}){var u,m;const{setNodeRef:n,isOver:l,active:o}=Le({id:`drop-folder-${t}`,data:{type:"folder",folderId:t}}),r=((m=(u=o==null?void 0:o.data.current)==null?void 0:u.folder)==null?void 0:m.id)!==t;return e.jsx("div",{ref:n,className:P("transition-all duration-200",l&&r&&"ring-2 ring-primary ring-offset-2"),children:s})}function vs(t){const s=Pe(),n=Ae({strict:!1}),o=ht({strict:!1}).folderId??null,a=n.workspaceId??t,{data:r,isLoading:u}=$e(t),{breadcrumbs:m,currentNode:c}=i.useMemo(()=>{const b=[{id:null,label:"Documents"}];if(!o||!r)return{breadcrumbs:b,currentNode:null};const k=(y,h)=>{for(const f of y){if(f.id===h)return[f];if(f.children&&f.children.length>0){const M=k(f.children,h);if(M)return[f,...M]}}return null},C=k(r,o);return C?(b.push(...C.map(y=>({id:y.id,label:y.name}))),{breadcrumbs:b,currentNode:C[C.length-1]}):{breadcrumbs:b,currentNode:null}},[r,o]),p=i.useCallback(b=>{s({to:"/workspace/$workspaceId/documents",params:{workspaceId:a},search:b?{folderId:b}:void 0})},[s,a]),g=i.useCallback(()=>{c!=null&&c.parentId?p(c.parentId):p(null)},[c,p]),j=c?{id:c.id,name:c.name,parentId:c.parentId??void 0,workspaceId:c.workspaceId,createdAt:c.createdAt,updatedAt:c.updatedAt,childFolderCount:0,templateCount:0}:void 0;return{currentFolderId:o,currentFolder:j,breadcrumbs:m,isLoading:u,navigateToFolder:p,navigateUp:g}}async function Ns(t){const s=new URLSearchParams;return s.set("folderId",t??"root"),(await O.get(`/content/templates?${s}`)).data}async function Cs(t,s){return(await O.put(`/content/templates/${t}`,{folderId:s.folderId??"root"})).data}const be={all:["templates"],byFolder:t=>[...be.all,"byFolder",t??"root"]};function ws(t){return fe({queryKey:be.byFolder(t),queryFn:()=>Ns(t),staleTime:0,gcTime:0})}function Ds(){const t=R();return V({mutationFn:({templateId:s,folderId:n})=>Cs(s,{folderId:n}),onSuccess:()=>{t.invalidateQueries({queryKey:be.all})}})}const Fs=({activatorEvent:t,draggingNodeRect:s,transform:n})=>{if(!t||!s)return n;const l={x:t.clientX,y:t.clientY},o=l.x-s.left,a=l.y-s.top;return{...n,x:n.x+o-s.width/2,y:n.y+a+16}},ks={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.03,delayChildren:.05}},exit:{opacity:0,transition:{duration:.15}}};function Ss(){const{t}=F(),s=Pe(),{workspaceId:n}=Ae({strict:!1}),[l,o]=i.useState("grid"),[a,r]=i.useState(""),[u,m]=i.useState(!1);i.useEffect(()=>{const d=setTimeout(()=>m(!0),1e3);return()=>clearTimeout(d)},[]);const c=vt(Nt(Ft,{activationConstraint:{distance:8}})),p=i.useCallback(d=>{const{pointerCoordinates:x,droppableRects:v,droppableContainers:q}=d;if(!x)return Ct(d);const E=[];for(const L of q){const{id:z}=L,T=v.get(z);T&&x.x>=T.left&&x.x<=T.right&&x.y>=T.top&&x.y<=T.bottom&&E.push({id:z,data:{droppableContainer:L,value:0}})}return E},[]),[g,j]=i.useState(null),[b,k]=i.useState(!1),[C,y]=i.useState(!1),[h,f]=i.useState(!1),[M,G]=i.useState(!1),[Qe,We]=i.useState(null),[Ge,ae]=i.useState([]),[je,le]=i.useState([]),[He,ye]=i.useState(!1),[Ue,ie]=i.useState(!1),[de,ve]=i.useState(null),[H,Ne]=i.useState(null),[Xe,ce]=i.useState(!1),[ue,Ce]=i.useState(null),[U,we]=i.useState(null),{currentFolderId:A,breadcrumbs:De,navigateToFolder:Fe,isLoading:Ye}=vs(n??""),{data:S,isLoading:Ze,refetch:ke}=rs(n??null);i.useEffect(()=>{ke()},[A,ke]);const{data:X,isLoading:_e}=ws(A),te=Be(),Se=Ds(),{selectedIds:me,clearSelection:Te,isSelecting:se,startSelecting:Je}=he(),ne=(S==null?void 0:S.data.filter(d=>A?d.parentId===A:!d.parentId))??[],pe=i.useCallback(d=>{if(!d)return t("templates.moveDialog.toRoot","Root");const x=S==null?void 0:S.data.find(v=>v.id===d);return(x==null?void 0:x.name)??""},[S,t]),et=i.useCallback(d=>{var q,E,L,z,T,$,Y,Z,N;const{active:x}=d,v=(q=x.data.current)==null?void 0:q.type;v==="folder"?j({type:"folder",id:(L=(E=x.data.current)==null?void 0:E.folder)==null?void 0:L.id,name:(T=(z=x.data.current)==null?void 0:z.folder)==null?void 0:T.name}):v==="template"&&j({type:"template",id:(Y=($=x.data.current)==null?void 0:$.template)==null?void 0:Y.id,name:(N=(Z=x.data.current)==null?void 0:Z.template)==null?void 0:N.title})},[]),tt=i.useCallback(async d=>{var L,z,T,$,Y,Z;const{active:x,over:v}=d;if(j(null),!v)return;const q=(L=x.data.current)==null?void 0:L.type,E=(z=v.data.current)==null?void 0:z.type;if(q==="folder"){const N=(T=x.data.current)==null?void 0:T.folder,I=($=v.data.current)==null?void 0:$.folderId;if(!N||N.id===I)return;if(E==="breadcrumb"){if(N.parentId===I)return;Ce(N),we({id:I??null,name:pe(I??null)}),ce(!0)}else if(I&&N.id!==I)try{await te.mutateAsync({folderId:N.id,data:{parentId:I}})}catch{}}else if(q==="template"){const N=(Y=x.data.current)==null?void 0:Y.template,I=(Z=v.data.current)==null?void 0:Z.folderId;N&&I!==N.folderId&&(ve(N),Ne({id:I??null,name:pe(I??null)}),ie(!0))}},[te,pe]),st=i.useCallback(()=>{j(null)},[]),nt=async()=>{if(!(!de||H===null))try{await Se.mutateAsync({templateId:de.id,folderId:H.id}),ie(!1),ve(null),Ne(null)}catch{}},rt=async()=>{if(!(!ue||U===null))try{await te.mutateAsync({folderId:ue.id,data:{parentId:U.id}}),ce(!1),Ce(null),we(null)}catch{}},ot=d=>{We(d),y(!0)},at=d=>{ae([d.id]),G(!0)},lt=d=>{le([d.id]),f(!0)},it=()=>{le(Array.from(me)),f(!0)},dt=()=>{ae(Array.from(me)),G(!0)},ct=()=>{Te(),le([])},ut=()=>{Te(),ae([])},mt=(Ye||Ze||_e)&&!S,pt=je.map(d=>{var x;return(x=S==null?void 0:S.data.find(v=>v.id===d))==null?void 0:x.name}).filter(Boolean);return e.jsxs("div",{className:"animate-page-enter flex h-full flex-1 flex-col bg-background",children:[e.jsx("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("documents.header.label","Repository")}),e.jsx("h1",{className:"font-display text-4xl font-light leading-tight tracking-tight text-foreground md:text-5xl",children:t("documents.title","Document Explorer")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>ye(!0),className:"group flex h-12 items-center gap-2 rounded-none bg-foreground px-6 text-sm font-medium tracking-wide text-background shadow-lg shadow-muted transition-colors hover:bg-foreground/90",children:[e.jsx("span",{className:"text-xl leading-none",children:"+"}),e.jsx("span",{children:t("templates.actions.newTemplate","NEW TEMPLATE")})]}),e.jsxs("button",{onClick:()=>k(!0),className:"group flex h-12 items-center gap-2 rounded-none border border-foreground bg-background px-6 text-sm font-medium tracking-wide text-foreground shadow-none transition-colors hover:bg-foreground hover:text-background",children:[e.jsx("span",{className:"text-xl leading-none",children:"+"}),e.jsx("span",{children:t("folders.actions.newFolder","NEW FOLDER")})]})]})]})}),e.jsx(Qt,{viewMode:l,onViewModeChange:o,searchQuery:a,onSearchChange:r,onStartSelection:Je,isSelecting:se}),se&&me.size>0&&e.jsx(hs,{onMove:dt,onDelete:it,totalCount:ne.length,allFolderIds:ne.map(d=>d.id)}),e.jsxs(wt,{sensors:c,collisionDetection:p,onDragStart:et,onDragEnd:tt,onDragCancel:st,children:[e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-12 md:px-6 lg:px-6",children:[e.jsx(Gt,{items:De.map((d,x)=>({id:d.id,label:d.label,isActive:x===De.length-1})),onNavigate:Fe}),e.jsx(re,{mode:"wait",children:mt||!u?e.jsxs(K.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"mb-10",children:[e.jsx("h2",{className:"mb-6 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("folders.subfolders","Subfolders")}),e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((d,x)=>e.jsx(Bt,{className:"h-40"},x))})]},"skeleton"):e.jsxs(K.div,{variants:ks,initial:"hidden",animate:"visible",exit:"exit",children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"mb-6 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("folders.subfolders","Subfolders")}),ne.length===0?e.jsx("p",{className:"text-muted-foreground",children:t("folders.empty","No folders yet. Create one to get started.")}):e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e.jsx(re,{initial:!1,mode:"popLayout",children:ne.map(d=>e.jsx(K.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2,ease:"easeOut"},children:e.jsx(ys,{folderId:d.id,children:e.jsx(bs,{folder:d,disabled:se,isOtherDragging:g!==null,children:e.jsx(Yt,{folder:d,onClick:()=>Fe(d.id),onRename:()=>ot(d),onMove:()=>at(d),onDelete:()=>lt(d)})})})},d.id))})})]}),e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"mb-6 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("templates.section","Templates")}),!(X!=null&&X.items)||X.items.length===0?e.jsx("p",{className:"text-muted-foreground",children:t("templates.empty","No templates in this folder")}):e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e.jsx(re,{initial:!1,mode:"popLayout",children:X.items.map(d=>e.jsx(K.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2,ease:"easeOut"},children:e.jsx(js,{template:d,disabled:se,isOtherDragging:g!==null,children:e.jsx(Zt,{template:d,onClick:()=>{s({to:"/workspace/$workspaceId/templates/$templateId",params:{workspaceId:n??"",templateId:d.id},search:{fromFolderId:A??"root"}})}})})},d.id))})})]})]},A??"root")})]}),e.jsx(Dt,{dropAnimation:null,modifiers:[Fs],children:g&&e.jsx(fs,{type:g.type,name:g.name})})]}),e.jsx(cs,{open:b,onOpenChange:k,parentId:A}),e.jsx(us,{open:C,onOpenChange:y,folder:Qe}),e.jsx(ms,{open:h,onOpenChange:f,folderIds:je,folderNames:pt,onSuccess:ct}),e.jsx(ps,{open:M,onOpenChange:G,folderIds:Ge,workspaceId:n??"",onSuccess:ut}),e.jsx(Vt,{open:He,onOpenChange:ye,folderId:A}),e.jsx(xs,{open:Ue,onOpenChange:ie,template:de,targetFolderName:(H==null?void 0:H.name)??"",onConfirm:nt,isLoading:Se.isPending}),e.jsx(gs,{open:Xe,onOpenChange:ce,folder:ue,targetFolderName:(U==null?void 0:U.name)??"",onConfirm:rt,isLoading:te.isPending})]})}function Ts(){return e.jsx(Xt,{children:e.jsx(Ss,{})})}const tn=Ts;export{tn as component};
