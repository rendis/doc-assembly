import{a as c,u as S}from"./useMutation-CK7pOml8.js";import{t as d,W as A,a as F,r as g,j as e,d as C,X as L,L as O,$ as R,T as E,k as W,n as B}from"./index-CpZxSUIv.js";import{v,c as U,b as G,d as X,e as _,g as $,u as H,a as J,r as Y,h as Z,i as I}from"./templates-api-R7_ijpxH.js";import{u as q}from"./useTranslation-Dso8I3TU.js";import{a as w}from"./chevron-right-8-sJLHkA.js";import{S as ee}from"./search-4mE8eZtP.js";import{P as te}from"./plus-ggTbZepB.js";import{D as se,a as ne,b as re,c as D}from"./dropdown-menu-71yQQtU7.js";import{c as ae}from"./useDocumentTypes-C3ly9eSx.js";import{C as oe}from"./chevron-down-BtQ_fXZf.js";import{D as ie,B as le,a as ue,c as ce,b as de}from"./dialog-D4OJuJXR.js";import{T as me}from"./triangle-alert-qhmPuinb.js";const m={all:["template-detail"],detail:t=>[...m.all,t]};function De(t){return S({queryKey:m.detail(t),queryFn:()=>X(t),enabled:!!t,staleTime:300*1e3,gcTime:600*1e3})}function Qe(t){const s=d();return c({mutationFn:n=>U(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Fe(t){const s=d();return c({mutationFn:n=>G(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Le(t){const s=d();return c({mutationFn:n=>v.publish(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Ve(t){const s=d();return c({mutationFn:({versionId:n,publishAt:o})=>v.schedulePublish(t,n,o),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)})}})}function Me(t){const s=d();return c({mutationFn:n=>v.cancelSchedule(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)})}})}function ze(t){const s=d();return c({mutationFn:n=>v.archive(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Pe(t){const s=d();return c({mutationFn:n=>v.delete(t,n),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)}),s.invalidateQueries({queryKey:p.all})}})}function Ae(t){const s=d();return c({mutationFn:({versionId:n,data:o})=>v.update(t,n,o),onSuccess:()=>{s.invalidateQueries({queryKey:m.detail(t)})}})}const p={all:["templates"],list:t=>[...p.all,"list",t]};function Oe(t={}){return S({queryKey:p.list(t),queryFn:()=>I(t),staleTime:0,gcTime:0,placeholderData:A})}function Re(){const t=d();return c({mutationFn:s=>_(s),onSuccess:()=>{t.invalidateQueries({queryKey:p.all})}})}function Ee(){const t=d();return c({mutationFn:({templateId:s,data:n})=>H(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:m.all})}})}function We(){const t=d();return c({mutationFn:s=>Z(s),onSuccess:()=>{t.invalidateQueries({queryKey:p.all})}})}function Be(){const t=d();return c({mutationFn:({templateId:s,tagIds:n})=>J(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:m.all})}})}function Ue(){const t=d();return c({mutationFn:({templateId:s,tagId:n})=>Y(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:m.all})}})}function Ge(){const t=d();return c({mutationFn:({templateId:s,data:n})=>$(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:p.all}),t.invalidateQueries({queryKey:m.all})}})}async function xe(){return(await F.get("/workspace/tags")).data}async function pe(t){return(await F.post("/workspace/tags",t)).data}const K={all:["tags"],list:()=>[...K.all,"list"]};function fe(){return S({queryKey:K.list(),queryFn:xe,staleTime:300*1e3})}function ge(){const t=d();return c({mutationFn:s=>pe(s),onSuccess:()=>{t.invalidateQueries({queryKey:K.all})}})}const Q=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899","#6b7280","#000000"];function he({defaultName:t,onCancel:s,onSubmit:n,isLoading:o=!1}){const{t:l}=q(),[a,i]=g.useState(t),[h,j]=g.useState(Q[5]??"#3b82f6"),y=()=>{a.trim().length<3||n(a.trim(),h)},x=a.trim().length>=3&&a.trim().length<=50;return e.jsxs("div",{className:"border-t border-border bg-muted/30 p-4",children:[e.jsx("div",{className:"mb-3 font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:l("tags.create.title","Create New Tag")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-1 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:l("tags.create.nameLabel","Name")}),e.jsx("input",{type:"text",value:a,onChange:u=>i(u.target.value),placeholder:l("tags.create.namePlaceholder","Tag name (3-50 chars)"),maxLength:50,className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",autoFocus:!0}),a.trim().length>0&&a.trim().length<3&&e.jsx("span",{className:"mt-1 block text-xs text-destructive",children:l("tags.create.minLength","Minimum 3 characters")})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:l("tags.create.colorLabel","Color")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Q.map(u=>e.jsx("button",{type:"button",onClick:()=>j(u),className:C("flex h-7 w-7 items-center justify-center rounded-full transition-all",h===u?"ring-2 ring-foreground ring-offset-2 ring-offset-background":"hover:scale-110"),style:{backgroundColor:u},children:h===u&&e.jsx(w,{size:14,className:C("text-white")})},u))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:s,disabled:o,className:"rounded-none border border-border bg-background px-4 py-2 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:l("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:y,disabled:!x||o,className:"rounded-none bg-foreground px-4 py-2 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:o?l("common.creating","Creating..."):l("tags.create.submit","Create Tag")})]})]})}function Xe({selectedTagIds:t,onSelectionChange:s}){const{t:n}=q(),{data:o,isLoading:l}=fe(),a=ge(),[i,h]=g.useState(""),[j,y]=g.useState(!1),x=g.useMemo(()=>(o==null?void 0:o.data)??[],[o==null?void 0:o.data]),u=g.useMemo(()=>{if(!i.trim())return x;const r=i.toLowerCase().trim();return x.filter(b=>b.name.toLowerCase().includes(r))},[x,i]),T=g.useMemo(()=>{if(!i.trim())return!0;const r=i.toLowerCase().trim();return x.some(b=>b.name.toLowerCase()===r)},[x,i]),N=g.useMemo(()=>x.filter(r=>t.includes(r.id)),[x,t]),f=r=>{t.includes(r)?s(t.filter(b=>b!==r)):s([...t,r])},V=r=>{s(t.filter(b=>b!==r))},M=async(r,b)=>{try{const P=await a.mutateAsync({name:r,color:b});s([...t,P.id]),y(!1),h("")}catch{}},z=()=>{y(!0)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"group relative",children:[e.jsx(ee,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:16}),e.jsx("input",{type:"text",value:i,onChange:r=>h(r.target.value),placeholder:n("tags.searchPlaceholder","Search or create tags..."),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-6 pr-4 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{className:"border border-border bg-background",children:[e.jsx("div",{className:"max-h-[160px] overflow-y-auto",children:l?e.jsx("div",{className:"px-4 py-3 text-sm text-muted-foreground",children:n("common.loading","Loading...")}):u.length===0&&!i.trim()?e.jsx("div",{className:"px-4 py-3 text-sm text-muted-foreground",children:n("tags.noTags","No tags available")}):e.jsxs(e.Fragment,{children:[u.map(r=>e.jsxs("button",{type:"button",onClick:()=>f(r.id),className:C("flex w-full items-center justify-between gap-3 px-4 py-2 text-left transition-colors hover:bg-muted",t.includes(r.id)?"text-foreground":"text-muted-foreground"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-3 w-3 shrink-0 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-sm",children:r.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:r.templateCount}),t.includes(r.id)&&e.jsx(w,{size:14,className:"text-foreground"})]})]},r.id)),i.trim()&&!T&&!j&&e.jsxs("button",{type:"button",onClick:z,className:"flex w-full items-center gap-2 border-t border-border px-4 py-3 text-left text-sm text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:[e.jsx(te,{size:14}),e.jsx("span",{children:n("tags.createNew",'Create "{{name}}"',{name:i.trim()})})]})]})}),j&&e.jsx(he,{defaultName:i.trim(),onCancel:()=>y(!1),onSubmit:M,isLoading:a.isPending})]}),N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(r=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 border border-border bg-muted/50 px-2 py-1 text-sm",children:[e.jsx("span",{className:"h-2 w-2 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{className:"text-foreground",children:r.name}),e.jsx("button",{type:"button",onClick:()=>V(r.id),className:"ml-1 text-muted-foreground transition-colors hover:text-foreground",children:e.jsx(L,{size:12})})]},r.id))})]})}function k(t,s){return t[s]||t.es||t.en||Object.values(t)[0]||""}function _e({currentTypeId:t,currentTypeName:s,onAssign:n,disabled:o=!1}){const{t:l,i18n:a}=q(),[i,h]=g.useState(!1),[j,y]=g.useState(!1),{data:x}=ae(1,100),u=(x==null?void 0:x.data)??[],T=s?k(s,a.language):null,N=async f=>{if(f===t){y(!1);return}h(!0);try{await n(f),y(!1)}finally{h(!1)}};return e.jsxs(se,{open:j,onOpenChange:y,children:[e.jsx(ne,{asChild:!0,disabled:o||i,children:e.jsx("button",{className:C("inline-flex items-center gap-2 text-sm transition-colors","hover:text-foreground",t?"text-foreground":"text-muted-foreground italic",(o||i)&&"cursor-not-allowed opacity-50"),children:i?e.jsx(O,{size:12,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:T||l("templates.detail.noDocumentType","No type assigned")}),e.jsx(oe,{size:14})]})})}),e.jsxs(re,{align:"start",className:"w-72 max-w-[90vw]",children:[e.jsxs(D,{onClick:()=>N(null),className:"flex items-center justify-between",children:[e.jsx("span",{className:"italic text-muted-foreground",children:l("templates.detail.noDocumentType","No type assigned")}),t===null&&e.jsx(w,{size:14})]}),u.length>0&&e.jsx("div",{className:"my-1 border-t border-border"}),u.map(f=>e.jsxs(D,{onClick:()=>N(f.id),className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx(R,{delayDuration:300,children:e.jsxs(E,{children:[e.jsx(W,{asChild:!0,children:e.jsx("span",{className:"max-w-[140px] truncate",children:k(f.name,a.language)})}),e.jsx(B,{side:"top",children:e.jsx("p",{children:k(f.name,a.language)})})]})}),e.jsx("span",{className:"shrink-0 rounded-sm border px-1 py-0.5 font-mono text-[10px] uppercase text-muted-foreground",children:f.code})]}),t===f.id&&e.jsx(w,{size:14})]},f.id)),u.length===0&&e.jsx("div",{className:"px-2 py-3 text-center text-sm text-muted-foreground",children:l("templates.detail.noDocumentTypesAvailable","No document types available")})]})]})}function $e({open:t,conflictTemplate:s,onCancel:n,onForce:o,isLoading:l=!1}){const{t:a}=q();return e.jsx(ie,{open:t,onOpenChange:i=>!i&&n(),children:e.jsxs(le,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-warning/10",children:e.jsx(me,{className:"h-5 w-5 text-warning"})}),e.jsx("div",{children:e.jsx(ue,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:a("templates.documentType.conflictTitle","Document type in use")})})]}),e.jsxs(ce,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(L,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(de,{className:"text-sm font-light text-muted-foreground",children:a("templates.documentType.conflictDescription",'This document type is already assigned to "{{title}}". Do you want to replace it? The type will be removed from the other template.',{title:s==null?void 0:s.title})})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:n,disabled:l,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:a("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:o,disabled:l,className:"rounded-none bg-primary px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-primary-foreground transition-colors hover:bg-primary/90 disabled:opacity-50",children:l?a("common.loading","Loading..."):a("templates.documentType.replace","Replace")})]})]})})}export{_e as D,Xe as T,Be as a,Ue as b,We as c,fe as d,Oe as e,Re as f,Ge as g,$e as h,ze as i,Me as j,Fe as k,Qe as l,Pe as m,p as n,Le as o,Ve as p,Ae as q,De as r,m as t,Ee as u};
