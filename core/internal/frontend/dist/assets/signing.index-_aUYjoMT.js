import{r as i,j as e,d as C,X as D,m as B,Z as M,L as E,U as F,u as _,F as G}from"./index-fKaFifWB.js";import{C as T}from"./checkbox-ED_ecBkm.js";import{S as p,a as U}from"./SigningStatusBadge-MvtFW_o-.js";import{u as N}from"./useTranslation-D0qa437J.js";import{S as $}from"./search-DDi9d-Bq.js";import{C as Q}from"./chevron-down-DzxdpjNN.js";import{a as V}from"./chevron-right-BnYhLX46.js";import{D as X,a as H,b as W,c as Z}from"./dropdown-menu-Dju4gITJ.js";import{E as q}from"./ellipsis-BFuWo1Dd.js";import{E as J}from"./eye-Cj0bTMKj.js";import{u as K,b as Y,c as ee}from"./useSigningDocuments-BndqymK-.js";import{D as te,d as se,e as ne,a as re,b as oe,f as ae}from"./dialog-9nhh7mvL.js";import{T as le}from"./triangle-alert-Di5g5Wop.js";import{B as ie,R as ce}from"./refresh-cw-CEr4BPZY.js";import{S as de}from"./skeleton-BPnsdAjk.js";import{P as ue}from"./plus-s7EU9lJN.js";import"./badge-B1W1bTxV.js";import"./Combination-C5nVb5De.js";import"./useMutation-DIF_ISNy.js";const ge=[{value:p.DRAFT,label:"Draft"},{value:p.PENDING_PROVIDER,label:"Processing"},{value:p.PENDING,label:"Pending"},{value:p.IN_PROGRESS,label:"In Progress"},{value:p.COMPLETED,label:"Completed"},{value:p.DECLINED,label:"Declined"},{value:p.VOIDED,label:"Voided"},{value:p.EXPIRED,label:"Expired"},{value:p.ERROR,label:"Error"}];function me({searchQuery:t,onSearchChange:f,selectedStatuses:o,onStatusesChange:s}){const{t:c}=N(),[a,x]=i.useState(!1),u=i.useRef(null);i.useEffect(()=>{function n(k){u.current&&!u.current.contains(k.target)&&x(!1)}return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const b=n=>{o.includes(n)?s(o.filter(k=>k!==n)):s([...o,n])},l=()=>{s([]),x(!1)},g=o.length===0?c("signing.status.any","Any"):`${o.length}`;return e.jsxs("div",{className:"flex shrink-0 flex-col justify-between gap-6 border-b border-border bg-background px-4 py-6 md:flex-row md:items-center md:px-6 lg:px-6",children:[e.jsxs("div",{className:"group relative w-full md:max-w-md",children:[e.jsx($,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:20}),e.jsx("input",{type:"text",placeholder:c("signing.searchPlaceholder","Search documents by title..."),value:t,onChange:n=>f(n.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-8 pr-4 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{ref:u,className:"relative",children:[e.jsxs("button",{onClick:()=>x(!a),className:"flex items-center gap-2 font-mono text-sm uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:[e.jsxs("span",{children:[c("signing.status.label","Status"),": ",g]}),e.jsx(Q,{size:16,className:C("transition-transform",a&&"rotate-180")})]}),a&&e.jsxs("div",{className:"absolute right-0 top-full z-50 mt-2 max-h-[300px] min-w-[200px] overflow-y-auto border border-border bg-background shadow-lg",children:[o.length>0&&e.jsxs("button",{onClick:l,className:"flex w-full items-center gap-2 border-b border-border px-4 py-2 text-left text-sm text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:[e.jsx(D,{size:14}),e.jsx("span",{children:c("common.clear","Clear all")})]}),ge.map(n=>e.jsxs("button",{onClick:()=>b(n.value),className:C("flex w-full items-center justify-between px-4 py-2 text-left font-mono text-sm uppercase tracking-wider transition-colors hover:bg-muted",o.includes(n.value)?"text-foreground":"text-muted-foreground"),children:[e.jsx("span",{children:n.label}),o.includes(n.value)&&e.jsx(V,{size:14})]},n.value))]})]})})]})}function xe({document:t,index:f=0,selected:o=!1,onToggleSelect:s,onClick:c,onView:a}){const{t:x}=N(),u=f<10,b=u?f*.05:0;return e.jsxs(B.tr,{initial:u?{opacity:0,x:20}:void 0,animate:{opacity:1,x:0},transition:{duration:.2,ease:"easeOut",delay:b},onClick:c,className:"group cursor-pointer transition-colors hover:bg-accent",children:[e.jsx("td",{className:"border-b border-border py-6 pl-4 align-top",onClick:l=>l.stopPropagation(),children:e.jsx(T,{checked:o,onCheckedChange:s,"aria-label":x("signing.bulk.selectDocument","Select {{title}}",{title:t.title})})}),e.jsx("td",{className:"border-b border-border py-6 pl-2 pr-4 align-top",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-display text-lg font-medium text-foreground",children:t.title}),t.signerProvider&&e.jsx("span",{className:"ml-2 shrink-0 rounded-sm border px-1 py-0.5 font-mono text-[10px] uppercase text-muted-foreground",children:t.signerProvider})]})}),e.jsx("td",{className:"border-b border-border py-6 pt-7 align-top",children:e.jsx(U,{status:t.status})}),e.jsx("td",{className:"border-b border-border py-6 pt-8 align-top font-mono text-sm text-muted-foreground",children:M(t.createdAt)}),e.jsx("td",{className:"border-b border-border py-6 pt-7 pr-4 text-center align-top",children:e.jsxs(X,{children:[e.jsx(H,{asChild:!0,children:e.jsx("button",{className:"text-muted-foreground transition-colors hover:text-foreground",onClick:l=>l.stopPropagation(),children:e.jsx(q,{size:20})})}),e.jsx(W,{align:"end",onClick:l=>l.stopPropagation(),children:e.jsxs(Z,{onClick:()=>a==null?void 0:a(),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),x("signing.actions.view","View details")]})})]})})]})}function pe({open:t,onOpenChange:f,documents:o,isLoading:s,onConfirm:c}){const{t:a}=N();return e.jsx(te,{open:t,onOpenChange:f,children:e.jsxs(se,{className:"sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsxs(re,{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-widest",children:[e.jsx(le,{size:18,className:"text-destructive"}),a("signing.bulk.cancelTitle","Cancel Documents")]}),e.jsx(oe,{children:a("signing.bulk.cancelConfirm","Are you sure you want to cancel {{count}} documents?",{count:o.length})})]}),e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsx("div",{className:"rounded-sm border border-destructive/30 bg-destructive/5 p-3",children:e.jsx("p",{className:"text-sm text-destructive",children:a("signing.bulk.cancelWarning","This action cannot be undone. All pending signatures on these documents will be cancelled.")})}),e.jsx("div",{className:"max-h-40 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:o.map(x=>e.jsx("li",{className:"truncate text-sm text-muted-foreground",children:x.title},x.id))})})]}),e.jsxs(ae,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",disabled:s,children:a("common.close","Close")}),e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-2 rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:s,children:[s&&e.jsx(E,{size:14,className:"animate-spin"}),a("signing.bulk.cancelSelected","Cancel Selected")]})]})]})})}const fe=[p.DRAFT,p.PENDING_PROVIDER,p.PENDING,p.IN_PROGRESS];function he({selectedDocuments:t,onClearSelection:f,onActionComplete:o}){const{t:s}=N(),{toast:c}=F(),a=K(),x=Y(),[u,b]=i.useState(!1),[l,g]=i.useState(!1),n=t.filter(m=>fe.includes(m.status)),k=async()=>{g(!0);let m=0,h=0;for(const j of n)try{await a.mutateAsync(j.id),m++}catch{h++}g(!1),b(!1),h>0?c({variant:"destructive",title:s("signing.bulk.partialError","Some operations failed"),description:s("signing.bulk.cancelResult","{{success}} cancelled, {{failed}} failed",{success:m,failed:h})}):c({title:s("signing.bulk.cancelSuccess","{{count}} document(s) cancelled",{count:m})}),o()},d=async()=>{g(!0);let m=0,h=0;for(const j of t)try{await x.mutateAsync(j.id),m++}catch{h++}g(!1),h>0?c({variant:"destructive",title:s("signing.bulk.partialError","Some operations failed"),description:s("signing.bulk.refreshResult","{{success}} refreshed, {{failed}} failed",{success:m,failed:h})}):c({title:s("signing.bulk.refreshSuccess","{{count}} document(s) refreshed",{count:m})}),o()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 border-b border-border bg-muted/50 px-4 py-3 md:px-6",children:[e.jsx("span",{className:"font-mono text-xs uppercase tracking-wider text-muted-foreground",children:s("signing.bulk.selected","{{count}} selected",{count:t.length})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>b(!0),disabled:n.length===0||l,className:"inline-flex items-center gap-1.5 rounded-none border border-destructive/50 bg-background px-3 py-1.5 font-mono text-[10px] uppercase tracking-wider text-destructive transition-colors hover:bg-destructive/10 disabled:opacity-50",children:[e.jsx(ie,{size:12}),s("signing.bulk.cancelSelected","Cancel Selected"),n.length<t.length&&e.jsxs("span",{className:"text-muted-foreground",children:["(",n.length,")"]})]}),e.jsxs("button",{type:"button",onClick:d,disabled:l,className:"inline-flex items-center gap-1.5 rounded-none border border-border bg-background px-3 py-1.5 font-mono text-[10px] uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:[l?e.jsx(E,{size:12,className:"animate-spin"}):e.jsx(ce,{size:12}),s("signing.bulk.refreshSelected","Refresh Selected")]})]}),e.jsx("button",{type:"button",onClick:f,className:"ml-auto text-muted-foreground transition-colors hover:text-foreground",title:s("signing.bulk.clearSelection","Clear selection"),children:e.jsx(D,{size:16})})]}),e.jsx(pe,{open:u,onOpenChange:b,documents:n,isLoading:l,onConfirm:k})]})}function be(){const{t}=N(),f=_(),{workspaceId:o}=G({strict:!1}),[s,c]=i.useState(""),[a,x]=i.useState(""),[u,b]=i.useState([]),[l,g]=i.useState(new Set);i.useEffect(()=>{const r=setTimeout(()=>{x(s),g(new Set)},300);return()=>clearTimeout(r)},[s]);const n=i.useCallback(r=>{b(r),g(new Set)},[]),k=i.useMemo(()=>({search:a||void 0,status:u.length>0?u.join(","):void 0}),[a,u]),{data:d,isLoading:m,isError:h}=ee(k),j=(d==null?void 0:d.length)??0,R=l.size>0,y=j>0&&l.size===j,P=i.useMemo(()=>(d==null?void 0:d.filter(r=>l.has(r.id)))??[],[d,l]),A=i.useCallback(r=>{g(v=>{const w=new Set(v);return w.has(r)?w.delete(r):w.add(r),w})},[]),I=i.useCallback(()=>{g(y?new Set:new Set((d==null?void 0:d.map(r=>r.id))??[]))},[y,d]),z=i.useCallback(()=>{g(new Set)},[]),L=i.useCallback(()=>{g(new Set)},[]),S=r=>{f({to:"/workspace/$workspaceId/signing/$documentId",params:{workspaceId:o??"",documentId:r}})},O=()=>{f({to:"/workspace/$workspaceId/signing/create",params:{workspaceId:o??""}})};return e.jsxs("div",{className:"animate-page-enter flex h-full flex-1 flex-col bg-background",children:[e.jsx("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("signing.header","Signing")}),e.jsx("h1",{className:"font-display text-4xl font-light leading-tight tracking-tight text-foreground md:text-5xl",children:t("signing.title","Signing Documents")})]}),e.jsxs("button",{onClick:O,className:"group flex h-12 items-center gap-2 rounded-none bg-foreground px-6 text-sm font-medium tracking-wide text-background shadow-lg shadow-muted transition-colors hover:bg-foreground/90",children:[e.jsx(ue,{size:20}),e.jsx("span",{children:t("signing.actions.createDocument","CREATE DOCUMENT")})]})]})}),e.jsx(me,{searchQuery:s,onSearchChange:c,selectedStatuses:u,onStatusesChange:n}),R&&e.jsx(he,{selectedDocuments:P,onClearSelection:z,onActionComplete:L}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-12 md:px-6 lg:px-6",children:[m&&e.jsx("div",{className:"space-y-4 pt-6",children:[...Array(5)].map((r,v)=>e.jsx(de,{className:"h-20 w-full"},v))}),h&&!m&&e.jsx("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:e.jsx("p",{className:"text-lg text-muted-foreground",children:t("signing.error","Failed to load signing documents. Please try again.")})}),!m&&!h&&j===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("p",{className:"text-lg text-muted-foreground",children:t("signing.noDocuments","No signing documents found")}),(a||u.length>0)&&e.jsx("button",{onClick:()=>{c(""),b([])},className:"mt-4 text-sm text-foreground underline underline-offset-4 hover:no-underline",children:t("signing.clearFilters","Clear filters")})]}),!m&&!h&&j>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-4 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("signing.showing","{{count}} document(s)",{count:j})}),e.jsxs("table",{className:"w-full border-collapse text-left",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[40px] border-b border-border py-4 pl-4",children:e.jsx(T,{checked:y,onCheckedChange:I,"aria-label":t("signing.bulk.selectAll","Select all documents")})}),e.jsx("th",{className:"w-[38%] border-b border-border py-4 pl-2 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:t("signing.columns.title","Title")}),e.jsx("th",{className:"w-[20%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:t("signing.columns.status","Status")}),e.jsx("th",{className:"w-[25%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:t("signing.columns.created","Created")}),e.jsx("th",{className:"w-[15%] border-b border-border py-4 pr-4 text-center font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:t("signing.columns.actions","Actions")})]})}),e.jsx("tbody",{className:"font-light",children:d==null?void 0:d.map((r,v)=>e.jsx(xe,{document:r,index:v,selected:l.has(r.id),onToggleSelect:()=>A(r.id),onClick:()=>S(r.id),onView:()=>S(r.id)},r.id))})]})]})]})]})}const Me=be;export{Me as component};
