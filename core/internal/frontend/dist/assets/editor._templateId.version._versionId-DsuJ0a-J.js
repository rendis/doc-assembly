import{ai as re,r as t,j as e,d as B,X as ue,A as W,m as I,L as de,aj as me}from"./index-fKaFifWB.js";import{F as se,d as fe,C as ae,f as Q,a as O,b as L,g as pe,u as xe,h as Z,S as he,c as ge}from"./document-import-VQ6j4sXg.js";import{R as ve,P as be,O as je,C as ye,T as Ne,h as we,g as Se}from"./dialog-9nhh7mvL.js";import{e as ke,f as Ce,g as ee,h as te,L as Re}from"./tabs-BREKaaVO.js";import{u as A}from"./useTranslation-D0qa437J.js";import{b as ne}from"./send-D4-EfYh9.js";import{B as _}from"./button-dNu0h4YU.js";import{C as q}from"./circle-alert-DMx-c1KX.js";import{F as Ee}from"./file-text-9wfbuSTS.js";import{a as Te}from"./chevron-right-BnYhLX46.js";import{v as oe}from"./templates-api-D2rcs8lc.js";import"./version-highlight-store-CNWswpJC.js";import"./dropdown-menu-Dju4gITJ.js";import{R as Ie}from"./refresh-cw-CEr4BPZY.js";import{A as Fe}from"./arrow-left-DWWoMVQm.js";import"./index-Bz2JvSB8.js";import"./index-BGxMZ4Dx.js";import"./label-CUbdgxCI.js";import"./scroll-area-B0sqHBmx.js";import"./i18n-CgYYcOID.js";import"./checkbox-ED_ecBkm.js";import"./download-BkqsP3n5.js";import"./chevron-left-B9Sdd2C1.js";import"./badge-B1W1bTxV.js";import"./chevron-down-DzxdpjNN.js";import"./plus-s7EU9lJN.js";import"./trash-2-CCOxSVLr.js";import"./eye-Cj0bTMKj.js";import"./Combination-C5nVb5De.js";import"./list-DU_LFEgA.js";import"./ellipsis-BFuWo1Dd.js";import"./triangle-alert-Di5g5Wop.js";import"./variable-CoGkBFiT.js";import"./square-check-big-D50ND9hH.js";import"./pencil-H1WR5f29.js";import"./calendar-CUaXafub.js";import"./search-DDi9d-Bq.js";import"./arrow-right-BUe0zEcb.js";import"./layers-BInfCQBw.js";import"./info-DKNJqB_Z.js";import"./arrow-up-right-BqKNCxRd.js";import"./flask-conical-CPX_RHGe.js";import"./folder-open-CLELnnBv.js";import"./power-C40xL1wA.js";import"./square-pen-Cq5HfgCc.js";import"./trash-D4z_LFH8.js";function De(r,a){if(r===void 0)return{shouldBlockFn:()=>!0,withResolver:!1};if("shouldBlockFn"in r)return r;if(typeof r=="function")return{shouldBlockFn:async()=>await r(),enableBeforeUnload:!0,withResolver:!1};const i=!!(r.condition??!0),n=r.blockerFn;return{shouldBlockFn:async()=>i&&n!==void 0?await n():i,enableBeforeUnload:i,withResolver:n===void 0}}function Pe(r,a){const{shouldBlockFn:i,enableBeforeUnload:n=!0,disabled:o=!1,withResolver:s=!1}=De(r),u=re(),{history:c}=u,[h,g]=t.useState({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0});return t.useEffect(()=>{const d=async x=>{function b(S){const k=u.parseLocation(S),C=u.getMatchedRoutes(k.pathname);return C.foundRoute===void 0?{routeId:"__notFound__",fullPath:k.pathname,pathname:k.pathname,params:C.routeParams,search:u.options.parseSearch(S.search)}:{routeId:C.foundRoute.id,fullPath:C.foundRoute.fullPath,pathname:k.pathname,params:C.routeParams,search:u.options.parseSearch(S.search)}}const j=b(x.currentLocation),p=b(x.nextLocation);if(j.routeId==="__notFound__"&&p.routeId!=="__notFound__")return!1;const l=await i({action:x.action,current:j,next:p});if(!s)return l;if(!l)return!1;const v=await new Promise(S=>{g({status:"blocked",current:j,next:p,action:x.action,proceed:()=>S(!1),reset:()=>S(!0)})});return g({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0}),v};return o?void 0:c.block({blockerFn:d,enableBeforeUnload:n})},[i,n,o,s,c,u]),h}function Be(r){return r?r.status==="PUBLISHED"?"PUBLISHED":r.status==="ARCHIVED"?"ARCHIVED":r.scheduledPublishAt?"SCHEDULED":"DRAFT":"DRAFT"}function Oe(r){return Be(r)==="DRAFT"}function Le({onDocumentReady:r}){const{t:a}=A(),i=t.useRef(null),[n,o]=t.useState(null),[s,u]=t.useState(null),[c,h]=t.useState(!1),g=t.useCallback(()=>{var l;(l=i.current)==null||l.click()},[]),d=t.useCallback(async l=>{if(u(null),o(null),h(!1),!l.name.endsWith(".json")){const f=a("editor.import.invalidFileType");u(f),r(null,f);return}try{const f=await l.text(),v=JSON.parse(f);o(l.name),r(v)}catch{const f=a("editor.import.invalidJson");u(f),r(null,f)}},[r,a]),x=t.useCallback(async l=>{var v;const f=(v=l.target.files)==null?void 0:v[0];f&&(await d(f),i.current&&(i.current.value=""))},[d]),b=t.useCallback(l=>{l.preventDefault(),l.stopPropagation(),h(!0)},[]),j=t.useCallback(l=>{l.preventDefault(),l.stopPropagation(),h(!1)},[]),p=t.useCallback(async l=>{l.preventDefault(),l.stopPropagation();const f=l.dataTransfer.files[0];if(!f){h(!1);return}await d(f)},[d]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:i,type:"file",accept:".json",onChange:x,className:"hidden"}),e.jsxs("div",{onClick:g,onDragOver:b,onDragLeave:j,onDrop:p,className:B("w-full flex flex-col items-center justify-center gap-3 p-8 border-2 border-dashed rounded-lg cursor-pointer transition-colors",c?"border-primary bg-primary/5":"border-border hover:border-foreground/50 hover:bg-muted/50"),children:[e.jsx("div",{className:B("p-3 rounded-full transition-colors",c?"bg-primary/10":"bg-muted"),children:e.jsx(se,{className:B("h-6 w-6",c?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:B("text-sm font-medium",c&&"text-primary"),children:a(c?"editor.import.dropHere":"editor.import.fileTabDescription")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("editor.import.acceptedFormat")})]})]}),n&&!s&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-success-muted border border-success-border rounded-lg",children:[e.jsx(fe,{className:"h-5 w-5 text-success"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-success-foreground truncate",children:n}),e.jsx("p",{className:"text-xs text-success-foreground/80",children:a("editor.import.fileSelected")})]}),e.jsx(ne,{className:"h-5 w-5 text-success"})]}),s&&e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:s})})]})}function _e({onDocumentReady:r}){const{t:a}=A(),[i,n]=t.useState(""),[o,s]=t.useState(null),[u,c]=t.useState(null),h=t.useCallback(()=>{if(!i.trim()){c(a("editor.import.emptyContent")),s(!1),r(null);return}try{const x=JSON.parse(i);s(!0),c(null),r(x)}catch{const x=a("editor.import.invalidJson");c(x),s(!1),r(null,x)}},[i,r,a]),g=t.useCallback(x=>{n(x.target.value),o!==null&&(s(null),c(null),r(null))},[o,r]),d=t.useCallback(async()=>{try{const x=await navigator.clipboard.readText();n(x),s(null),c(null),r(null)}catch{}},[r]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:a("editor.import.pasteLabel")}),e.jsxs(_,{type:"button",variant:"ghost",size:"sm",onClick:d,className:"h-7 px-2 text-xs",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),a("editor.import.pasteFromClipboard")]})]}),e.jsx("textarea",{value:i,onChange:g,placeholder:a("editor.import.pastePlaceholder"),className:"w-full h-48 p-3 text-sm font-mono bg-muted border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-ring"})]}),e.jsx(_,{type:"button",variant:"outline",onClick:h,disabled:!i.trim(),className:"w-full",children:a("editor.import.parseButton")}),o===!0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-success-muted border border-success-border rounded-lg",children:[e.jsx(ne,{className:"h-5 w-5 text-success"}),e.jsx("p",{className:"text-sm text-success-foreground",children:a("editor.import.jsonValid")})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:[e.jsx(q,{className:"h-5 w-5 text-destructive"}),e.jsx("p",{className:"text-sm text-destructive",children:u})]})]})}function Ae({open:r,onOpenChange:a,onImport:i}){const{t:n}=A(),[o,s]=t.useState("file"),[u,c]=t.useState(null),[h,g]=t.useState(null),[d,x]=t.useState(r);r!==d&&(x(r),r&&(c(null),g(null),s("file")));const b=t.useCallback((f,v)=>{c(f),g(v||null)},[]),j=t.useCallback(()=>{u&&(i(u),a(!1))},[u,i,a]),p=t.useCallback(()=>{c(null),g(null),s("file"),a(!1)},[a]),l=t.useCallback(f=>{s(f),c(null),g(null)},[]);return e.jsx(ve,{open:r,onOpenChange:p,children:e.jsxs(be,{children:[e.jsx(je,{className:"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),e.jsxs(ye,{className:B("fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] border border-border bg-background p-0 shadow-lg duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95"),children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(Ne,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:n("editor.import.title")}),e.jsx(we,{className:"mt-1 text-sm font-light text-muted-foreground",children:n("editor.import.description")})]}),e.jsxs(Se,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(ue,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:n("common.close")})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs(ke,{value:o,onValueChange:f=>l(f),children:[e.jsxs(Ce,{className:"grid w-full grid-cols-2 rounded-none",children:[e.jsxs(ee,{value:"file",className:"gap-2 rounded-none font-mono text-xs uppercase tracking-wider",children:[e.jsx(se,{className:"h-4 w-4"}),n("editor.import.tabs.file")]}),e.jsxs(ee,{value:"paste",className:"gap-2 rounded-none font-mono text-xs uppercase tracking-wider",children:[e.jsx(ae,{className:"h-4 w-4"}),n("editor.import.tabs.paste")]})]}),e.jsx(te,{value:"file",className:"mt-4 min-h-[340px]",children:e.jsx(Le,{onDocumentReady:b})}),e.jsx(te,{value:"paste",className:"mt-4 min-h-[340px]",children:e.jsx(_e,{onDocumentReady:b})})]}),h&&!["file","paste"].includes(o)&&e.jsx("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:e.jsx("p",{className:"text-sm text-destructive",children:h})})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:p,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",children:n("common.cancel")}),e.jsx("button",{type:"button",onClick:j,disabled:!u,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50 disabled:cursor-not-allowed",children:n("editor.import.importDocument")})]})]})]})})}function Me({isVisible:r,documentName:a}){const{t:i}=A();return e.jsx(W,{children:r&&e.jsx(I.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:.4,ease:"easeOut"},className:"fixed inset-0 z-50 flex items-center justify-center bg-background",children:e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeOut"},className:"flex flex-col items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(I.div,{animate:{scale:[1,1.15,1],opacity:[.12,.04,.12]},transition:{duration:2.5,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 rounded-2xl bg-muted-foreground",style:{margin:"-16px"}}),e.jsx("div",{className:"relative flex h-14 w-14 items-center justify-center rounded-xl bg-secondary border border-border shadow-sm",children:e.jsx(Ee,{className:"h-6 w-6 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center min-h-[52px]",children:[e.jsx("h2",{className:"text-base font-medium text-foreground",children:i("editor.preparation.title","Preparando documento")}),a&&e.jsx("p",{className:"text-sm text-muted-foreground max-w-[280px] truncate",children:a})]}),e.jsx("div",{className:"h-0.5 w-32 overflow-hidden rounded-full bg-border",children:e.jsx(I.div,{animate:{x:["-100%","100%"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"h-full w-1/2 rounded-full bg-muted-foreground/50"})})]})})})}function ze(r,a){const n=new Date().getTime()-r.getTime(),o=Math.floor(n/1e3),s=Math.floor(o/60);return o<5?a("editor.autoSave.justNow")||"ahora mismo":o<60?a("editor.autoSave.secondsAgo",{count:o})||`hace ${o}s`:s<60?a("editor.autoSave.minutesAgo",{count:s})||`hace ${s}m`:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}const Je=[.4,0,.2,1],Ve=[.4,0,1,1],Ue={initial:{opacity:0,x:30,filter:"blur(4px)"},animate:{opacity:1,x:0,filter:"blur(0px)",transition:{duration:.5,ease:Je}},exit:{opacity:0,x:30,filter:"blur(4px)",transition:{duration:.4,ease:Ve}}},$e={type:"spring",stiffness:150,damping:20,duration:.6},He=[.34,1.56,.64,1],We=[.4,0,1,1],Ge={initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1,transition:{duration:.4,ease:He}},exit:{scale:.5,opacity:0,transition:{duration:.25,ease:We}}};function Xe({status:r}){const a={idle:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),pending:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),saving:e.jsx(de,{className:"h-4 w-4 text-primary animate-spin"}),saved:e.jsx(Te,{className:"h-4 w-4 text-green-600 dark:text-green-500"}),error:e.jsx(q,{className:"h-4 w-4 text-destructive"})};return e.jsx(I.div,{layoutId:"save-status-icon",className:"flex items-center justify-center w-5 h-5",transition:$e,children:e.jsx(W,{mode:"wait",children:e.jsx(I.div,{variants:Ge,initial:"initial",animate:"animate",exit:"exit",children:a[r]},r)})})}function Ye({status:r,lastSavedAt:a,error:i,onRetry:n,className:o}){const{t:s}=A(),u=()=>{switch(r){case"idle":return a?`${s("editor.autoSave.saved")||"Guardado"} ${ze(a,s)}`:null;case"pending":return s("editor.autoSave.pending")||"Sin guardar...";case"saving":return s("editor.autoSave.saving")||"Guardando...";case"saved":return s("editor.autoSave.saved")||"Guardado";case"error":return s("editor.autoSave.error")||"Error al guardar";default:return null}},c=()=>{switch(r){case"idle":case"pending":return"text-muted-foreground";case"saving":return"text-primary";case"saved":return"text-green-600 dark:text-green-500";case"error":return"text-destructive";default:return"text-muted-foreground"}},h=u();return e.jsxs(I.div,{layout:!0,className:B("flex items-center gap-2 text-xs h-5 min-w-[120px] justify-end overflow-hidden",r==="idle"&&"opacity-60",o),children:[e.jsx(W,{mode:"wait",children:h&&e.jsx(I.span,{className:B("whitespace-nowrap",c()),variants:Ue,initial:"initial",animate:"animate",exit:"exit",children:h},`${r}-${h}`)}),e.jsx(Xe,{status:r}),e.jsx(W,{children:r==="error"&&n&&e.jsx(I.div,{initial:{opacity:0,scale:.8,x:20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.8,x:20},transition:{duration:.3,ease:"easeOut"},children:e.jsx(_,{variant:"ghost",size:"sm",className:"h-5 px-1.5 text-xs text-destructive hover:text-destructive",onClick:n,children:s("common.retry")||"Reintentar"})})})]})}const qe=2e3,Ke=2,Qe=3e3;function Ze({editor:r,templateId:a,versionId:i,enabled:n,debounceMs:o=qe,meta:s}){const[u,c]=t.useState("idle"),[h,g]=t.useState(null),[d,x]=t.useState(null),[b,j]=t.useState(!1),p=t.useRef(null),l=t.useRef(null),f=t.useRef(0),v=t.useRef(!1),S=t.useRef(!1),k=t.useRef(null),C=t.useRef(null),U=O(m=>m.pageSize),M=O(m=>m.margins),F=L(m=>m.roles),T=L(m=>m.workflowConfig),$=t.useMemo(()=>({pageSize:U,margins:M}),[U,M]);t.useEffect(()=>()=>{p.current&&clearTimeout(p.current),l.current&&clearTimeout(l.current)},[]),t.useEffect(()=>{if(!n||S.current)return;const m=setTimeout(()=>{k.current=JSON.stringify(F),C.current=JSON.stringify(T),S.current=!0},100);return()=>clearTimeout(m)},[n,F,T]);const R=t.useCallback(async()=>{if(!(!r||!n||v.current)){v.current=!0,c("saving"),x(null);try{const m={title:(s==null?void 0:s.title)||"Untitled",description:s==null?void 0:s.description,language:(s==null?void 0:s.language)||"es",customFields:s==null?void 0:s.customFields},J=pe(r,{pagination:$,signerRoles:F,workflowConfig:T},m,{includeChecksum:!0});await oe.update(a,i,{contentStructure:J}),c("saved"),g(new Date),j(!1),f.current=0,l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{c("idle")},Qe)}catch(m){const D=m instanceof Error?m:new Error("Save failed");if(f.current<Ke){f.current++,v.current=!1,setTimeout(()=>R(),1e3);return}c("error"),x(D),f.current=0}finally{v.current=!1}}},[r,n,a,i,s,$,F,T]),H=t.useCallback(async()=>{p.current&&(clearTimeout(p.current),p.current=null),await R()},[R]),z=t.useCallback(()=>{x(null),c(b?"pending":"idle")},[b]),E=t.useCallback(()=>{n&&(j(!0),c("pending"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{p.current=null,R()},o))},[n,o,R]);return t.useEffect(()=>{if(!r||!n)return;const m=()=>{E()};return r.on("update",m),()=>{r.off("update",m)}},[r,n,E]),t.useEffect(()=>{if(!n||!S.current)return;const m=JSON.stringify(F),D=JSON.stringify(T),J=k.current!==m,G=C.current!==D;(J||G)&&(k.current=m,C.current=D,j(!0),c("pending"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{p.current=null,R()},o))},[F,T,n,o,R]),{status:u,lastSavedAt:h,error:d,isDirty:b,save:H,resetError:z}}function et({isDirty:r,status:a,save:i,enabled:n=!0}){const o=t.useRef(!1),s=r||a==="pending",u=t.useCallback(async()=>{if(!s||o.current)return!1;o.current=!0;try{await i()}catch(c){console.warn("Failed to save on navigation:",c)}finally{o.current=!1}return!1},[s,i]);Pe({shouldBlockFn:u,disabled:!n,enableBeforeUnload:n&&s})}function Gt(){const{workspaceId:r,templateId:a,versionId:i}=me.useParams(),n=re(),{t:o}=A(),{variables:s}=xe(),u=t.useRef(null),[c,h]=t.useState(null),g=t.useRef(!1),[d,x]=t.useState(null),[b,j]=t.useState(!0),[p,l]=t.useState(null),[f,v]=t.useState(null),[S,k]=t.useState(!1),[C,U]=t.useState(!0),[M,F]=t.useState(!1),[T,$]=t.useState(!1);t.useRef(Date.now());const R=t.useRef(!1),H=t.useRef(null),z=t.useCallback(async()=>{j(!0),l(null),v(null),g.current=!1;try{const y=await oe.get(a,i);x(y)}catch(y){console.error("Failed to fetch version:",y),l(y instanceof Error?y:new Error("Failed to load version"))}finally{j(!1)}},[a,i]);t.useEffect(()=>{const y=`${a}:${i}`;R.current&&H.current===y||(R.current=!0,H.current=y,z())},[z,a,i]);const E=Oe(d);t.useEffect(()=>{if(!u.current||!d||g.current)return;const y=u.current;if(!(d.contentStructure&&Object.keys(d.contentStructure).length>0)){g.current=!0;return}const Y={setPaginationConfig:w=>{const{pageSize:P,margins:K}=w;P&&O.getState().setPageSize(P),K&&O.getState().setMargins(K)},setSignerRoles:L.getState().setRoles,setWorkflowConfig:L.getState().setWorkflowConfig},V=d.contentStructure,N=Z(V,y,Y,s.map(w=>({id:w.id,variableId:w.variableId,type:w.type,label:w.label})));if(!N.success){const w=N.validation.errors.map(P=>P.message).join(", ");v(w||o("editor.errors.importFailed")),console.error("Import failed:",N.validation.errors),console.error("Import failed - Full errors:",JSON.stringify(N.validation.errors,null,2)),console.error("Import failed - Document:",JSON.stringify(V,null,2))}g.current=!0},[d,u.current,s]);const m=Ze({editor:c,templateId:a,versionId:i,enabled:E&&g.current,debounceMs:2e3,meta:{title:(d==null?void 0:d.name)||o("editor.document"),language:"es"}});et({isDirty:m.isDirty,status:m.status,save:m.save,enabled:E});const D=t.useCallback(async()=>{await m.save()},[m]),J=2e3;t.useEffect(()=>{const y=setTimeout(()=>{$(!0)},J);return()=>clearTimeout(y)},[]),t.useEffect(()=>{M&&T&&requestAnimationFrame(()=>{U(!1)})},[M,T]);const G=t.useCallback(()=>{F(!0)},[]),ie=t.useCallback(()=>{k(!0)},[]),ce=t.useCallback(y=>{const X=u.current;if(!X)return;const Y={setPaginationConfig:N=>{const{pageSize:w,margins:P}=N;w&&O.getState().setPageSize(w),P&&O.getState().setMargins(P)},setSignerRoles:L.getState().setRoles,setWorkflowConfig:L.getState().setWorkflowConfig},V=Z(y,X,Y,s.map(N=>({id:N.id,variableId:N.variableId,type:N.type,label:N.label})));if(!V.success){const N=V.validation.errors.map(w=>w.message).join(", ");v(N||o("editor.errors.importFailed"))}k(!1)},[s,o]);if(p||f)return e.jsxs("div",{className:"flex flex-col h-full bg-background items-center justify-center",children:[e.jsx(q,{className:"h-8 w-8 text-destructive"}),e.jsx("p",{className:"mt-4 text-sm text-destructive",children:(p==null?void 0:p.message)||f||o("editor.errors.versionLoadFailed")}),e.jsxs(_,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>{v(null),z()},children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),o("common.retry")||"Reintentar"]})]});const le=b||C;return e.jsxs(e.Fragment,{children:[e.jsx(Me,{isVisible:le,documentName:d==null?void 0:d.name}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[e.jsxs("header",{className:"flex items-center justify-between px-4 py-2 border-b bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>n.history.back(),children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold",children:(d==null?void 0:d.name)||"Editor"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["v",(d==null?void 0:d.versionNumber)||i]}),E&&e.jsx("span",{className:"text-[10px] bg-primary/10 text-primary px-1.5 py-0.5 rounded",children:o("editor.status.editable")})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:E&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{status:m.status,lastSavedAt:m.lastSavedAt,error:m.error,onRetry:D}),e.jsxs(_,{size:"sm",variant:"outline",onClick:D,disabled:m.status==="saving",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),o("common.save")||"Guardar"]})]})})]}),!E&&e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-2 bg-warning-muted border-b border-warning-border",children:[e.jsx(Re,{className:"h-4 w-4 text-warning-foreground"}),e.jsx("span",{className:"text-sm font-medium text-warning-foreground",children:o("editor.status.readOnlyBanner")})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:!b&&e.jsx(ge,{initialContent:"",editable:E,variables:s,onImport:E?ie:void 0,editorRef:u,onEditorReady:h,onFullyReady:G,templateId:a,versionId:i},"editor")})]}),e.jsx(Ae,{open:S,onOpenChange:k,onImport:ce})]})}export{Gt as component};
