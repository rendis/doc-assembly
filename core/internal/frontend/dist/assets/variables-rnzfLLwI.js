import{a as j,t as G,j as e,r as p,X as T,m as O,T as C,k as D,n as S,d as W,b as J,v as U}from"./index-fKaFifWB.js";import{S as H}from"./skeleton-BPnsdAjk.js";import{u as z,P as A}from"./usePermission-zD2XWRZH.js";import{u as Q,a as N}from"./useMutation-DIF_ISNy.js";import{D as I,B as P,a as L,b as $,c as F}from"./dialog-9nhh7mvL.js";import{u as h}from"./useTranslation-D0qa437J.js";import{T as B}from"./triangle-alert-Di5g5Wop.js";import{D as X,a as Y,b as Z,c as E,d as ee}from"./dropdown-menu-Dju4gITJ.js";import{V as K}from"./variable-CoGkBFiT.js";import{E as te}from"./ellipsis-BFuWo1Dd.js";import{P as se}from"./pencil-H1WR5f29.js";import{P as ae,a as re}from"./power-C40xL1wA.js";import{T as ne}from"./trash-D4z_LFH8.js";import{P as _}from"./plus-s7EU9lJN.js";import"./Combination-C5nVb5De.js";import"./chevron-right-BnYhLX46.js";const v="/workspace/injectables";async function oe(){return(await j.get(v)).data.items}async function ie(t){return(await j.post(v,t)).data}async function le(t,n){return(await j.put(`${v}/${t}`,n)).data}async function de(t){await j.delete(`${v}/${t}`)}async function ce(t){return(await j.post(`${v}/${t}/activate`)).data}async function ue(t){return(await j.post(`${v}/${t}/deactivate`)).data}const V={all:["workspace-injectables"],lists:()=>[...V.all,"list"],list:t=>[...V.lists(),t]};function w(){const t=G();return()=>t.invalidateQueries({queryKey:V.all})}function me(t){return Q({queryKey:V.list(t??""),queryFn:oe,enabled:!!t,staleTime:300*1e3})}function xe(){const t=w();return N({mutationFn:ie,onSuccess:t})}function pe(){const t=w();return N({mutationFn:({id:n,data:s})=>le(n,s),onSuccess:t})}function ge(){const t=w();return N({mutationFn:de,onSuccess:t})}function be(){const t=w();return N({mutationFn:ce,onSuccess:t})}function fe(){const t=w();return N({mutationFn:ue,onSuccess:t})}function R({keyValue:t,onKeyChange:n,label:s,onLabelChange:a,defaultValue:r,onDefaultValueChange:o,description:c,onDescriptionChange:g,showKeyHint:m=!0,idPrefix:i}){const{t:l}=h(),x="w-full rounded-none border-0 border-b border-border bg-transparent py-2 text-base font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0",d="mb-2 block font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",b="mt-1 text-right text-[10px] font-mono text-muted-foreground/60";return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${i}-label`,className:d,children:l("variables.label","Display Label")}),e.jsx("input",{id:`${i}-label`,type:"text",value:s,onChange:u=>a(u.target.value),placeholder:l("variables.labelPlaceholder","e.g., Company Name"),maxLength:255,autoFocus:!0,className:x}),e.jsxs("div",{className:b,children:[s.length,"/255"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${i}-key`,className:d,children:l("variables.key","Variable Key")}),e.jsx("input",{id:`${i}-key`,type:"text",value:t,onChange:u=>n(u.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")),placeholder:l("variables.keyPlaceholder","e.g., company_name"),maxLength:100,className:`${x} font-mono text-sm`}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[m?e.jsx("p",{className:"text-xs text-muted-foreground/70",children:l("variables.keyHint","Use snake_case format (letters, numbers, underscores)")}):e.jsx("span",{}),e.jsxs("span",{className:"text-[10px] font-mono text-muted-foreground/60",children:[t.length,"/100"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${i}-defaultValue`,className:d,children:l("variables.defaultValue","Default Value")}),e.jsx("input",{id:`${i}-defaultValue`,type:"text",value:r,onChange:u=>o(u.target.value),placeholder:l("variables.defaultValuePlaceholder","e.g., Acme Corporation"),className:x})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`${i}-description`,className:d,children:[l("variables.description","Description"),e.jsxs("span",{className:"ml-1 normal-case text-muted-foreground/50",children:["(",l("common.optional","optional"),")"]})]}),e.jsx("input",{id:`${i}-description`,type:"text",value:c,onChange:u=>g(u.target.value),placeholder:l("variables.descriptionPlaceholder","Brief description of the variable"),maxLength:500,className:x}),e.jsxs("div",{className:b,children:[c.length,"/500"]})]})]})}function M(t){return t.toLowerCase().trim().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_")}function he({open:t,onOpenChange:n}){const{t:s}=h(),[a,r]=p.useState(""),[o,c]=p.useState(""),[g,m]=p.useState(""),[i,l]=p.useState(""),x=xe(),d=p.useCallback(f=>{f||(r(""),c(""),m(""),l("")),n(f)},[n]);function b(f){c(f),(!a||a===M(o))&&r(M(f))}async function u(f){if(f.preventDefault(),!(!a.trim()||!o.trim()||!g.trim()))try{await x.mutateAsync({key:a.trim(),label:o.trim(),defaultValue:g.trim(),description:i.trim()||void 0}),d(!1)}catch{}}const y=a.trim().length>0&&o.trim().length>0&&g.trim().length>0;return e.jsx(I,{open:t,onOpenChange:d,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(L,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:s("variables.createDialog.title","New Variable")}),e.jsx($,{className:"mt-1 text-sm font-light text-muted-foreground",children:s("variables.createDialog.description","Create a new variable to use in templates")})]}),e.jsxs(F,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(T,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:u,children:[e.jsx(R,{keyValue:a,onKeyChange:r,label:o,onLabelChange:b,defaultValue:g,onDefaultValueChange:m,description:i,onDescriptionChange:l,idPrefix:"injectable"}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),disabled:x.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:s("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!y||x.isPending,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:x.isPending?s("common.creating","Creating..."):s("variables.createDialog.submit","Create Variable")})]})]})]})})}function je({open:t,onOpenChange:n,injectable:s}){const{t:a}=h(),r=ge();async function o(){if(!(!s||r.isPending))try{await r.mutateAsync(s.id),n(!1)}catch{}}return e.jsx(I,{open:t,onOpenChange:n,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center bg-destructive/10",children:e.jsx(B,{className:"h-5 w-5 text-destructive"})}),e.jsx(L,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:a("variables.deleteDialog.title","Delete Variable")})]}),e.jsxs(F,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(T,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsx("div",{className:"p-6",children:e.jsx($,{className:"text-sm font-light text-muted-foreground",children:a("variables.deleteDialog.message",'Are you sure you want to delete the variable "{{name}}"? This action cannot be undone.',{name:(s==null?void 0:s.label)??""})})}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),disabled:r.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:a("common.cancel","Cancel")}),e.jsx("button",{type:"button",onClick:o,disabled:r.isPending,className:"rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",children:r.isPending?a("common.deleting","Deleting..."):a("common.delete","Delete")})]})]})})}function ve({open:t,onOpenChange:n,injectable:s}){const{t:a}=h(),[r,o]=p.useState((s==null?void 0:s.key)??""),[c,g]=p.useState((s==null?void 0:s.label)??""),[m,i]=p.useState((s==null?void 0:s.defaultValue)??""),[l,x]=p.useState((s==null?void 0:s.description)??""),d=pe();async function b(y){if(y.preventDefault(),!(!s||!r.trim()||!c.trim()||!m.trim()))try{await d.mutateAsync({id:s.id,data:{key:r.trim(),label:c.trim(),defaultValue:m.trim(),description:l.trim()||void 0}}),n(!1)}catch{}}const u=r.trim().length>0&&c.trim().length>0&&m.trim().length>0;return e.jsx(I,{open:t,onOpenChange:n,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(L,{className:"font-mono text-sm font-medium uppercase tracking-widest text-foreground",children:a("variables.editDialog.title","Edit Variable")}),e.jsx($,{className:"mt-1 text-sm font-light text-muted-foreground",children:a("variables.editDialog.description","Update the variable properties")})]}),e.jsxs(F,{className:"text-muted-foreground transition-colors hover:text-foreground",children:[e.jsx(T,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("form",{onSubmit:b,children:[e.jsx(R,{keyValue:r,onKeyChange:o,label:c,onLabelChange:g,defaultValue:m,onDefaultValueChange:i,description:l,onDescriptionChange:x,idPrefix:"edit-injectable"}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),disabled:d.isPending,className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground disabled:opacity-50",children:a("common.cancel","Cancel")}),e.jsx("button",{type:"submit",disabled:!u||d.isPending,className:"rounded-none bg-foreground px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",children:d.isPending?a("common.saving","Saving..."):a("common.save","Save Changes")})]})]})]})})}const ye=10,Ne=.05;function we({injectable:t,index:n=0,onEdit:s,onDelete:a}){const{t:r}=h(),{hasPermission:o}=z(),c=o(A.INJECTABLE_EDIT),g=o(A.INJECTABLE_DELETE),m=o(A.INJECTABLE_TOGGLE_STATUS),i=be(),l=fe();async function x(){t.isActive?await l.mutateAsync(t.id):await i.mutateAsync(t.id)}const d=i.isPending||l.isPending,b=n<ye,u=b?n*Ne:0;return e.jsxs(O.tr,{initial:b?{opacity:0,x:20}:void 0,animate:{opacity:1,x:0},transition:{duration:.2,ease:"easeOut",delay:u},className:"group transition-colors hover:bg-accent",children:[e.jsx("td",{className:"border-b border-border py-5 pl-4 pr-4 align-middle",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"text-role transition-colors shrink-0",size:18}),e.jsxs(C,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{className:"block max-w-[140px] truncate font-mono text-sm text-foreground",children:t.key})}),e.jsx(S,{side:"top",children:e.jsx("span",{className:"font-mono text-sm",children:t.key})})]})]})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:e.jsxs(C,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{className:"block max-w-[180px] truncate text-sm text-foreground",children:t.label})}),e.jsx(S,{side:"top",children:t.label})]})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:t.description?e.jsxs(C,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{className:"block max-w-[140px] truncate text-sm text-muted-foreground",children:t.description})}),e.jsx(S,{side:"top",className:"max-w-xs",children:t.description})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"-"})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:t.defaultValue?e.jsxs(C,{children:[e.jsx(D,{asChild:!0,children:e.jsx("span",{className:"block max-w-[100px] truncate font-mono text-sm text-foreground",children:t.defaultValue})}),e.jsx(S,{side:"top",className:"max-w-xs",children:e.jsx("span",{className:"font-mono text-sm",children:t.defaultValue})})]}):e.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:"-"})}),e.jsx("td",{className:"border-b border-border py-5 align-middle",children:e.jsxs("span",{className:W("inline-flex items-center gap-1.5 font-mono text-xs uppercase tracking-wider",t.isActive?"text-green-600":"text-muted-foreground"),children:[e.jsx("span",{className:W("h-1.5 w-1.5 rounded-full",t.isActive?"bg-green-500":"bg-muted-foreground")}),t.isActive?r("variables.active","Active"):r("variables.inactive","Inactive")]})}),e.jsx("td",{className:"border-b border-border py-4 pr-4 align-middle",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx("button",{className:"text-muted-foreground transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:e.jsx(te,{size:20})})}),e.jsxs(Z,{align:"end",children:[c&&e.jsxs(E,{onClick:s,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),r("common.edit","Edit")]}),m&&e.jsx(E,{onClick:x,disabled:d,children:t.isActive?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),r("variables.deactivate","Deactivate")]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),r("variables.activate","Activate")]})}),g&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsxs(E,{onClick:a,className:"text-destructive focus:text-destructive",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),r("common.delete","Delete")]})]})]})]})})})]})}function ke({injectables:t,onEdit:n,onDelete:s}){const{t:a}=h();return e.jsxs("table",{className:"w-full border-collapse text-left",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[25%] border-b border-border py-4 pl-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:a("variables.columns.key","Variable Key")}),e.jsx("th",{className:"w-[30%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:a("variables.columns.label","Display Label")}),e.jsx("th",{className:"w-[20%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:a("variables.columns.description","Description")}),e.jsx("th",{className:"w-[15%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:a("variables.columns.defaultValue","Default Value")}),e.jsx("th",{className:"w-[10%] border-b border-border py-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:a("variables.columns.status","Status")}),e.jsx("th",{className:"w-[10%] border-b border-border py-4 pr-4 font-mono text-[10px] font-normal uppercase tracking-widest text-muted-foreground",children:e.jsx("div",{className:"flex items-center justify-center",children:a("variables.columns.action","Action")})})]})}),e.jsx("tbody",{className:"font-light",children:t.map((r,o)=>e.jsx(we,{injectable:r,index:o,onEdit:()=>n(r),onDelete:()=>s(r)},r.id))})]})}function Ce(){const{t}=h(),{currentWorkspace:n}=J(),{hasPermission:s}=z(),{isSandboxActive:a}=U(),r=s(A.INJECTABLE_CREATE),{data:o,isLoading:c}=me((n==null?void 0:n.id)??null),[g,m]=p.useState(!1),[i,l]=p.useState(null),[x,d]=p.useState(!1),[b,u]=p.useState(!1);function y(k){l(k),d(!0)}function f(k){l(k),u(!0)}return e.jsxs(O.div,{className:"animate-page-enter flex h-full flex-1 flex-col bg-background",children:[e.jsx("header",{className:"shrink-0 px-4 pb-6 pt-12 md:px-6 lg:px-6",children:e.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t("variables.header","Workspace")}),e.jsx("h1",{className:"font-display text-4xl font-light leading-tight tracking-tight text-foreground md:text-5xl",children:t("variables.title","Variables")})]}),r&&e.jsxs("button",{onClick:()=>m(!0),className:"group flex h-12 items-center gap-2 rounded-none bg-foreground px-6 text-sm font-medium tracking-wide text-background shadow-lg shadow-muted transition-colors hover:bg-foreground/90",children:[e.jsx(_,{size:20}),e.jsx("span",{children:t("variables.create","CREATE VARIABLE")})]})]})}),a&&e.jsxs("div",{className:"mx-4 mb-6 flex gap-3 border border-warning-border bg-warning-muted p-4 md:mx-6 lg:mx-6",children:[e.jsx(B,{size:18,className:"mt-0.5 shrink-0 text-warning"}),e.jsx("p",{className:"font-mono text-xs leading-relaxed text-warning-foreground",children:t("variables.sandboxWarning","Variables are shared between sandbox mode and production mode. Changes you make here will affect both modes.")})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-12 md:px-6 lg:px-6",children:[c&&e.jsx("div",{className:"space-y-4 pt-6",children:[...Array(5)].map((k,q)=>e.jsx(H,{className:"h-16 w-full"},q))}),!c&&(!o||o.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted/50",children:e.jsx(K,{size:32,className:"text-muted-foreground"})}),e.jsx("p",{className:"text-lg text-muted-foreground",children:t("variables.empty","No variables defined yet")}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground/70",children:t("variables.emptyHint","Create your first variable to use in templates")}),r&&e.jsxs("button",{onClick:()=>m(!0),className:"mt-6 flex items-center gap-2 border-b border-transparent pb-0.5 font-mono text-xs uppercase tracking-widest text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",children:[e.jsx(_,{size:16}),t("variables.create","Create Variable")]})]}),!c&&o&&o.length>0&&e.jsx(ke,{injectables:o,onEdit:y,onDelete:f})]}),e.jsx(he,{open:g,onOpenChange:m}),e.jsx(ve,{open:x,onOpenChange:d,injectable:i},(i==null?void 0:i.id)??"new"),e.jsx(je,{open:b,onOpenChange:u,injectable:i})]})}const Be=Ce;export{Be as component};
