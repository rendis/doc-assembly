import{H as at,I as Vt,J as Qt,a as q,t as be,j as e,d as k,L as J,r as o,K as dt,M as Ht,N as Gt,P as mt,Q as Xt,S as Zt,X as ut,U as se,V as xt,W as Yt,b as _e,m as Jt}from"./index-fKaFifWB.js";import{C as pt,U as es,T as ts,I as ss,a as ns,H as as,b as rs,G as ve,B as Pe,S as os,L as is,P as ft,c as Ae,d as cs,e as rt,f as ot,g as pe,h as fe}from"./tabs-BREKaaVO.js";import{u as ls,C as ht}from"./checkbox-ED_ecBkm.js";import{S as _}from"./skeleton-BPnsdAjk.js";import{u as ds,P as ms}from"./usePermission-zD2XWRZH.js";import{Q as us,b as xs,u as We,a as H}from"./useMutation-DIF_ISNy.js";import{B as ge}from"./button-dNu0h4YU.js";import{D as re,d as de,e as me,a as oe,b as ie,f as ue,B as ps}from"./dialog-9nhh7mvL.js";import{u as O}from"./useTranslation-D0qa437J.js";import{T as te}from"./triangle-alert-Di5g5Wop.js";import{B as le}from"./badge-B1W1bTxV.js";import{C as qe,a as Be}from"./chevron-right-BnYhLX46.js";import{S as fs,E as hs}from"./square-check-big-D50ND9hH.js";import{C as gs}from"./calendar-CUaXafub.js";import{D as Ie,a as Ee,b as De,c as Z,d as gt}from"./dropdown-menu-Dju4gITJ.js";import{S as bs,a as js,b as ys,c as vs,d as Ns}from"./sheet-Dn-HJILH.js";import{F as bt}from"./folder-open-CLELnnBv.js";import{S as Y}from"./search-DDi9d-Bq.js";import{C as ws}from"./chevron-left-B9Sdd2C1.js";import{P as Me}from"./plus-s7EU9lJN.js";import{T as jt,F as ks,A as yt}from"./trash-2-CCOxSVLr.js";import{C as Ue}from"./chevron-down-DzxdpjNN.js";import{P as Ke,a as Cs,b as Ss,c as vt,u as Ts}from"./useWorkspaces-gCKbkb4S.js";import{u as As,a as Ps,b as Is,c as Nt}from"./useDocumentTypes-BMD2TBs4.js";import{E as Ve}from"./ellipsis-BFuWo1Dd.js";import{P as Qe}from"./pencil-H1WR5f29.js";import"./Combination-C5nVb5De.js";var Es=class extends us{constructor(t,a){super(t,a)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:at()})}getOptimisticResult(t){return t.behavior=at(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,a){var A,h;const{state:n}=t,s=super.createResult(t,a),{isFetching:r,isRefetching:c,isError:i,isRefetchError:l}=s,d=(h=(A=n.fetchMeta)==null?void 0:A.fetchMore)==null?void 0:h.direction,u=i&&d==="forward",w=r&&d==="forward",b=i&&d==="backward",C=r&&d==="backward";return{...s,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Qt(a,n.data),hasPreviousPage:Vt(a,n.data),isFetchNextPageError:u,isFetchingNextPage:w,isFetchPreviousPageError:b,isFetchingPreviousPage:C,isRefetchError:l&&!u&&!b,isRefetching:c&&!w&&!C}}};function wt(t,a){return xs(t,Es)}const ee="/system/injectables";async function Ds(){return(await q.get(ee)).data.injectables}async function Ms(t){await q.patch(`${ee}/${t}/activate`)}async function Rs(t){await q.patch(`${ee}/${t}/deactivate`)}async function zs(t){return(await q.get(`${ee}/${t}/assignments`)).data.assignments}async function Ls(t,a){return(await q.post(`${ee}/${t}/assignments`,a)).data}async function Fs(t,a){await q.delete(`${ee}/${t}/assignments/${a}`)}async function Os(t,a){return(await q.patch(`${ee}/${t}/assignments/${a}/exclude`)).data}async function $s(t,a){return(await q.patch(`${ee}/${t}/assignments/${a}/include`)).data}async function Bs(t){return(await q.post(`${ee}/bulk/public`,{keys:t})).data}async function Us(t){return(await q.delete(`${ee}/bulk/public`,{data:{keys:t}})).data}const ae={all:["system-injectables"],lists:()=>[...ae.all,"list"],assignments:t=>[...ae.all,"assignments",t]};function xe(){const t=be();return()=>t.invalidateQueries({queryKey:ae.lists()})}function He(t){const a=be();return()=>a.invalidateQueries({queryKey:ae.assignments(t)})}function _s(){return We({queryKey:ae.lists(),queryFn:Ds,staleTime:300*1e3})}function Ws(t){return We({queryKey:ae.assignments(t??""),queryFn:()=>zs(t),enabled:!!t,staleTime:120*1e3})}function kt(){const t=xe();return H({mutationFn:Ms,onSuccess:t})}function Ct(){const t=xe();return H({mutationFn:Rs,onSuccess:t})}function qs(t){const a=be();return H({mutationFn:n=>Ls(t,n),onSuccess:()=>{a.invalidateQueries({queryKey:ae.assignments(t)}),a.invalidateQueries({queryKey:ae.lists()})}})}function Ks(t){const a=He(t),n=xe();return H({mutationFn:s=>Fs(t,s),onSuccess:()=>{a(),n()}})}function St(t){const a=He(t),n=xe();return H({mutationFn:s=>Os(t,s),onSuccess:()=>{a(),n()}})}function Vs(t){const a=He(t),n=xe();return H({mutationFn:s=>$s(t,s),onSuccess:()=>{a(),n()}})}function Qs(){const t=xe();return H({mutationFn:Bs,onSuccess:t})}function Hs(){const t=xe();return H({mutationFn:Us,onSuccess:t})}function Gs({open:t,onOpenChange:a,action:n,selectedKeys:s,onConfirm:r,isPending:c}){const{t:i}=O(),l=s.length;return e.jsx(re,{open:t,onOpenChange:a,children:e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(me,{children:[e.jsx(oe,{className:"font-mono text-sm uppercase tracking-widest",children:n==="make-public"?i("systemInjectables.bulk.confirmMakePublic","Make Injectables Public"):i("systemInjectables.bulk.confirmRemovePublic","Remove Public Access")}),e.jsx(ie,{children:n==="make-public"?i("systemInjectables.bulk.confirmMakePublicDescription","The following {{count}} injectables will be made PUBLIC:",{count:l}):i("systemInjectables.bulk.confirmRemovePublicDescription","PUBLIC access will be removed from the following {{count}} injectables:",{count:l})})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto rounded-sm border border-border bg-muted/30 p-3",children:e.jsx("ul",{className:"space-y-1",children:s.map(d=>e.jsxs("li",{className:"font-mono text-xs text-muted-foreground",children:["• ",d]},d))})}),e.jsxs("div",{className:k("flex items-start gap-2 rounded-sm border p-3",n==="make-public"?"border-warning-border bg-warning-muted":"border-destructive/30 bg-destructive/10"),children:[e.jsx(te,{size:16,className:k("mt-0.5 shrink-0",n==="make-public"?"text-warning":"text-destructive")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n==="make-public"?i("systemInjectables.bulk.warningMakePublic","PUBLIC injectables are available to ALL workspaces without explicit assignments."):i("systemInjectables.bulk.warningRemovePublic","Removing PUBLIC access will restrict these injectables to their scoped assignments only.")})]}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx(ge,{variant:"ghost",onClick:()=>a(!1),disabled:c,className:"font-mono text-xs uppercase",children:i("common.cancel","Cancel")}),e.jsx(ge,{onClick:r,disabled:c,className:k("font-mono text-xs uppercase",n==="make-public"?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-rose-600 text-white hover:bg-rose-700"),children:c?e.jsxs(e.Fragment,{children:[e.jsx(J,{size:14,className:"mr-2 animate-spin"}),i("common.processing","Processing...")]}):n==="make-public"?i("systemInjectables.bulk.makePublic","Make Public"):i("systemInjectables.bulk.removePublic","Remove Public")})]})]})})}var Re="Switch",[Xs]=Gt(Re),[Zs,Ys]=Xs(Re),Tt=o.forwardRef((t,a)=>{const{__scopeSwitch:n,name:s,checked:r,defaultChecked:c,required:i,disabled:l,value:d="on",onCheckedChange:u,form:w,...b}=t,[C,g]=o.useState(null),A=dt(a,S=>g(S)),h=o.useRef(!1),j=C?w||!!C.closest("form"):!0,[v,x]=Ht({prop:r,defaultProp:c??!1,onChange:u,caller:Re});return e.jsxs(Zs,{scope:n,checked:v,disabled:l,children:[e.jsx(mt.button,{type:"button",role:"switch","aria-checked":v,"aria-required":i,"data-state":Et(v),"data-disabled":l?"":void 0,disabled:l,value:d,...b,ref:A,onClick:Xt(t.onClick,S=>{x(p=>!p),j&&(h.current=S.isPropagationStopped(),h.current||S.stopPropagation())})}),j&&e.jsx(It,{control:C,bubbles:!h.current,name:s,value:d,checked:v,required:i,disabled:l,form:w,style:{transform:"translateX(-100%)"}})]})});Tt.displayName=Re;var At="SwitchThumb",Pt=o.forwardRef((t,a)=>{const{__scopeSwitch:n,...s}=t,r=Ys(At,n);return e.jsx(mt.span,{"data-state":Et(r.checked),"data-disabled":r.disabled?"":void 0,...s,ref:a})});Pt.displayName=At;var Js="SwitchBubbleInput",It=o.forwardRef(({__scopeSwitch:t,control:a,checked:n,bubbles:s=!0,...r},c)=>{const i=o.useRef(null),l=dt(i,c),d=ls(n),u=Zt(a);return o.useEffect(()=>{const w=i.current;if(!w)return;const b=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(b,"checked").set;if(d!==n&&g){const A=new Event("click",{bubbles:s});g.call(w,n),w.dispatchEvent(A)}},[d,n,s]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:l,style:{...r.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});It.displayName=Js;function Et(t){return t?"checked":"unchecked"}var Dt=Tt,en=Pt;const Ge=o.forwardRef(({className:t,...a},n)=>e.jsx(Dt,{className:k("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...a,ref:n,children:e.jsx(en,{className:k("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Ge.displayName=Dt.displayName;function tn({dataType:t,size:a,className:n}){switch(t.toUpperCase()){case"TEXT":return e.jsx(rs,{size:a,className:n});case"NUMBER":return e.jsx(as,{size:a,className:n});case"DATE":return e.jsx(gs,{size:a,className:n});case"CURRENCY":return e.jsx(ns,{size:a,className:n});case"BOOLEAN":return e.jsx(fs,{size:a,className:n});case"IMAGE":return e.jsx(ss,{size:a,className:n});case"TABLE":return e.jsx(ts,{size:a,className:n});case"ROLE_TEXT":return e.jsx(es,{size:a,className:n});default:return e.jsx(pt,{size:a,className:n})}}function sn({injectable:t,onToggle:a,onSelect:n,canManage:s,isToggling:r,selectable:c=!1,selected:i=!1,onSelectChange:l}){const{t:d,i18n:u}=O(),w=t.label[u.language]||t.label.en||t.key,b=t.description[u.language]||t.description.en||"";function C(g){const A=g.target;if(!(A.closest("[data-switch-area]")||A.closest("[data-checkbox-area]"))){if(c){l==null||l(!i);return}n(t)}}return e.jsxs("div",{role:"button",tabIndex:0,className:k("group flex cursor-pointer items-center justify-between border-b border-border px-3 py-2.5 transition-colors hover:bg-muted/30",i&&"bg-muted/50"),onClick:C,onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),c?l==null||l(!i):n(t))},children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3 text-left",children:[c&&e.jsx("div",{"data-checkbox-area":!0,className:"flex items-center",onClick:g=>g.stopPropagation(),children:e.jsx(ht,{checked:i,onCheckedChange:g=>l==null?void 0:l(g===!0),className:"h-4 w-4"})}),e.jsx("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-sm bg-muted/50",children:e.jsx(tn,{dataType:t.dataType,size:16,className:"text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:w}),e.jsx(le,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.key}),e.jsx(le,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.dataType}),t.isPublic?e.jsx(le,{variant:"secondary",className:"bg-success-muted font-mono text-[10px] uppercase text-success-foreground",children:d("systemInjectables.visibility.public","Public")}):e.jsx(le,{variant:"secondary",className:"bg-warning-muted font-mono text-[10px] uppercase text-warning-foreground",children:d("systemInjectables.visibility.scoped","Scoped")})]}),b&&e.jsx("p",{className:"mt-0.5 truncate text-xs text-muted-foreground",children:b})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{"data-switch-area":!0,className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t.isActive?"Active":"Inactive"}),e.jsx(Ge,{checked:t.isActive,onCheckedChange:g=>a(t.key,g),disabled:!s||r,"aria-label":`Toggle ${t.key}`})]}),e.jsx(qe,{size:14,className:"text-muted-foreground transition-transform group-hover:translate-x-1"})]})]})}async function Mt(t=1,a=10,n){return(await q.get("/system/tenants",{params:{page:t,perPage:a,...n&&{q:n}}})).data}async function nn(t,a=1,n=10,s){return(await q.get(`/system/tenants/${t}/workspaces`,{params:{page:a,perPage:n,...s&&{q:s}}})).data}async function an(t){return(await q.post("/system/tenants",t)).data}async function rn(t,a){return(await q.put(`/system/tenants/${t}`,a)).data}async function on(t,a){return(await q.patch(`/system/tenants/${t}/status`,{status:a})).data}const cn=10;function ln(t){return wt({queryKey:["infinite-tenants",t],queryFn:async({pageParam:a})=>{const n=await Mt(a,cn,t.length>=3?t:void 0);return{items:n.data.map(s=>({id:s.id,name:s.name,subtitle:s.code})),nextPage:n.pagination.page<n.pagination.totalPages?n.pagination.page+1:void 0,hasMore:n.pagination.page<n.pagination.totalPages}},getNextPageParam:a=>a.nextPage,initialPageParam:1})}const dn=10;function mn(t,a){return wt({queryKey:["infinite-workspaces",t,a],queryFn:async({pageParam:n})=>{if(!t)return{items:[],nextPage:void 0,hasMore:!1};const s=await nn(t,n,dn,a.length>=3?a:void 0);return{items:s.data.map(r=>({id:r.id,name:r.name,subtitle:r.type})),nextPage:s.pagination.page<s.pagination.totalPages?s.pagination.page+1:void 0,hasMore:s.pagination.page<s.pagination.totalPages}},getNextPageParam:n=>n.nextPage,initialPageParam:1,enabled:!!t})}function un({onIntersect:t,isLoading:a,hasMore:n}){const s=o.useRef(null);return o.useEffect(()=>{const r=new IntersectionObserver(c=>{c[0].isIntersecting&&n&&!a&&t()},{threshold:.1});return s.current&&r.observe(s.current),()=>r.disconnect()},[t,n,a]),n?e.jsx("div",{ref:s,className:"flex items-center justify-center p-3",children:a&&e.jsx(J,{size:16,className:"animate-spin text-muted-foreground"})}):null}function xn({tenant:t,onBack:a}){const{t:n}=O();return e.jsxs("button",{type:"button",onClick:a,className:"group flex w-full items-center gap-2 border-b border-border bg-muted/30 p-3 text-left transition-colors hover:bg-muted/50",children:[e.jsx(ws,{size:16,className:"text-muted-foreground transition-transform group-hover:-translate-x-0.5"}),e.jsx(Pe,{size:16,className:"text-muted-foreground"}),e.jsx("span",{className:"flex-1 text-sm font-medium",children:t.name}),e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground opacity-0 transition-opacity group-hover:opacity-100",children:n("systemInjectables.change","Change")})]})}function Le({items:t,selectedId:a,onSelect:n,showArrow:s=!1,isLoading:r,hasMore:c,onLoadMore:i,emptyMessage:l}){const d=o.useRef(null);return!r&&t.length===0?e.jsx("div",{className:"flex h-[200px] items-center justify-center border border-border",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:l})}):e.jsxs("div",{ref:d,className:"max-h-[240px] overflow-y-auto border border-border",children:[t.map(u=>e.jsxs("button",{type:"button",onClick:()=>n(u.id,u.name),className:k("flex w-full items-center justify-between border-b border-border p-3 text-left transition-colors last:border-b-0",a===u.id?"bg-muted/50":"hover:bg-muted/30"),children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:u.name}),u.subtitle&&e.jsx("div",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:u.subtitle})]}),s?e.jsx(qe,{size:16,className:"shrink-0 text-muted-foreground"}):a===u.id&&e.jsx(Be,{size:16,className:"shrink-0 text-foreground"})]},u.id)),e.jsx(un,{onIntersect:i,isLoading:r,hasMore:c}),r&&t.length===0&&e.jsx("div",{className:"flex h-[200px] items-center justify-center",children:e.jsx(J,{size:20,className:"animate-spin text-muted-foreground"})})]})}function pn({injectableKey:t,open:a,onOpenChange:n}){var ne,y;const{t:s}=O(),[r,c]=o.useState("TENANT"),[i,l]=o.useState(null),[d,u]=o.useState(null),[w,b]=o.useState("include"),[C,g]=o.useState("tenant"),[A,h]=o.useState(null),[j,v]=o.useState(""),[x,S]=o.useState(""),p=ln(j),N=mn((i==null?void 0:i.id)??null,x),M=((ne=p.data)==null?void 0:ne.pages.flatMap(E=>E.items))??[],R=((y=N.data)==null?void 0:y.pages.flatMap(E=>E.items))??[],D=qs(t),f=St(t),L=r==="PUBLIC"||r==="TENANT"&&i||r==="WORKSPACE"&&i&&d,K=D.isPending||f.isPending;function B(){c("TENANT"),l(null),u(null),b("include"),g("tenant"),h(null),v(""),S("")}function T(E){E||B(),n(E)}o.useEffect(()=>{if(A){const E=setTimeout(()=>{h(null)},300);return()=>clearTimeout(E)}},[A]);function F(E){h(E==="PUBLIC"&&r!=="PUBLIC"?r:null),c(E),g("tenant"),l(null),u(null),v(""),S("")}function P(E,ce){l({id:E,name:ce}),r==="WORKSPACE"&&g("workspace")}function U(E,ce){u({id:E,name:ce})}function I(){g("tenant"),u(null),S("")}const $=o.useCallback(()=>{p.hasNextPage&&!p.isFetchingNextPage&&p.fetchNextPage()},[p]),G=o.useCallback(()=>{N.hasNextPage&&!N.isFetchingNextPage&&N.fetchNextPage()},[N]);async function V(E){if(E.preventDefault(),!L)return;const ce={scopeType:r,...r!=="PUBLIC"&&i&&{tenantId:i.id},...r==="WORKSPACE"&&d&&{workspaceId:d.id}};try{const ze=await D.mutateAsync(ce);w==="exclude"&&await f.mutateAsync(ze.id),Q()}catch{}}function Q(){B(),n(!1)}return e.jsx(re,{open:a,onOpenChange:T,children:e.jsx(ps,{className:"sm:max-w-xl",children:e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border p-6",children:[e.jsxs("div",{children:[e.jsx(oe,{className:"font-mono text-sm font-medium uppercase tracking-widest",children:s("systemInjectables.createAssignment","Create Assignment")}),e.jsx(ie,{className:"mt-1 text-sm text-muted-foreground",children:s("systemInjectables.createAssignmentDesc","Assign this injectable to a specific scope")})]}),e.jsxs("button",{type:"button",onClick:Q,className:"rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]}),e.jsxs("div",{className:"max-h-[60vh] space-y-6 overflow-y-auto p-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("systemInjectables.scopeType","Scope Type")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>F("PUBLIC"),className:k("flex items-center gap-2 rounded-sm border px-3 py-2 transition-colors",r==="PUBLIC"?"border-foreground bg-muted/50":"border-border hover:border-muted-foreground/50"),children:[e.jsx(ve,{size:16,className:"shrink-0 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:s("systemInjectables.public","Public")})]}),e.jsxs("button",{type:"button",onClick:()=>F("TENANT"),className:k("flex items-center gap-2 rounded-sm border px-3 py-2 transition-colors",r==="TENANT"?"border-foreground bg-muted/50":"border-border hover:border-muted-foreground/50"),children:[e.jsx(Pe,{size:16,className:"shrink-0 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:s("systemInjectables.tenant","Tenant")})]}),e.jsxs("button",{type:"button",onClick:()=>F("WORKSPACE"),className:k("flex items-center gap-2 rounded-sm border px-3 py-2 transition-colors",r==="WORKSPACE"?"border-foreground bg-muted/50":"border-border hover:border-muted-foreground/50"),children:[e.jsx(bt,{size:16,className:"shrink-0 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:s("systemInjectables.workspace","Workspace")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("systemInjectables.assignmentMode","Assignment Mode")}),e.jsxs("div",{className:"flex items-center gap-1 rounded-sm border border-border p-1",children:[e.jsxs("button",{type:"button",onClick:()=>b("include"),className:k("flex items-center gap-1.5 rounded-sm px-3 py-1.5 text-xs font-medium transition-colors",w==="include"?"bg-emerald-500/10 text-emerald-600":"text-muted-foreground hover:text-foreground"),children:[e.jsx("div",{className:k("h-2 w-2 rounded-full",w==="include"?"bg-emerald-500":"bg-muted-foreground/30")}),s("systemInjectables.include","Include")]}),e.jsxs("button",{type:"button",onClick:()=>b("exclude"),className:k("flex items-center gap-1.5 rounded-sm px-3 py-1.5 text-xs font-medium transition-colors",w==="exclude"?"bg-rose-500/10 text-rose-600":"text-muted-foreground hover:text-foreground"),children:[e.jsx("div",{className:k("h-2 w-2 rounded-full",w==="exclude"?"bg-rose-500":"bg-muted-foreground/30")}),s("systemInjectables.exclude","Exclude")]})]})]}),e.jsx("div",{className:k("grid transition-[grid-template-rows] duration-300 ease-out",r==="PUBLIC"?"grid-rows-[0fr]":"grid-rows-[1fr]"),children:e.jsxs("div",{className:"relative min-h-[340px] overflow-hidden",children:[e.jsxs("div",{className:k("space-y-3 transition-opacity duration-200",r==="TENANT"||A==="TENANT"?"relative":"pointer-events-none absolute inset-x-0 top-0",r==="TENANT"?"opacity-100":"opacity-0"),"aria-hidden":r!=="TENANT",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("systemInjectables.selectTenant","Select Tenant")}),i&&e.jsx("span",{className:"font-mono text-[10px] text-foreground",children:i.name})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:16,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:j,onChange:E=>v(E.target.value),placeholder:s("systemInjectables.searchTenants","Search organizations..."),className:"w-full border-b border-border bg-transparent py-2 pl-6 pr-4 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"}),j.length>0&&j.length<3&&e.jsx("span",{className:"absolute -bottom-5 left-0 text-[10px] text-muted-foreground",children:s("systemInjectables.minChars","Type at least 3 characters")})]}),e.jsx(Le,{items:M,selectedId:(i==null?void 0:i.id)??null,onSelect:P,showArrow:!1,isLoading:p.isLoading||p.isFetchingNextPage,hasMore:p.hasNextPage??!1,onLoadMore:$,emptyMessage:s("systemInjectables.noTenants","No organizations found")})]}),e.jsx("div",{className:k("relative overflow-hidden transition-opacity duration-200",r==="WORKSPACE"||A==="WORKSPACE"?"relative":"pointer-events-none absolute inset-x-0 top-0",r==="WORKSPACE"?"opacity-100":"opacity-0"),"aria-hidden":r!=="WORKSPACE",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:k("space-y-3 transition-all duration-200 ease-out",C==="tenant"?"relative translate-x-0 opacity-100":"absolute inset-x-0 top-0 -translate-x-full opacity-0 pointer-events-none"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("systemInjectables.selectOrganization","Select Organization")}),e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground",children:s("systemInjectables.stepOf","Step {{current}} of {{total}}",{current:1,total:2})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:16,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:j,onChange:E=>v(E.target.value),placeholder:s("systemInjectables.searchTenants","Search organizations..."),className:"w-full border-b border-border bg-transparent py-2 pl-6 pr-4 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"}),j.length>0&&j.length<3&&e.jsx("span",{className:"absolute -bottom-5 left-0 text-[10px] text-muted-foreground",children:s("systemInjectables.minChars","Type at least 3 characters")})]}),e.jsx(Le,{items:M,selectedId:null,onSelect:P,showArrow:!0,isLoading:p.isLoading||p.isFetchingNextPage,hasMore:p.hasNextPage??!1,onLoadMore:$,emptyMessage:s("systemInjectables.noTenants","No organizations found")})]}),e.jsxs("div",{className:k("space-y-3 transition-all duration-200 ease-out",C==="workspace"?"relative translate-x-0 opacity-100":"absolute inset-x-0 top-0 translate-x-full opacity-0 pointer-events-none"),children:[i&&e.jsx(xn,{tenant:i,onBack:I}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"font-mono text-[10px] font-medium uppercase tracking-widest text-muted-foreground",children:s("systemInjectables.selectWorkspace","Select Workspace")}),e.jsx("span",{className:"font-mono text-[10px] text-muted-foreground",children:s("systemInjectables.stepOf","Step {{current}} of {{total}}",{current:2,total:2})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{size:16,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:x,onChange:E=>S(E.target.value),placeholder:s("systemInjectables.searchWorkspaces","Search workspaces..."),className:"w-full border-b border-border bg-transparent py-2 pl-6 pr-4 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"}),x.length>0&&x.length<3&&e.jsx("span",{className:"absolute -bottom-5 left-0 text-[10px] text-muted-foreground",children:s("systemInjectables.minChars","Type at least 3 characters")})]}),e.jsx(Le,{items:R,selectedId:(d==null?void 0:d.id)??null,onSelect:U,showArrow:!1,isLoading:N.isLoading||N.isFetchingNextPage,hasMore:N.hasNextPage??!1,onLoadMore:G,emptyMessage:s("systemInjectables.noWorkspaces","No workspaces found")})]})]})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-border p-6",children:[e.jsx(ge,{type:"button",variant:"outline",onClick:Q,className:"rounded-none font-mono text-xs uppercase",children:s("common.cancel","Cancel")}),e.jsx(ge,{type:"submit",disabled:!L||K,className:k("rounded-none font-mono text-xs uppercase",w==="include"?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-rose-600 text-white hover:bg-rose-700"),children:K?s("common.saving","Saving..."):w==="include"?s("systemInjectables.addInclusion","Add Inclusion"):s("systemInjectables.addExclusion","Add Exclusion")})]})]})})})}const Fe=7;function fn(t){const a=t.find(r=>r.scopeType==="PUBLIC")||null,n=new Map;for(const r of t){if(r.scopeType==="PUBLIC")continue;const c=r.tenantId,i=r.tenantName||c.slice(0,8);n.has(c)||n.set(c,{tenantId:c,tenantName:i,tenantAssignment:null,workspaceAssignments:[]});const l=n.get(c);r.scopeType==="TENANT"?l.tenantAssignment=r:l.workspaceAssignments.push(r)}for(const r of n.values())r.workspaceAssignments.sort((c,i)=>(c.workspaceName||"").localeCompare(i.workspaceName||""));const s=Array.from(n.values()).sort((r,c)=>r.tenantName.localeCompare(c.tenantName));return{publicAssignment:a,tenantGroups:s}}function hn(t,a){if(!a.trim())return t;const n=a.toLowerCase();return t.map(s=>{const r=s.tenantName.toLowerCase().includes(n),c=s.workspaceAssignments.filter(i=>{var l;return(l=i.workspaceName)==null?void 0:l.toLowerCase().includes(n)});return r?s:c.length>0?{...s,workspaceAssignments:c}:null}).filter(s=>s!==null)}function gn({injectable:t,open:a,onOpenChange:n,canManage:s}){const{t:r,i18n:c}=O(),[i,l]=o.useState(!1),[d,u]=o.useState(""),[w,b]=o.useState(null);function C(I){I||(u(""),b(null)),n(I)}const g=t?t.label[c.language]||t.label.en||t.key:"",A=t&&(t.description[c.language]||t.description.en)||"",{data:h,isLoading:j}=Ws(a?(t==null?void 0:t.key)??null:null),v=kt(),x=Ct(),S=Ks((t==null?void 0:t.key)??""),p=St((t==null?void 0:t.key)??""),N=Vs((t==null?void 0:t.key)??""),M=v.isPending||x.isPending,{publicAssignment:R,tenantGroups:D}=o.useMemo(()=>h?fn(h):{publicAssignment:null,tenantGroups:[]},[h]),f=o.useMemo(()=>hn(D,d),[D,d]),L=o.useMemo(()=>{if(d.trim()&&f.length>0){const I=f.find($=>$.workspaceAssignments.length>0&&!$.tenantName.toLowerCase().includes(d.toLowerCase()));if(I)return I.tenantId}return w},[d,f,w]);function K(I){t&&(I?v.mutate(t.key):x.mutate(t.key))}function B(I){S.mutate(I)}function T(I){I.isActive?p.mutate(I.id):N.mutate(I.id)}function F(I){b($=>$===I?null:I)}if(!t)return e.jsx(e.Fragment,{});const P=((h==null?void 0:h.length)??0)>0,U=R&&(!d||"public".includes(d.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(bs,{open:a,onOpenChange:C,children:e.jsxs(js,{className:"flex flex-col overflow-hidden sm:max-w-md",children:[e.jsxs(ys,{className:"border-b border-border pb-4 pr-8",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(vs,{className:"text-lg",children:g}),e.jsx(Ns,{className:"mt-1",children:A||r("common.noDescription","No description")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:t.isActive?"Active":"Inactive"}),e.jsx(Ge,{checked:t.isActive,onCheckedChange:K,disabled:!s||M})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(le,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.key}),e.jsx(le,{variant:"outline",className:"font-mono text-[10px] uppercase",children:t.dataType})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto py-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"font-mono text-xs font-medium uppercase tracking-widest text-muted-foreground",children:r("systemInjectables.scopeAssignments","Scope Assignments")}),s&&e.jsxs(ge,{variant:"ghost",size:"sm",className:"h-8 gap-1.5 font-mono text-xs uppercase",onClick:()=>l(!0),children:[e.jsx(Me,{size:14}),r("systemInjectables.addScope","Add")]})]}),P&&!j&&e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Y,{size:14,className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50"}),e.jsx("input",{type:"text",value:d,onChange:I=>u(I.target.value),placeholder:r("systemInjectables.filterPlaceholder","Filter by name..."),className:"w-full border-b border-border bg-transparent py-2 pl-5 pr-2 text-sm outline-none transition-colors placeholder:text-muted-foreground/50 focus-visible:border-foreground"})]}),j&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(_,{className:"h-14 w-full"}),e.jsx(_,{className:"h-14 w-full"})]}),!j&&U&&e.jsx(bn,{assignment:R,canManage:s,onDelete:()=>B(R.id),onToggle:()=>T(R),isDeleting:S.isPending,isToggling:p.isPending||N.isPending}),!j&&f.length>0&&e.jsx("div",{className:"space-y-2",children:f.map(I=>e.jsx(jn,{group:I,isExpanded:L===I.tenantId,onToggleExpand:()=>F(I.tenantId),canManage:s,onDeleteAssignment:B,onToggleAssignment:T,isDeleting:S.isPending,isToggling:p.isPending||N.isPending},I.tenantId))}),!j&&!P&&e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(ve,{size:32,className:"mx-auto mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r("systemInjectables.globalAvailability","Available globally to all workspaces")}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground/70",children:r("systemInjectables.globalHint","Add assignments to restrict availability to specific scopes")})]}),!j&&P&&d&&f.length===0&&!U&&e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(Y,{size:24,className:"mx-auto mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r("systemInjectables.noMatchingAssignments","No assignments match your search")})]})]})]})}),e.jsx(pn,{injectableKey:t.key,open:i,onOpenChange:l})]})}function Xe({status:t,size:a="sm"}){const n=a==="sm"?"h-2 w-2":"h-2.5 w-2.5";return t==="included"?e.jsx("div",{className:k(n,"rounded-full bg-emerald-500")}):t==="excluded"?e.jsx("div",{className:k(n,"rounded-full bg-rose-500")}):e.jsx("div",{className:k(n,"rounded-full border border-muted-foreground/50")})}function bn({assignment:t,canManage:a,onDelete:n,onToggle:s,isDeleting:r,isToggling:c}){const{t:i}=O();return e.jsxs("div",{className:"mb-4 flex items-center justify-between rounded-sm border border-dashed border-border bg-muted/20 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-sm bg-muted/50",children:e.jsx(ve,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs uppercase tracking-widest",children:i("systemInjectables.public","Public")}),e.jsx(Xe,{status:t.isActive?"included":"excluded"}),e.jsx("span",{className:"font-mono text-[10px] uppercase text-muted-foreground",children:t.isActive?i("systemInjectables.included","Included"):i("systemInjectables.excluded","Excluded")})]}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:i("systemInjectables.globalAvailability","Available globally")})]})]}),a&&e.jsx(Ze,{assignment:t,onDelete:n,onToggle:s,isDeleting:r,isToggling:c})]})}function jn({group:t,isExpanded:a,onToggleExpand:n,canManage:s,onDeleteAssignment:r,onToggleAssignment:c,isDeleting:i,isToggling:l}){const{t:d}=O(),[u,w]=o.useState(Fe),b=o.useRef(null);function C(){a&&w(Fe),n()}o.useEffect(()=>{if(!a||!b.current)return;const x=new IntersectionObserver(S=>{S[0].isIntersecting&&u<t.workspaceAssignments.length&&w(p=>Math.min(p+Fe,t.workspaceAssignments.length))},{threshold:.1});return x.observe(b.current),()=>x.disconnect()},[a,u,t.workspaceAssignments.length]);const g=t.tenantAssignment!==null,A=g?t.tenantAssignment.isActive?"included":"excluded":"none",h=t.workspaceAssignments.length,j=t.workspaceAssignments.slice(0,u),v=u<h;return e.jsxs("div",{className:"rounded-sm border border-border",children:[e.jsxs("button",{type:"button",onClick:C,className:"flex w-full items-center justify-between p-3 text-left transition-colors hover:bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-sm bg-muted/50",children:e.jsx(Pe,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.tenantName}),e.jsx(qe,{size:14,className:k("text-muted-foreground transition-transform duration-200",a&&"rotate-90")})]}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2",children:[e.jsx(Xe,{status:A}),e.jsx("span",{className:"font-mono text-[10px] uppercase text-muted-foreground",children:g?t.tenantAssignment.isActive?d("systemInjectables.included","Included"):d("systemInjectables.excluded","Excluded"):d("systemInjectables.noRule","No rule")}),h>0&&e.jsxs("span",{className:"font-mono text-[10px] text-muted-foreground/70",children:["· ",h," ",h===1?d("systemInjectables.workspace","workspace"):d("systemInjectables.workspaces","workspaces")]})]})]})]}),s&&g&&e.jsx("div",{onClick:x=>x.stopPropagation(),children:e.jsx(Ze,{assignment:t.tenantAssignment,onDelete:()=>r(t.tenantAssignment.id),onToggle:()=>c(t.tenantAssignment),isDeleting:i,isToggling:l})})]}),e.jsxs("div",{className:k("overflow-hidden transition-all duration-200",a?"max-h-[500px]":"max-h-0"),children:[h>0&&e.jsxs("div",{className:"max-h-[350px] overflow-y-auto border-t border-border",children:[j.map((x,S)=>e.jsx(yn,{assignment:x,isLast:S===j.length-1&&!v,canManage:s,onDelete:()=>r(x.id),onToggle:()=>c(x),isDeleting:i,isToggling:l},x.id)),v&&e.jsxs("div",{ref:b,className:"flex items-center justify-center py-3",children:[e.jsx(J,{size:14,className:"animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 font-mono text-[10px] text-muted-foreground",children:d("systemInjectables.loadingMore","Loading more...")})]})]}),h===0&&e.jsx("div",{className:"border-t border-border py-4 text-center",children:e.jsx("p",{className:"text-xs text-muted-foreground/70",children:d("systemInjectables.noWorkspaces","No workspace rules")})})]})]})}function yn({assignment:t,isLast:a,canManage:n,onDelete:s,onToggle:r,isDeleting:c,isToggling:i}){var d;const{t:l}=O();return e.jsxs("div",{className:k("flex items-center justify-between px-3 py-2 pl-6 transition-colors hover:bg-muted/20",!a&&"border-b border-border"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{size:14,className:"text-muted-foreground/70"}),e.jsx("span",{className:"text-sm",children:t.workspaceName||((d=t.workspaceId)==null?void 0:d.slice(0,8))}),e.jsx(Xe,{status:t.isActive?"included":"excluded"}),e.jsx("span",{className:"font-mono text-[10px] uppercase text-muted-foreground",children:t.isActive?l("systemInjectables.included","Included"):l("systemInjectables.excluded","Excluded")})]}),n&&e.jsx(Ze,{assignment:t,onDelete:s,onToggle:r,isDeleting:c,isToggling:i,size:"sm"})]})}function Ze({assignment:t,onDelete:a,onToggle:n,isDeleting:s,isToggling:r,size:c="md"}){const{t:i}=O();return e.jsxs(Ie,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(ge,{variant:"ghost",size:"icon",className:c==="sm"?"h-6 w-6":"h-8 w-8",disabled:s||r,children:e.jsx(hs,{size:c==="sm"?12:14})})}),e.jsxs(De,{align:"end",children:[e.jsx(Z,{onClick:n,disabled:r,children:t.isActive?i("systemInjectables.exclude","Exclude"):i("systemInjectables.include","Include")}),e.jsxs(Z,{onClick:a,disabled:s,className:"text-destructive focus:text-destructive",children:[e.jsx(jt,{size:14,className:"mr-2"}),i("common.delete","Delete")]})]})]})}const je=6;function vn(){var tt,st;const{t,i18n:a}=O(),{toast:n}=se(),{hasPermission:s}=ds(),r=s(ms.SYSTEM_INJECTABLES_MANAGE),{data:c,isLoading:i,error:l}=_s(),d=kt(),u=Ct(),w=Qs(),b=Hs(),[C,g]=o.useState(null),[A,h]=o.useState(!1),[j,v]=o.useState(!1),[x,S]=o.useState(new Set),[p,N]=o.useState(null),M=w.isPending||b.isPending,R=o.useMemo(()=>(c==null?void 0:c.find(m=>m.key===C))??null,[c,C]),[D,f]=o.useState(""),[L,K]=o.useState("all"),[B,T]=o.useState("name"),[F,P]=o.useState(!1),[U,I]=o.useState(!1),$=o.useRef(null),G=o.useRef(null),[V,Q]=o.useState(je),ne=o.useRef(null);o.useEffect(()=>{function m(z){$.current&&!$.current.contains(z.target)&&P(!1),G.current&&!G.current.contains(z.target)&&I(!1)}return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const y=o.useMemo(()=>c?c.filter(m=>{if(D){const z=D.toLowerCase(),W=m.label[a.language]||m.label.en||"",X=m.key.toLowerCase().includes(z),we=W.toLowerCase().includes(z);if(!X&&!we)return!1}return!(L==="active"&&!m.isActive||L==="inactive"&&m.isActive)}).sort((m,z)=>{let W=0;switch(B){case"name":return m.key.localeCompare(z.key);case"status":W=Number(z.isActive)-Number(m.isActive);break;case"type":W=m.dataType.localeCompare(z.dataType);break}return W!==0?W:m.key.localeCompare(z.key)}):[],[c,D,L,B,a.language]);o.useEffect(()=>{const m=ne.current;if(!m)return;const z=new IntersectionObserver(W=>{W[0].isIntersecting&&V<y.length&&Q(X=>Math.min(X+je,y.length))},{threshold:.1});return z.observe(m),()=>z.disconnect()},[V,y.length]);const E=o.useMemo(()=>y.slice(0,V),[y,V]);function ce(m,z){z?d.mutate(m):u.mutate(m)}function ze(m){g(m.key),h(!0)}const zt=o.useCallback(()=>{v(m=>(m&&S(new Set),!m))},[]),Lt=o.useCallback((m,z)=>{S(W=>{const X=new Set(W);return z?X.add(m):X.delete(m),X})},[]),Ft=o.useCallback(()=>{S(new Set(y.map(m=>m.key)))},[y]),Ot=o.useCallback(()=>{S(new Set)},[]),$t=o.useCallback(()=>{v(!1),S(new Set)},[]),Ye=o.useCallback(m=>{const z=(m==null?void 0:m.succeeded)??[],W=(m==null?void 0:m.failed)??[],X=z.length,we=W.length;if(we===0)n({title:t("systemInjectables.bulk.success","Bulk operation completed"),description:t("systemInjectables.bulk.successDescription","{{count}} injectables updated",{count:X})});else{const Kt=W.map(nt=>`${nt.key}: ${nt.error}`).join(`
`);n({title:t("systemInjectables.bulk.partialSuccess","Operation partially completed"),description:`${X} succeeded, ${we} failed
${Kt}`,variant:"destructive"})}},[t,n]),Bt=o.useCallback(async()=>{if(!p)return;const m=Array.from(x);try{const W=await(p==="make-public"?w:b).mutateAsync(m);console.log("Bulk operation result:",W),N(null),v(!1),S(new Set),Ye(W)}catch(z){N(null),n({title:t("common.error","Error"),description:t("systemInjectables.bulk.error","Failed to execute bulk operation"),variant:"destructive"}),console.error("Bulk operation error:",z)}},[p,x,w,b,Ye,t,n]),Ut=y.length>0&&x.size===y.length,_t=x.size>0&&x.size<y.length,Je=[{label:t("systemInjectables.filters.statusAll","All"),value:"all"},{label:t("systemInjectables.filters.statusActive","Active"),value:"active"},{label:t("systemInjectables.filters.statusInactive","Inactive"),value:"inactive"}],et=[{label:t("systemInjectables.filters.sortName","Name"),value:"name"},{label:t("systemInjectables.filters.sortStatus","Status"),value:"status"},{label:t("systemInjectables.filters.sortType","Type"),value:"type"}],Wt=((tt=Je.find(m=>m.value===L))==null?void 0:tt.label)??"All",qt=((st=et.find(m=>m.value===B))==null?void 0:st.label)??"Name";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.description","Manage system-level injectable functions and their availability scopes.")}),!r&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(te,{size:14}),t("systemInjectables.readOnlyWarning","You have read-only access. Only SUPERADMIN can modify settings.")]})]}),e.jsxs("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-center",children:[e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("systemInjectables.filters.searchPlaceholder","Search by name..."),value:D,onChange:m=>{f(m.target.value),Q(je)},className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[r&&e.jsxs("button",{onClick:zt,className:k("flex items-center gap-2 font-mono text-xs uppercase tracking-wider transition-colors",j?"text-foreground":"text-muted-foreground hover:text-foreground"),children:[e.jsx(os,{size:14}),e.jsx("span",{children:t("systemInjectables.selectMode","Select")})]}),e.jsxs("div",{className:k("flex items-center gap-3 overflow-hidden transition-all duration-300 ease-out",j?"max-w-[500px] opacity-100":"max-w-0 opacity-0"),children:[e.jsxs("div",{className:"flex items-center gap-2 border-l border-border pl-4",children:[e.jsx(ht,{checked:Ut?!0:_t?"indeterminate":!1,onCheckedChange:m=>{m?Ft():Ot()},className:"h-4 w-4"}),e.jsxs("span",{className:"font-mono text-[10px] uppercase tracking-wider text-muted-foreground",children:[x.size,"/",y.length]})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l border-border pl-3",children:[e.jsxs("button",{onClick:()=>N("make-public"),disabled:x.size===0||M,className:k("flex items-center gap-1.5 rounded-sm px-2 py-1 font-mono text-[10px] uppercase tracking-wider transition-colors",x.size>0?"bg-emerald-600/10 text-emerald-600 hover:bg-emerald-600/20":"text-muted-foreground/50"),children:[e.jsx(ve,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:t("systemInjectables.bulk.makePublic","Make Public")})]}),e.jsxs("button",{onClick:()=>N("remove-public"),disabled:x.size===0||M,className:k("flex items-center gap-1.5 rounded-sm px-2 py-1 font-mono text-[10px] uppercase tracking-wider transition-colors",x.size>0?"bg-rose-600/10 text-rose-600 hover:bg-rose-600/20":"text-muted-foreground/50"),children:[e.jsx(is,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:t("systemInjectables.bulk.removePublic","Remove Public")})]}),e.jsx("button",{onClick:$t,className:"ml-1 rounded-sm p-1 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:e.jsx(ut,{size:14})})]})]}),e.jsxs("div",{ref:$,className:"relative",children:[e.jsxs("button",{onClick:()=>P(!F),className:"flex items-center gap-2 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:[e.jsxs("span",{children:[t("systemInjectables.filters.status","Status"),": ",Wt]}),e.jsx(Ue,{size:14,className:k("transition-transform",F&&"rotate-180")})]}),F&&e.jsx("div",{className:"absolute right-0 top-full z-50 mt-2 min-w-[140px] border border-border bg-background shadow-lg",children:Je.map(m=>e.jsxs("button",{onClick:()=>{K(m.value),Q(je),P(!1)},className:k("flex w-full items-center justify-between px-4 py-2 text-left font-mono text-xs uppercase tracking-wider transition-colors hover:bg-muted",L===m.value&&"text-foreground",L!==m.value&&"text-muted-foreground"),children:[e.jsx("span",{children:m.label}),L===m.value&&e.jsx(Be,{size:12})]},m.value))})]}),e.jsxs("div",{ref:G,className:"relative",children:[e.jsxs("button",{onClick:()=>I(!U),className:"flex items-center gap-2 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:text-foreground",children:[e.jsxs("span",{children:[t("systemInjectables.filters.sortBy","Sort"),": ",qt]}),e.jsx(Ue,{size:14,className:k("transition-transform",U&&"rotate-180")})]}),U&&e.jsx("div",{className:"absolute right-0 top-full z-50 mt-2 min-w-[140px] border border-border bg-background shadow-lg",children:et.map(m=>e.jsxs("button",{onClick:()=>{T(m.value),Q(je),I(!1)},className:k("flex w-full items-center justify-between px-4 py-2 text-left font-mono text-xs uppercase tracking-wider transition-colors hover:bg-muted",B===m.value&&"text-foreground",B!==m.value&&"text-muted-foreground"),children:[e.jsx("span",{children:m.label}),B===m.value&&e.jsx(Be,{size:12})]},m.value))})]})]})]}),e.jsxs("div",{className:"rounded-sm border border-border",children:[i&&e.jsx("div",{className:"space-y-0",children:[...Array(4)].map((m,z)=>e.jsx("div",{className:"border-b border-border p-4 last:border-b-0",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{className:"h-10 w-10 shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(_,{className:"h-4 w-48"}),e.jsx(_,{className:"h-3 w-72"})]}),e.jsx(_,{className:"h-6 w-16"})]})},z))}),l&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(te,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.loadError","Failed to load system injectables")})]}),!i&&!l&&(!c||c.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(pt,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.empty","No system injectables configured")})]}),!i&&!l&&c&&c.length>0&&y.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(Y,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("systemInjectables.noResults","No injectables match your filters")})]}),!i&&!l&&y.length>0&&e.jsxs("div",{children:[E.map(m=>e.jsx(sn,{injectable:m,onToggle:ce,onSelect:ze,canManage:r,isToggling:d.isPending&&d.variables===m.key||u.isPending&&u.variables===m.key,selectable:j,selected:x.has(m.key),onSelectChange:z=>Lt(m.key,z)},m.key)),V<y.length&&e.jsx("div",{ref:ne,className:"flex items-center justify-center border-b border-border p-4",children:e.jsx("span",{className:"font-mono text-xs uppercase tracking-widest text-muted-foreground",children:t("systemInjectables.loadingMore","Loading more...")})}),e.jsx("div",{className:"border-t border-border p-3 text-center",children:e.jsx("span",{className:"font-mono text-xs text-muted-foreground",children:t("systemInjectables.showingOf","Showing {{visible}} of {{total}}",{visible:E.length,total:y.length})})})]})]}),e.jsx(gn,{injectable:R,open:A,onOpenChange:h,canManage:r}),e.jsx(Gs,{open:p!==null,onOpenChange:m=>!m&&N(null),action:p,selectedKeys:Array.from(x),onConfirm:Bt,isPending:M})]})}const ke="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground";function Nn(){const{t}=O(),a=[{id:"1",action:"User Login",user:"john@example.com",timestamp:"2 mins ago",details:"Successful login from 192.168.1.1"},{id:"2",action:"Template Created",user:"jane@example.com",timestamp:"1 hour ago",details:'Created "NDA Standard v3"'},{id:"3",action:"Document Signed",user:"bob@example.com",timestamp:"3 hours ago",details:'Signed "Contract-2024-001"'},{id:"4",action:"User Added",user:"admin@example.com",timestamp:"Yesterday",details:"Added user alice@example.com"},{id:"5",action:"Settings Changed",user:"admin@example.com",timestamp:"2 days ago",details:"Updated system security settings"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.audit.description","View system activity and security logs.")}),e.jsx("div",{className:"rounded-sm border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:ke,children:t("administration.audit.columns.action","Action")}),e.jsx("th",{className:ke,children:t("administration.audit.columns.user","User")}),e.jsx("th",{className:ke,children:t("administration.audit.columns.details","Details")}),e.jsx("th",{className:ke,children:t("administration.audit.columns.timestamp","Timestamp")})]})}),e.jsx("tbody",{children:a.map(n=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:n.action}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:n.user}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:n.details}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:n.timestamp})]},n.id))})]})})]})}const wn=/^[A-Z0-9]+(_[A-Z0-9]+)*$/;function kn(t){return t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"").replace(/_+/g,"_")}function Oe(t){return t.replace(/^_+|_+$/g,"")}function it({open:t,onOpenChange:a,mode:n,documentType:s}){return e.jsx(re,{open:t,onOpenChange:a,children:t&&e.jsx(Cn,{onOpenChange:a,mode:n,documentType:s})})}function Cn({onOpenChange:t,mode:a,documentType:n}){var K,B,T,F;const{t:s}=O(),{toast:r}=se(),[c,i]=o.useState(a==="edit"&&n?n.code:""),[l,d]=o.useState(a==="edit"&&n&&((K=n.name)==null?void 0:K.es)||""),[u,w]=o.useState(a==="edit"&&n&&((B=n.name)==null?void 0:B.en)||""),[b,C]=o.useState(a==="edit"&&n&&((T=n.description)==null?void 0:T.es)||""),[g,A]=o.useState(a==="edit"&&n&&((F=n.description)==null?void 0:F.en)||""),[h,j]=o.useState("es"),[v,x]=o.useState(""),[S,p]=o.useState(""),N=As(),M=Ps(),R=N.isPending||M.isPending,D=()=>{let P=!0;if(a==="create"){const U=Oe(c);U?U.length>50?(x(s("administration.documentTypes.form.codeTooLong","Code must be 50 characters or less")),P=!1):wn.test(U)?x(""):(x(s("administration.documentTypes.form.codeInvalid","Code must contain only letters, numbers, and underscores")),P=!1):(x(s("administration.documentTypes.form.codeRequired","Code is required")),P=!1)}return l.trim()?p(""):(p(s("administration.documentTypes.form.nameRequired","Spanish name is required")),P=!1),P},f=()=>{const P=Oe(c);P!==c&&i(P)},L=async P=>{var G;P.preventDefault();const U=Oe(c);if(U!==c&&i(U),!D())return;const I={};l.trim()&&(I.es=l.trim()),u.trim()&&(I.en=u.trim());const $={};b.trim()&&($.es=b.trim()),g.trim()&&($.en=g.trim());try{a==="create"?(await N.mutateAsync({code:U,name:I,description:Object.keys($).length>0?$:void 0}),r({title:s("administration.documentTypes.form.createSuccess","Document type created")})):n&&(await M.mutateAsync({id:n.id,data:{name:I,description:$}}),r({title:s("administration.documentTypes.form.updateSuccess","Document type updated")})),t(!1)}catch(V){xt.isAxiosError(V)&&((G=V.response)==null?void 0:G.status)===409?x(s("administration.documentTypes.form.codeExists","A document type with this code already exists")):r({variant:"destructive",title:s("common.error","Error"),description:s("administration.documentTypes.form.saveError","Failed to save document type")})}};return e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(me,{children:[e.jsx(oe,{children:a==="create"?s("administration.documentTypes.form.createTitle","Create Document Type"):s("administration.documentTypes.form.editTitle","Edit Document Type")}),e.jsx(ie,{children:a==="create"?s("administration.documentTypes.form.createDescription","Add a new document type to organize templates."):s("administration.documentTypes.form.editDescription","Update the document type details.")})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[a==="create"&&e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-medium",children:[s("administration.documentTypes.form.code","Code")," *"]}),e.jsx("input",{type:"text",value:c,onChange:P=>{i(kn(P.target.value)),x("")},onBlur:f,placeholder:s("administration.documentTypes.form.codePlaceholder","CONTRACT_TYPE"),className:k("w-full rounded-sm border bg-transparent px-3 py-2 text-sm font-mono uppercase outline-none transition-colors focus:border-foreground",v?"border-destructive":"border-border"),disabled:R}),v&&e.jsx("p",{className:"mt-1 text-xs text-destructive",children:v}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:s("administration.documentTypes.form.codeHint","Only uppercase letters, numbers, and underscores")})]}),a==="edit"&&n&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.documentTypes.form.code","Code")}),e.jsx("div",{className:"rounded-sm border border-border bg-muted px-3 py-2",children:e.jsx("span",{className:"font-mono text-sm uppercase",children:n.code})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-1 border-b border-border",children:[e.jsxs("button",{type:"button",className:k("px-3 py-2 text-sm transition-colors",h==="es"?"border-b-2 border-foreground font-medium":"text-muted-foreground hover:text-foreground"),onClick:()=>j("es"),children:["Español ",!l.trim()&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("button",{type:"button",className:k("px-3 py-2 text-sm transition-colors",h==="en"?"border-b-2 border-foreground font-medium":"text-muted-foreground hover:text-foreground"),onClick:()=>j("en"),children:"English"})]}),h==="es"&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-medium",children:[s("administration.documentTypes.form.name","Name")," *"]}),e.jsx("input",{type:"text",value:l,onChange:P=>{d(P.target.value),p("")},placeholder:s("administration.documentTypes.form.namePlaceholder","Type name"),className:k("w-full rounded-sm border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",S?"border-destructive":"border-border"),disabled:R}),S&&e.jsx("p",{className:"mt-1 text-xs text-destructive",children:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.documentTypes.form.description","Description")}),e.jsx("textarea",{value:b,onChange:P=>C(P.target.value),placeholder:s("administration.documentTypes.form.descriptionPlaceholder","Optional description"),rows:3,className:"w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",disabled:R})]})]}),h==="en"&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.documentTypes.form.name","Name")}),e.jsx("input",{type:"text",value:u,onChange:P=>w(P.target.value),placeholder:s("administration.documentTypes.form.namePlaceholder","Type name"),className:"w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",disabled:R})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.documentTypes.form.description","Description")}),e.jsx("textarea",{value:g,onChange:P=>A(P.target.value),placeholder:s("administration.documentTypes.form.descriptionPlaceholder","Optional description"),rows:3,className:"w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",disabled:R})]})]})]}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>t(!1),className:"rounded-sm border border-border px-4 py-2 text-sm font-medium transition-colors hover:bg-muted",disabled:R,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 text-sm font-medium text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",disabled:R,children:[R&&e.jsx(J,{size:16,className:"animate-spin"}),a==="create"?s("common.create","Create"):s("common.save","Save")]})]})]})]})}function ct(t,a){return t[a]||t.es||t.en||Object.values(t)[0]||""}function Sn({open:t,onOpenChange:a,documentType:n}){return e.jsx(re,{open:t,onOpenChange:a,children:t&&n&&e.jsx(Tn,{onOpenChange:a,documentType:n})})}function Tn({onOpenChange:t,documentType:a}){const{t:n,i18n:s}=O(),{toast:r}=se(),[c,i]=o.useState("confirm"),[l,d]=o.useState([]),[u,w]=o.useState(null),[b,C]=o.useState(""),g=Is(),{data:A}=Nt(1,100),h=g.isPending,j=(A==null?void 0:A.data.filter(p=>p.id!==a.id))??[],v=async()=>{try{if(c==="confirm"){const p=await g.mutateAsync({id:a.id});p.deleted?(r({title:n("administration.documentTypes.delete.success","Document type deleted")}),t(!1)):(d(p.templates),i("templates"))}else if(c==="templates"){if(!u)return;const p=u==="force"?{force:!0}:{replaceWithId:b};(await g.mutateAsync({id:a.id,options:p})).deleted&&(r({title:n("administration.documentTypes.delete.success","Document type deleted")}),t(!1))}}catch{r({variant:"destructive",title:n("common.error","Error"),description:n("administration.documentTypes.delete.error","Failed to delete document type")})}},x=c==="confirm"||c==="templates"&&(u==="force"||u==="replace"&&b),S=ct(a.name,s.language);return e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(me,{children:[e.jsx(oe,{children:n("administration.documentTypes.delete.title","Delete Document Type")}),e.jsx(ie,{children:c==="confirm"?n("administration.documentTypes.delete.confirm",'Are you sure you want to delete "{{name}}"?',{name:S}):n("administration.documentTypes.delete.hasTemplatesDescription","This document type is being used. Choose how to proceed.")})]}),c==="templates"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 rounded-sm border border-warning-border bg-warning-muted p-3",children:[e.jsx(te,{size:20,className:"shrink-0 text-warning-foreground"}),e.jsx("p",{className:"text-sm text-warning-foreground",children:n("administration.documentTypes.delete.hasTemplates","This document type is used by {{count}} template(s)",{count:l.length})})]}),e.jsx("div",{className:"max-h-40 overflow-y-auto rounded-sm border border-border",children:l.map(p=>e.jsxs("div",{className:"border-b border-border px-3 py-2 last:border-0",children:[e.jsx("span",{className:"text-sm font-medium",children:p.title}),e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",p.workspaceName,")"]})]},p.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex cursor-pointer items-start gap-3",children:[e.jsx("input",{type:"radio",name:"deleteAction",checked:u==="force",onChange:()=>w("force"),className:"mt-0.5",disabled:h}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:n("administration.documentTypes.delete.forceOption","Remove type from all templates")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("administration.documentTypes.delete.forceHint","Templates will have no document type assigned")})]})]}),e.jsxs("label",{className:"flex cursor-pointer items-start gap-3",children:[e.jsx("input",{type:"radio",name:"deleteAction",checked:u==="replace",onChange:()=>w("replace"),className:"mt-0.5",disabled:h||j.length===0}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:k("text-sm font-medium",j.length===0&&"text-muted-foreground"),children:n("administration.documentTypes.delete.replaceOption","Replace with another type")}),j.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:n("administration.documentTypes.delete.noOtherTypes","No other document types available")})]})]}),u==="replace"&&j.length>0&&e.jsxs("select",{value:b,onChange:p=>C(p.target.value),className:"ml-6 w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none focus:border-foreground",disabled:h,children:[e.jsx("option",{value:"",children:n("administration.documentTypes.delete.selectReplacement","Select replacement type...")}),j.map(p=>e.jsxs("option",{value:p.id,children:[ct(p.name,s.language)," (",p.code,")"]},p.id))]})]})]}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>t(!1),className:"rounded-sm border border-border px-4 py-2 text-sm font-medium transition-colors hover:bg-muted",disabled:h,children:n("common.cancel","Cancel")}),e.jsxs("button",{type:"button",onClick:v,className:"inline-flex items-center gap-2 rounded-sm bg-destructive px-4 py-2 text-sm font-medium text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:h||!x,children:[h&&e.jsx(J,{size:16,className:"animate-spin"}),n("common.delete","Delete")]})]})]})}const Ce="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground",An=10,Pn=300;function In(t,a){return t[a]||t.es||t.en||Object.values(t)[0]||""}function En(){var D;const{t,i18n:a}=O(),[n,s]=o.useState(1),[r,c]=o.useState(""),[i,l]=o.useState(""),[d,u]=o.useState(!1),[w,b]=o.useState(!1),[C,g]=o.useState(!1),[A,h]=o.useState(null);o.useEffect(()=>{const f=setTimeout(()=>{l(L=>(L!==r&&s(1),r))},Pn);return()=>clearTimeout(f)},[r]);const{data:j,isLoading:v,error:x,isFetching:S}=Nt(n,An,i.length>=3?i:void 0),p=(j==null?void 0:j.data)??[],N=((D=j==null?void 0:j.pagination)==null?void 0:D.totalPages)??1,M=f=>{h(f),b(!0)},R=f=>{h(f),g(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.documentTypes.description","Manage document types and their configurations.")}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 text-sm font-medium text-background transition-colors hover:bg-foreground/90",children:[e.jsx(Me,{size:16}),t("administration.documentTypes.create","Create Type")]})]}),e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("administration.documentTypes.searchPlaceholder","Search document types..."),value:r,onChange:f=>c(f.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"}),e.jsx("p",{className:`absolute left-0 top-full pt-1 text-xs text-muted-foreground transition-opacity duration-200 ${r.length>0&&r.length<3?"opacity-100":"opacity-0 pointer-events-none"}`,children:t("common.searchMinChars","Type at least 3 characters to search")})]}),e.jsxs("div",{className:"rounded-sm border",children:[v&&e.jsx("div",{className:"divide-y",children:[...Array(5)].map((f,L)=>e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx(_,{className:"h-4 w-24"}),e.jsx(_,{className:"h-4 w-40"}),e.jsx(_,{className:"h-4 w-12"}),e.jsx(_,{className:"h-4 w-8"})]},L))}),x&&!v&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(te,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.documentTypes.loadError","Failed to load document types")})]}),!v&&!x&&p.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(ks,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.length>=3?t("administration.documentTypes.noResults","No document types match your search"):t("administration.documentTypes.empty","No document types found")})]}),!v&&!x&&p.length>0&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:Ce,children:t("administration.documentTypes.columns.code","Code")}),e.jsx("th",{className:Ce,children:t("administration.documentTypes.columns.name","Name")}),e.jsx("th",{className:Ce,children:t("administration.documentTypes.columns.templates","Templates")}),e.jsx("th",{className:`${Ce} w-12`,children:t("administration.documentTypes.columns.actions","Actions")})]})}),e.jsx("tbody",{className:S?"opacity-50":void 0,children:p.map(f=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"inline-flex items-center rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",children:f.code})}),e.jsx("td",{className:"p-4 font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[In(f.name,a.language),f.isGlobal&&e.jsxs(le,{variant:"secondary",className:"gap-1 text-xs",children:[e.jsx(ve,{size:10}),t("administration.documentTypes.global","Global")]})]})}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:f.templatesCount??0}),e.jsx("td",{className:"p-4",children:f.isGlobal?e.jsx("span",{className:"text-xs text-muted-foreground",children:t("administration.documentTypes.readOnly","Read-only")}):e.jsxs(Ie,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx("button",{className:"rounded-sm p-1 hover:bg-muted",children:e.jsx(Ve,{size:16})})}),e.jsxs(De,{align:"end",children:[e.jsxs(Z,{onClick:()=>M(f),children:[e.jsx(Qe,{size:14,className:"mr-2"}),t("common.edit","Edit")]}),e.jsxs(Z,{onClick:()=>R(f),className:"text-destructive focus:text-destructive",children:[e.jsx(jt,{size:14,className:"mr-2"}),t("common.delete","Delete")]})]})]})})]},f.id))})]})]}),!v&&!x&&e.jsx(Ke,{page:n,totalPages:N,onPageChange:s,disabled:S,className:"py-2"}),e.jsx(it,{open:d,onOpenChange:u,mode:"create"}),e.jsx(it,{open:w,onOpenChange:b,mode:"edit",documentType:A}),e.jsx(Sn,{open:C,onOpenChange:g,documentType:A})]})}const Ne={all:["system-tenants"],list:(t,a,n)=>[...Ne.all,"list",t,a,n]};function Dn(t,a,n){return We({queryKey:Ne.list(t,a,n),queryFn:()=>Mt(t,a,n),placeholderData:Yt,staleTime:120*1e3})}function Mn(){const t=be();return H({mutationFn:a=>an(a),onSuccess:()=>{t.invalidateQueries({queryKey:Ne.all})}})}function Rn(){const t=be();return H({mutationFn:({id:a,data:n})=>rn(a,n),onSuccess:()=>{t.invalidateQueries({queryKey:Ne.all})}})}function Rt(){const t=be();return H({mutationFn:({id:a,status:n})=>on(a,n),onSuccess:()=>{t.invalidateQueries({queryKey:Ne.all})}})}const zn=/^[A-Z0-9]+(_[A-Z0-9]+)*$/;function Ln(t){return t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"").replace(/_+/g,"_")}function $e(t){return t.replace(/^_+|_+$/g,"")}function Fn({open:t,onOpenChange:a,mode:n,tenant:s}){return e.jsx(re,{open:t,onOpenChange:a,children:t&&e.jsx(On,{onOpenChange:a,mode:n,tenant:s})})}function On({onOpenChange:t,mode:a,tenant:n}){const{t:s}=O(),{toast:r}=se(),[c,i]=o.useState(a==="edit"&&n?n.name:""),[l,d]=o.useState(a==="edit"&&n?n.code:""),[u,w]=o.useState(a==="edit"&&n&&n.description||""),[b,C]=o.useState(""),[g,A]=o.useState(""),h=Mn(),j=Rn(),v=h.isPending||j.isPending,x=()=>{let N=!0;if(c.trim()?c.length>100?(C(s("administration.tenants.form.nameTooLong","Name must be 100 characters or less")),N=!1):C(""):(C(s("administration.tenants.form.nameRequired","Name is required")),N=!1),a==="create"){const M=$e(l);M?M.length<2||M.length>10?(A(s("administration.tenants.form.codeLength","Code must be 2-10 characters")),N=!1):zn.test(M)?A(""):(A(s("administration.tenants.form.codeInvalid","Code must contain only letters, numbers, and underscores")),N=!1):(A(s("administration.tenants.form.codeRequired","Code is required")),N=!1)}return N},S=()=>{const N=$e(l);N!==l&&d(N)},p=async N=>{var R;N.preventDefault();const M=$e(l);if(M!==l&&d(M),!!x())try{a==="create"?(await h.mutateAsync({name:c.trim(),code:M,description:u.trim()||void 0}),r({title:s("administration.tenants.form.createSuccess","Tenant created")})):n&&(await j.mutateAsync({id:n.id,data:{name:c.trim(),description:u.trim()||void 0}}),r({title:s("administration.tenants.form.updateSuccess","Tenant updated")})),t(!1)}catch(D){xt.isAxiosError(D)&&((R=D.response)==null?void 0:R.status)===409?A(s("administration.tenants.form.codeExists","A tenant with this code already exists")):r({variant:"destructive",title:s("common.error","Error"),description:s("administration.tenants.form.saveError","Failed to save tenant")})}};return e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(me,{children:[e.jsx(oe,{children:a==="create"?s("administration.tenants.form.createTitle","Create Tenant"):s("administration.tenants.form.editTitle","Edit Tenant")}),e.jsx(ie,{children:a==="create"?s("administration.tenants.form.createDescription","Create a new tenant organization."):s("administration.tenants.form.editDescription","Update tenant details.")})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-medium",children:[s("administration.tenants.form.name","Name")," *"]}),e.jsx("input",{type:"text",value:c,onChange:N=>{i(N.target.value),C("")},placeholder:s("administration.tenants.form.namePlaceholder","Tenant name"),className:k("w-full rounded-sm border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",b?"border-destructive":"border-border"),disabled:v}),b&&e.jsx("p",{className:"mt-1 text-xs text-destructive",children:b})]}),a==="create"&&e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-medium",children:[s("administration.tenants.form.code","Code")," *"]}),e.jsx("input",{type:"text",value:l,onChange:N=>{d(Ln(N.target.value)),A("")},onBlur:S,placeholder:s("administration.tenants.form.codePlaceholder","TENANT_CODE"),className:k("w-full rounded-sm border bg-transparent px-3 py-2 text-sm font-mono uppercase outline-none transition-colors focus:border-foreground",g?"border-destructive":"border-border"),disabled:v}),g&&e.jsx("p",{className:"mt-1 text-xs text-destructive",children:g}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:s("administration.tenants.form.codeHint","2-10 uppercase characters")})]}),a==="edit"&&n&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.tenants.form.code","Code")}),e.jsx("div",{className:"rounded-sm border border-border bg-muted px-3 py-2",children:e.jsx("span",{className:"font-mono text-sm uppercase",children:n.code})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.tenants.form.description","Description")}),e.jsx("textarea",{value:u,onChange:N=>w(N.target.value),placeholder:s("administration.tenants.form.descriptionPlaceholder","Optional description"),rows:3,className:"w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",disabled:v})]}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>t(!1),className:"rounded-sm border border-border px-4 py-2 text-sm font-medium transition-colors hover:bg-muted",disabled:v,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 text-sm font-medium text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",disabled:v,children:[v&&e.jsx(J,{size:16,className:"animate-spin"}),a==="create"?s("common.create","Create"):s("common.save","Save")]})]})]})]})}const $n={ACTIVE:"border-success-border bg-success-muted text-success-foreground",SUSPENDED:"border-warning-border bg-warning-muted text-warning-foreground",ARCHIVED:"border-border bg-muted text-muted-foreground"},Bn={ACTIVE:"bg-green-500",SUSPENDED:"bg-yellow-500",ARCHIVED:"bg-gray-400 dark:bg-gray-500"};function Un({status:t,className:a}){return e.jsxs("span",{className:k("inline-flex min-w-[90px] items-center justify-center gap-1.5 rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",$n[t],a),children:[e.jsx("span",{className:k("h-1.5 w-1.5 shrink-0 rounded-full",Bn[t])}),t]})}function _n({open:t,onOpenChange:a,tenant:n}){const{t:s}=O(),{toast:r}=se(),c=Rt(),i=c.isPending,l=async()=>{if(n)try{await c.mutateAsync({id:n.id,status:"ARCHIVED"}),r({title:s("administration.tenants.archive.success","Tenant archived")}),a(!1)}catch{r({variant:"destructive",title:s("common.error","Error"),description:s("administration.tenants.archive.error","Failed to archive tenant")})}};return n?e.jsx(re,{open:t,onOpenChange:a,children:e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(me,{children:[e.jsxs(oe,{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-widest",children:[e.jsx(te,{size:18,className:"text-destructive"}),s("administration.tenants.archive.title","Archive Tenant")]}),e.jsx(ie,{children:s("administration.tenants.archive.confirm",'Are you sure you want to archive "{{name}}"?',{name:n.name})})]}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s("administration.tenants.archive.description","This will hide the tenant from all users. The data will be preserved and can be restored by an administrator.")})}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",disabled:i,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:i,children:[i&&e.jsx(J,{size:14,className:"animate-spin"}),s("common.archive","Archive")]})]})]})}):e.jsx(e.Fragment,{})}const ye="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground",Wn=10,qn=300;function Kn(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Vn(){var B;const{t}=O(),{toast:a}=se(),[n,s]=o.useState(1),[r,c]=o.useState(""),[i,l]=o.useState(""),[d,u]=o.useState(!1),[w,b]=o.useState("create"),[C,g]=o.useState(null),[A,h]=o.useState(!1),j=Rt();o.useEffect(()=>{const T=setTimeout(()=>{l(F=>(F!==r&&s(1),r))},qn);return()=>clearTimeout(T)},[r]);const{data:v,isLoading:x,error:S,isFetching:p}=Dn(n,Wn,i.length>=3?i:void 0),N=(v==null?void 0:v.data)??[],M=((B=v==null?void 0:v.pagination)==null?void 0:B.totalPages)??1,R=()=>{g(null),b("create"),u(!0)},D=T=>{g(T),b("edit"),u(!0)},f=async(T,F)=>{try{await j.mutateAsync({id:T.id,status:F}),a({title:t("administration.tenants.statusUpdated","Status updated")})}catch{a({variant:"destructive",title:t("common.error","Error"),description:t("administration.tenants.statusError","Failed to update status")})}},L=T=>{g(T),h(!0)},K=T=>T.status==="ACTIVE"?{label:t("administration.tenants.actions.suspend","Suspend"),icon:ft,onClick:()=>f(T,"SUSPENDED")}:T.status==="SUSPENDED"?{label:t("administration.tenants.actions.activate","Activate"),icon:Ae,onClick:()=>f(T,"ACTIVE")}:{label:t("administration.tenants.actions.activate","Activate"),icon:Ae,onClick:()=>f(T,"ACTIVE")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.tenants.description","Manage tenant organizations and their configurations.")}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("administration.tenants.searchPlaceholder","Search tenants..."),value:r,onChange:T=>c(T.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"}),e.jsx("p",{className:`absolute left-0 top-full pt-1 text-xs text-muted-foreground transition-opacity duration-200 ${r.length>0&&r.length<3?"opacity-100":"opacity-0 pointer-events-none"}`,children:t("common.searchMinChars","Type at least 3 characters to search")})]}),e.jsxs("button",{onClick:R,className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90",children:[e.jsx(Me,{size:14}),t("administration.tenants.addTenant","Add Tenant")]})]}),e.jsxs("div",{className:"rounded-sm border",children:[x&&e.jsx("div",{className:"divide-y",children:[...Array(5)].map((T,F)=>e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx(_,{className:"h-4 w-40"}),e.jsx(_,{className:"h-4 w-20"}),e.jsx(_,{className:"h-4 w-20"}),e.jsx(_,{className:"h-4 w-28"})]},F))}),S&&!x&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(te,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.tenants.loadError","Failed to load tenants")})]}),!x&&!S&&N.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(Pe,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.length>=3?t("administration.tenants.noResults","No tenants match your search"):t("administration.tenants.empty","No tenants found")})]}),!x&&!S&&N.length>0&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:`${ye} w-[35%]`,children:t("administration.tenants.columns.name","Name")}),e.jsx("th",{className:`${ye} w-[15%]`,children:t("administration.tenants.columns.code","Code")}),e.jsx("th",{className:`${ye} w-[15%]`,children:t("administration.tenants.columns.status","Status")}),e.jsx("th",{className:`${ye} w-[20%]`,children:t("administration.tenants.columns.created","Created")}),e.jsx("th",{className:`${ye} w-[15%]`})]})}),e.jsx("tbody",{className:p?"opacity-50":void 0,children:N.map(T=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("span",{className:"font-medium",children:T.name}),T.isSystem&&e.jsx("span",{className:"ml-2 rounded-sm bg-muted px-1.5 py-0.5 text-[10px] font-medium uppercase text-muted-foreground",children:t("administration.tenants.system","System")})]}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"inline-flex items-center rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",children:T.code})}),e.jsx("td",{className:"whitespace-nowrap p-4",children:e.jsx(Un,{status:T.status})}),e.jsx("td",{className:"whitespace-nowrap p-4 font-mono text-sm text-muted-foreground",children:Kn(T.createdAt)}),e.jsx("td",{className:"p-4",children:!T.isSystem&&e.jsxs(Ie,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx("button",{className:"rounded-sm p-1 hover:bg-muted",children:e.jsx(Ve,{size:16})})}),e.jsxs(De,{align:"end",children:[e.jsxs(Z,{onClick:()=>D(T),children:[e.jsx(Qe,{size:14,className:"mr-2"}),t("administration.tenants.actions.edit","Edit")]}),e.jsx(Z,{onClick:K(T).onClick,children:(()=>{const F=K(T),P=F.icon;return e.jsxs(e.Fragment,{children:[e.jsx(P,{size:14,className:"mr-2"}),F.label]})})()}),T.status!=="ARCHIVED"&&e.jsxs(e.Fragment,{children:[e.jsx(gt,{}),e.jsxs(Z,{onClick:()=>L(T),className:"text-destructive focus:text-destructive",children:[e.jsx(yt,{size:14,className:"mr-2"}),t("administration.tenants.actions.archive","Archive")]})]})]})]})})]},T.id))})]})]}),!x&&!S&&e.jsx(Ke,{page:n,totalPages:M,onPageChange:s,disabled:p,className:"py-2"}),e.jsx(Fn,{open:d,onOpenChange:u,mode:w,tenant:C}),e.jsx(_n,{open:A,onOpenChange:h,tenant:C})]})}const Se="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground";function Qn(){const{t}=O(),a=[{id:"1",name:"John Doe",email:"john@example.com",role:"SUPERADMIN",status:"Active"},{id:"2",name:"Jane Smith",email:"jane@example.com",role:"PLATFORM_ADMIN",status:"Active"},{id:"3",name:"Bob Wilson",email:"bob@example.com",role:"PLATFORM_ADMIN",status:"Active"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.users.description","Manage system users and their roles.")}),e.jsx("div",{className:"rounded-sm border",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:Se,children:t("administration.users.columns.name","Name")}),e.jsx("th",{className:Se,children:t("administration.users.columns.email","Email")}),e.jsx("th",{className:Se,children:t("administration.users.columns.role","Role")}),e.jsx("th",{className:Se,children:t("administration.users.columns.status","Status")})]})}),e.jsx("tbody",{children:a.map(n=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:n.name}),e.jsx("td",{className:"p-4 font-mono text-sm text-muted-foreground",children:n.email}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"rounded-sm bg-muted px-2 py-0.5 font-mono text-xs",children:n.role})}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 font-mono text-xs text-green-600",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),n.status]})})]},n.id))})]})})]})}const Hn={ACTIVE:"border-success-border bg-success-muted text-success-foreground",SUSPENDED:"border-warning-border bg-warning-muted text-warning-foreground",ARCHIVED:"border-border bg-muted text-muted-foreground"},Gn={ACTIVE:"bg-green-500",SUSPENDED:"bg-yellow-500",ARCHIVED:"bg-gray-400 dark:bg-gray-500"};function Xn({status:t,className:a}){return e.jsxs("span",{className:k("inline-flex min-w-[90px] items-center justify-center gap-1.5 rounded-sm border px-2 py-0.5 font-mono text-xs uppercase",Hn[t],a),children:[e.jsx("span",{className:k("h-1.5 w-1.5 shrink-0 rounded-full",Gn[t])}),t]})}function Zn({open:t,onOpenChange:a,mode:n,workspace:s}){return e.jsx(re,{open:t,onOpenChange:a,children:t&&e.jsx(Yn,{onOpenChange:a,mode:n,workspace:s})})}function Yn({onOpenChange:t,mode:a,workspace:n}){var M,R,D;const{t:s}=O(),{toast:r}=se(),{currentWorkspace:c}=_e(),[i,l]=o.useState(a==="edit"&&n?n.name:""),[d,u]=o.useState(a==="edit"&&n&&((M=n.settings)==null?void 0:M.theme)||""),[w,b]=o.useState(a==="edit"&&n&&((R=n.settings)==null?void 0:R.logoUrl)||""),[C,g]=o.useState(a==="edit"&&n&&((D=n.settings)==null?void 0:D.primaryColor)||""),[A,h]=o.useState(""),j=Cs(),v=Ss(),x=j.isPending||v.isPending,S=()=>{let f=!0;return i.trim()?i.length>255?(h(s("administration.workspaces.form.nameTooLong","Name must be 255 characters or less")),f=!1):h(""):(h(s("administration.workspaces.form.nameRequired","Name is required")),f=!1),f},p=()=>{const f={};return d.trim()&&(f.theme=d.trim()),w.trim()&&(f.logoUrl=w.trim()),C.trim()&&(f.primaryColor=C.trim()),Object.keys(f).length>0?f:void 0},N=async f=>{if(f.preventDefault(),!!S())try{if(a==="create")await j.mutateAsync({name:i.trim(),type:"CLIENT"}),r({title:s("administration.workspaces.form.createSuccess","Workspace created")});else if(n)if((c==null?void 0:c.id)===n.id)await v.mutateAsync({name:i.trim(),settings:p()}),r({title:s("administration.workspaces.form.updateSuccess","Workspace updated")});else{r({variant:"destructive",title:s("common.error","Error"),description:s("administration.workspaces.form.editContextError","Cannot edit workspace outside its context")});return}t(!1)}catch{r({variant:"destructive",title:s("common.error","Error"),description:s("administration.workspaces.form.saveError","Failed to save workspace")})}};return e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(me,{children:[e.jsx(oe,{children:a==="create"?s("administration.workspaces.form.createTitle","Create Workspace"):s("administration.workspaces.form.editTitle","Edit Workspace")}),e.jsx(ie,{children:a==="create"?s("administration.workspaces.form.createDescription","Create a new workspace for this tenant."):s("administration.workspaces.form.editDescription","Update workspace details.")})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-medium",children:[s("administration.workspaces.form.name","Name")," *"]}),e.jsx("input",{type:"text",value:i,onChange:f=>{l(f.target.value),h("")},placeholder:s("administration.workspaces.form.namePlaceholder","Workspace name"),className:k("w-full rounded-sm border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",A?"border-destructive":"border-border"),disabled:x}),A&&e.jsx("p",{className:"mt-1 text-xs text-destructive",children:A})]}),e.jsxs("div",{className:"space-y-3 border-t border-border pt-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s("administration.workspaces.form.settings","Settings (Optional)")}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.workspaces.form.theme","Theme")}),e.jsx("input",{type:"text",value:d,onChange:f=>u(f.target.value),placeholder:s("administration.workspaces.form.themePlaceholder","e.g., light, dark"),className:"w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",disabled:x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.workspaces.form.logoUrl","Logo URL")}),e.jsx("input",{type:"url",value:w,onChange:f=>b(f.target.value),placeholder:s("administration.workspaces.form.logoUrlPlaceholder","https://example.com/logo.png"),className:"w-full rounded-sm border border-border bg-transparent px-3 py-2 text-sm outline-none transition-colors focus:border-foreground",disabled:x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-medium",children:s("administration.workspaces.form.primaryColor","Primary Color")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:f=>g(f.target.value),placeholder:s("administration.workspaces.form.primaryColorPlaceholder","#3B82F6"),className:"flex-1 rounded-sm border border-border bg-transparent px-3 py-2 text-sm font-mono outline-none transition-colors focus:border-foreground",disabled:x}),C&&e.jsx("div",{className:"h-9 w-9 rounded-sm border border-border",style:{backgroundColor:C}})]})]})]}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>t(!1),className:"rounded-sm border border-border px-4 py-2 text-sm font-medium transition-colors hover:bg-muted",disabled:x,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 text-sm font-medium text-background transition-colors hover:bg-foreground/90 disabled:opacity-50",disabled:x,children:[x&&e.jsx(J,{size:16,className:"animate-spin"}),a==="create"?s("common.create","Create"):s("common.save","Save")]})]})]})]})}function Jn({open:t,onOpenChange:a,workspace:n}){const{t:s}=O(),{toast:r}=se(),c=vt(),i=c.isPending,l=async()=>{if(n)try{await c.mutateAsync({id:n.id,status:"ARCHIVED"}),r({title:s("administration.workspaces.archive.success","Workspace archived")}),a(!1)}catch{r({variant:"destructive",title:s("common.error","Error"),description:s("administration.workspaces.archive.error","Failed to archive workspace")})}};return n?e.jsx(re,{open:t,onOpenChange:a,children:e.jsxs(de,{className:"sm:max-w-md",children:[e.jsxs(me,{children:[e.jsxs(oe,{className:"flex items-center gap-2 font-mono text-sm uppercase tracking-widest",children:[e.jsx(te,{size:18,className:"text-destructive"}),s("administration.workspaces.archive.title","Archive Workspace")]}),e.jsx(ie,{children:s("administration.workspaces.archive.confirm",'Are you sure you want to archive "{{name}}"?',{name:n.name})})]}),e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsx("div",{className:"rounded-sm border border-warning-border bg-warning-muted p-3",children:e.jsx("p",{className:"text-sm text-warning-foreground",children:s("administration.workspaces.archive.warning","This workspace may contain templates and documents that will become inaccessible.")})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("administration.workspaces.archive.description","Archiving will hide this workspace from all users. The data will be preserved and can be restored by an administrator.")})]}),e.jsxs(ue,{className:"gap-2 sm:gap-0",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"rounded-none border border-border bg-background px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-muted-foreground transition-colors hover:border-foreground hover:text-foreground",disabled:i,children:s("common.cancel","Cancel")}),e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 rounded-none bg-destructive px-6 py-2.5 font-mono text-xs uppercase tracking-wider text-destructive-foreground transition-colors hover:bg-destructive/90 disabled:opacity-50",disabled:i,children:[i&&e.jsx(J,{size:14,className:"animate-spin"}),s("common.archive","Archive")]})]})]})}):e.jsx(e.Fragment,{})}const Te="p-4 text-left font-mono text-xs uppercase tracking-widest text-muted-foreground",ea=10,ta=300,lt=[{value:"",labelKey:"administration.workspaces.filter.allStatuses",fallback:"All Statuses"},{value:"ACTIVE",labelKey:"administration.workspaces.filter.active",fallback:"Active"},{value:"SUSPENDED",labelKey:"administration.workspaces.filter.suspended",fallback:"Suspended"},{value:"ARCHIVED",labelKey:"administration.workspaces.filter.archived",fallback:"Archived"}];function sa(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function na({workspace:t,index:a,isEntering:n,isFilterAnimating:s,onEdit:r,onArchive:c,getStatusAction:i,t:l}){const d=a<10,u=d?a*.05:0,w=()=>n&&d?{opacity:0,x:50}:s&&d?{opacity:0,x:20}:{opacity:1,x:0},b=i(t),C=b.icon;return e.jsxs(Jt.tr,{initial:w(),animate:{opacity:1,x:0},transition:{duration:s?.15:.2,ease:"easeOut",delay:n||s?u:0},className:"border-b last:border-0 hover:bg-muted/50",style:{overflow:"hidden"},children:[e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"whitespace-nowrap p-4",children:e.jsx(Xn,{status:t.status})}),e.jsx("td",{className:"whitespace-nowrap p-4 font-mono text-sm text-muted-foreground",children:sa(t.createdAt)}),e.jsx("td",{className:"p-4",children:e.jsxs(Ie,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx("button",{className:"rounded-sm p-1 hover:bg-muted",children:e.jsx(Ve,{size:16})})}),e.jsxs(De,{align:"end",children:[e.jsxs(Z,{onClick:()=>r(t),children:[e.jsx(Qe,{size:14,className:"mr-2"}),l("administration.workspaces.actions.edit","Edit")]}),e.jsxs(Z,{onClick:b.onClick,children:[e.jsx(C,{size:14,className:"mr-2"}),b.label]}),t.status!=="ARCHIVED"&&e.jsxs(e.Fragment,{children:[e.jsx(gt,{}),e.jsxs(Z,{onClick:()=>c(t),className:"text-destructive focus:text-destructive",children:[e.jsx(yt,{size:14,className:"mr-2"}),l("administration.workspaces.actions.archive","Archive")]})]})]})]})})]})}function aa(){var ne;const{t}=O(),{toast:a}=se(),{currentTenant:n}=_e(),[s,r]=o.useState(1),[c,i]=o.useState(""),[l,d]=o.useState(""),[u,w]=o.useState(""),[b,C]=o.useState(!1),[g,A]=o.useState(!0),[h,j]=o.useState(!1),[v,x]=o.useState("create"),[S,p]=o.useState(null),[N,M]=o.useState(!1),R=vt();o.useEffect(()=>{const y=setTimeout(()=>{A(!1)},600);return()=>clearTimeout(y)},[]),o.useEffect(()=>{const y=setTimeout(()=>{d(E=>(E!==c&&r(1),c))},ta);return()=>clearTimeout(y)},[c]);const{data:D,isLoading:f,error:L,isFetching:K}=Ts((n==null?void 0:n.id)??null,s,ea,l.length>=3?l:void 0,u||void 0),B=((ne=D==null?void 0:D.pagination)==null?void 0:ne.totalPages)??1,T=o.useMemo(()=>((D==null?void 0:D.data)??[]).filter(y=>y.type==="CLIENT"),[D==null?void 0:D.data]),F=o.useMemo(()=>T.map(y=>y.id).join(","),[T]),P=!g,U=()=>{p(null),x("create"),j(!0)},I=y=>{p(y),x("edit"),j(!0)},$=async(y,E)=>{try{await R.mutateAsync({id:y.id,status:E}),a({title:t("administration.workspaces.statusUpdated","Status updated")})}catch{a({variant:"destructive",title:t("common.error","Error"),description:t("administration.workspaces.statusError","Failed to update status")})}},G=y=>{p(y),M(!0)},V=y=>y.status==="ACTIVE"?{label:t("administration.workspaces.actions.suspend","Suspend"),icon:ft,onClick:()=>$(y,"SUSPENDED")}:y.status==="SUSPENDED"?{label:t("administration.workspaces.actions.activate","Activate"),icon:Ae,onClick:()=>$(y,"ACTIVE")}:{label:t("administration.workspaces.actions.activate","Activate"),icon:Ae,onClick:()=>$(y,"ACTIVE")},Q=lt.find(y=>y.value===u);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.workspaces.description","Manage workspaces for this tenant.")}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsxs("div",{className:"group relative w-full md:max-w-xs",children:[e.jsx(Y,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-muted-foreground/50 transition-colors group-focus-within:text-foreground",size:18}),e.jsx("input",{type:"text",placeholder:t("administration.workspaces.searchPlaceholder","Search workspaces..."),value:c,onChange:y=>i(y.target.value),className:"w-full rounded-none border-0 border-b border-border bg-transparent py-2 pl-7 pr-4 text-sm font-light text-foreground outline-none transition-all placeholder:text-muted-foreground/50 focus-visible:border-foreground focus-visible:ring-0"}),e.jsx("p",{className:`absolute left-0 top-full whitespace-nowrap pt-1 text-xs text-muted-foreground transition-opacity duration-200 ${c.length>0&&c.length<3?"opacity-100":"opacity-0 pointer-events-none"}`,children:t("common.searchMinChars","Type at least 3 characters to search")})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>C(!b),className:"inline-flex items-center gap-2 whitespace-nowrap rounded-sm border border-border px-3 py-2 text-sm text-foreground transition-colors hover:bg-muted",children:[Q?t(Q.labelKey,Q.fallback):t("administration.workspaces.filter.allStatuses","All Statuses"),e.jsx(Ue,{size:16,className:`transition-transform ${b?"rotate-180":""}`})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>C(!1)}),e.jsx("div",{className:"absolute left-0 top-full z-20 mt-1 min-w-[160px] rounded-sm border border-border bg-popover py-1 shadow-md",children:lt.map(y=>e.jsx("button",{onClick:()=>{w(y.value),r(1),C(!1)},className:`flex w-full items-center px-3 py-2 text-left text-sm transition-colors hover:bg-accent ${u===y.value?"font-medium text-foreground":"text-muted-foreground"}`,children:t(y.labelKey,y.fallback)},y.value))})]})]})]}),e.jsxs("button",{onClick:U,className:"inline-flex items-center gap-2 rounded-sm bg-foreground px-4 py-2 font-mono text-xs uppercase tracking-wider text-background transition-colors hover:bg-foreground/90",children:[e.jsx(Me,{size:14}),t("administration.workspaces.addWorkspace","Add Workspace")]})]}),e.jsxs("div",{className:"rounded-sm border",children:[f&&e.jsx("div",{className:"divide-y",children:[...Array(5)].map((y,E)=>e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx(_,{className:"h-4 w-40"}),e.jsx(_,{className:"h-4 w-20"}),e.jsx(_,{className:"h-4 w-28"})]},E))}),L&&!f&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(te,{size:32,className:"mb-3 text-destructive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("administration.workspaces.loadError","Failed to load workspaces")})]}),!f&&!L&&T.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx(cs,{size:32,className:"mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.length>=3||u?t("administration.workspaces.noResults","No workspaces match your search"):t("administration.workspaces.empty","No workspaces found")})]}),!f&&!L&&T.length>0&&e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:`${Te} w-[40%]`,children:t("administration.workspaces.columns.name","Name")}),e.jsx("th",{className:`${Te} w-[20%]`,children:t("administration.workspaces.columns.status","Status")}),e.jsx("th",{className:`${Te} w-[25%]`,children:t("administration.workspaces.columns.created","Created")}),e.jsx("th",{className:`${Te} w-[15%]`})]})}),e.jsx("tbody",{children:T.map((y,E)=>e.jsx(na,{workspace:y,index:E,isEntering:g||P,isFilterAnimating:P,onEdit:I,onArchive:G,getStatusAction:V,t},`${y.id}-${F}`))})]})]}),!f&&!L&&e.jsx(Ke,{page:s,totalPages:B,onPageChange:r,disabled:K,className:"py-2"}),e.jsx(Zn,{open:h,onOpenChange:j,mode:v,workspace:S}),e.jsx(Jn,{open:N,onOpenChange:M,workspace:S})]})}const he="font-mono text-xs uppercase tracking-widest";function ra(){const{t}=O(),{isGlobalSystemWorkspace:a,isTenantSystemWorkspace:n}=_e(),s=a(),r=n();return e.jsxs("div",{className:"animate-page-enter flex-1 overflow-y-auto bg-background",children:[e.jsxs("header",{className:"px-4 pb-6 pt-12 md:px-6",children:[e.jsx("div",{className:"mb-1 font-mono text-[10px] uppercase tracking-widest text-muted-foreground",children:s?t("administration.label","System"):t("administration.labelTenant","Tenant")}),e.jsx("h1",{className:"font-display text-4xl font-light tracking-tight",children:t("administration.title","Administration")})]}),e.jsxs("main",{className:"px-4 pb-12 md:px-6",children:[s&&e.jsxs(rt,{defaultValue:"tenants",children:[e.jsxs(ot,{className:"mb-6",children:[e.jsx(pe,{value:"tenants",className:he,children:t("administration.tabs.tenants","Tenants")}),e.jsx(pe,{value:"users",className:he,children:t("administration.tabs.users","Users")}),e.jsx(pe,{value:"injectables",className:he,children:t("administration.tabs.injectables","Injectables")}),e.jsx(pe,{value:"audit",className:he,children:t("administration.tabs.audit","Audit")})]}),e.jsx(fe,{value:"tenants",children:e.jsx(Vn,{})}),e.jsx(fe,{value:"users",children:e.jsx(Qn,{})}),e.jsx(fe,{value:"injectables",children:e.jsx(vn,{})}),e.jsx(fe,{value:"audit",children:e.jsx(Nn,{})})]}),r&&e.jsxs(rt,{defaultValue:"document-types",children:[e.jsxs(ot,{className:"mb-6",children:[e.jsx(pe,{value:"document-types",className:he,children:t("administration.tabs.documentTypes","Document Types")}),e.jsx(pe,{value:"workspaces",className:he,children:t("administration.tabs.workspaces","Workspaces")})]}),e.jsx(fe,{value:"document-types",children:e.jsx(En,{})}),e.jsx(fe,{value:"workspaces",children:e.jsx(aa,{})})]})]})]})}const Ma=ra;export{Ma as component};
